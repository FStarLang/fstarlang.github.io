<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>FStar.Pervasives</title>
  <style>@charset "utf-8"; .gist{font-size:16px;color:#333;text-align:left;/*!* GitHub Light v0.4.1 * Copyright(c) 2012 - 2017 GitHub,Inc. * Licensed under MIT(https://github.com/primer/github-syntax-theme-generator/blob/master/LICENSE) */ direction:ltr}.gist .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.gist .markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.gist .markdown-body:before{display:table;content:""}.gist .markdown-body:after{display:table;clear:both;content:""}.gist .markdown-body>:first-child{margin-top:0 !important}.gist .markdown-body>:last-child{margin-bottom:0 !important}.gist .markdown-body a:not([href]){color:inherit;text-decoration:none}.gist .markdown-body .absent{color:#cb2431}.gist .markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.gist .markdown-body .anchor:focus{outline:none}.gist .markdown-body blockquote,.gist .markdown-body details,.gist .markdown-body dl,.gist .markdown-body ol,.gist .markdown-body p,.gist .markdown-body pre,.gist .markdown-body table,.gist .markdown-body ul{margin-top:0;margin-bottom:16px}.gist .markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.gist .markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.gist .markdown-body blockquote>:first-child{margin-top:0}.gist .markdown-body blockquote>:last-child{margin-bottom:0}.gist .markdown-body h1,.gist .markdown-body h2,.gist .markdown-body h3,.gist .markdown-body h4,.gist .markdown-body h5,.gist .markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.gist .markdown-body h1 .octicon-link,.gist .markdown-body h2 .octicon-link,.gist .markdown-body h3 .octicon-link,.gist .markdown-body h4 .octicon-link,.gist .markdown-body h5 .octicon-link,.gist .markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.gist .markdown-body h1:hover .anchor,.gist .markdown-body h2:hover .anchor,.gist .markdown-body h3:hover .anchor,.gist .markdown-body h4:hover .anchor,.gist .markdown-body h5:hover .anchor,.gist .markdown-body h6:hover .anchor{text-decoration:none}.gist .markdown-body h1:hover .anchor .octicon-link,.gist .markdown-body h2:hover .anchor .octicon-link,.gist .markdown-body h3:hover .anchor .octicon-link,.gist .markdown-body h4:hover .anchor .octicon-link,.gist .markdown-body h5:hover .anchor .octicon-link,.gist .markdown-body h6:hover .anchor .octicon-link{visibility:visible}.gist .markdown-body h1 code,.gist .markdown-body h1 tt,.gist .markdown-body h2 code,.gist .markdown-body h2 tt,.gist .markdown-body h3 code,.gist .markdown-body h3 tt,.gist .markdown-body h4 code,.gist .markdown-body h4 tt,.gist .markdown-body h5 code,.gist .markdown-body h5 tt,.gist .markdown-body h6 code,.gist .markdown-body h6 tt{font-size:inherit}.gist .markdown-body h1{font-size:2em}.gist .markdown-body h1,.gist .markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.gist .markdown-body h2{font-size:1.5em}.gist .markdown-body h3{font-size:1.25em}.gist .markdown-body h4{font-size:1em}.gist .markdown-body h5{font-size:.875em}.gist .markdown-body h6{font-size:.85em;color:#6a737d}.gist .markdown-body ol,.gist .markdown-body ul{padding-left:2em}.gist .markdown-body ol.no-list,.gist .markdown-body ul.no-list{padding:0;list-style-type:none}.gist .markdown-body ol ol,.gist .markdown-body ol ul,.gist .markdown-body ul ol,.gist .markdown-body ul ul{margin-top:0;margin-bottom:0}.gist .markdown-body li{word-wrap:break-all}.gist .markdown-body li>p{margin-top:16px}.gist .markdown-body li+li{margin-top:.25em}.gist .markdown-body dl{padding:0}.gist .markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.gist .markdown-body dl dd{padding:0 16px;margin-bottom:16px}.gist .markdown-body table{display:block;width:100%;overflow:auto}.gist .markdown-body table th{font-weight:600}.gist .markdown-body table td,.gist .markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.gist .markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.gist .markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.gist .markdown-body table img{background-color:initial}.gist .markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.gist .markdown-body img[align=right]{padding-left:20px}.gist .markdown-body img[align=left]{padding-right:20px}.gist .markdown-body .emoji{max-width:none;vertical-align:text-top;background-color:initial}.gist .markdown-body span.frame{display:block;overflow:hidden}.gist .markdown-body span.frame>span{display:block;float:left;width:auto;padding:7px;margin:13px 0 0;overflow:hidden;border:1px solid #dfe2e5}.gist .markdown-body span.frame span img{display:block;float:left}.gist .markdown-body span.frame span span{display:block;padding:5px 0 0;clear:both;color:#24292e}.gist .markdown-body span.align-center{display:block;overflow:hidden;clear:both}.gist .markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.gist .markdown-body span.align-center span img{margin:0 auto;text-align:center}.gist .markdown-body span.align-right{display:block;overflow:hidden;clear:both}.gist .markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.gist .markdown-body span.align-right span img{margin:0;text-align:right}.gist .markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.gist .markdown-body span.float-left span{margin:13px 0 0}.gist .markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.gist .markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.gist .markdown-body code,.gist .markdown-body tt{padding:.2em .4em;margin:0;font-size:85%;background-color:#f6f8fa;border-radius:3px}.gist .markdown-body code br,.gist .markdown-body tt br{display:none}.gist .markdown-body del code{text-decoration:inherit}.gist .markdown-body pre{word-wrap:normal}.gist .markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.gist .markdown-body .highlight{margin-bottom:16px}.gist .markdown-body .highlight pre{margin-bottom:0;word-break:normal}.gist .markdown-body .highlight pre,.gist .markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.gist .markdown-body pre code,.gist .markdown-body pre tt{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:#f6f8fa;border:0}.gist .markdown-body .csv-data td,.gist .markdown-body .csv-data th{padding:5px;overflow:hidden;font-size:12px;line-height:1;text-align:left;white-space:nowrap}.gist .markdown-body .csv-data .blob-num{padding:10px 8px 9px;text-align:right;background:#fff;border:0}.gist .markdown-body .csv-data tr{border-top:0}.gist .markdown-body .csv-data th{font-weight:600;background:#f6f8fa;border-top:0}.gist .pl-c{color:#6a737d}.gist .pl-c1,.gist .pl-s .pl-v{color:#005cc5}.gist .pl-e,.gist .pl-en{color:#6f42c1}.gist .pl-s .pl-s1,.gist .pl-smi{color:#24292e}.gist .pl-ent{color:#22863a}.gist .pl-k{color:#d73a49}.gist .pl-pds,.gist .pl-s,.gist .pl-s .pl-pse .pl-s1,.gist .pl-sr,.gist .pl-sr .pl-cce,.gist .pl-sr .pl-sra,.gist .pl-sr .pl-sre{color:#032f62}.gist .pl-smw,.gist .pl-v{color:#e36209}.gist .pl-bu{color:#b31d28}.gist .pl-ii{color:#fafbfc;background-color:#b31d28}.gist .pl-c2{color:#fafbfc;background-color:#d73a49}.gist .pl-c2:before{content:"^M"}.gist .pl-sr .pl-cce{font-weight:700;color:#22863a}.gist .pl-ml{color:#735c0f}.gist .pl-mh,.gist .pl-mh .pl-en,.gist .pl-ms{font-weight:700;color:#005cc5}.gist .pl-mi{font-style:italic;color:#24292e}.gist .pl-mb{font-weight:700;color:#24292e}.gist .pl-md{color:#b31d28;background-color:#ffeef0}.gist .pl-mi1{color:#22863a;background-color:#f0fff4}.gist .pl-mc{color:#e36209;background-color:#ffebda}.gist .pl-mi2{color:#f6f8fa;background-color:#005cc5}.gist .pl-mdr{font-weight:700;color:#6f42c1}.gist .pl-ba{color:#586069}.gist .pl-sg{color:#959da5}.gist .pl-corl{text-decoration:underline;color:#032f62}.gist .breadcrumb{font-size:16px;color:#586069}.gist .breadcrumb .separator{white-space:pre-wrap}.gist .breadcrumb .separator:after,.gist .breadcrumb .separator:before{content:" "}.gist .breadcrumb strong.final-path{color:#24292e}.gist strong{font-weight:bolder}.gist .editor-abort{display:inline;font-size:14px}.gist .blob-interaction-bar{position:relative;background-color:#f2f2f2;border-bottom:1px solid #e5e5e5}.gist .blob-interaction-bar:before{display:table;content:""}.gist .blob-interaction-bar:after{display:table;clear:both;content:""}.gist .blob-interaction-bar .octicon-search{position:absolute;top:10px;left:10px;font-size:12px;color:#586069}.gist .blob-filter{width:100%;padding:4px 20px 5px 30px;font-size:12px;border:0;border-radius:0;outline:none}.gist .blob-filter:focus{outline:none}.gist .html-blob{margin-bottom:15px}.gist .TagsearchPopover{width:inherit;max-width:600px}.gist .TagsearchPopover-content{max-height:300px}.gist .TagsearchPopover-list .TagsearchPopover-list-item:hover{background-color:#f6f8fa}.gist .TagsearchPopover-list .TagsearchPopover-list-item .TagsearchPopover-item:hover{text-decoration:none}.gist .TagsearchPopover-list .blob-code-inner{white-space:pre-wrap}.gist .linejump .linejump-input{width:340px;background-color:#fafbfc}.gist .linejump .btn,.gist .linejump .linejump-input{padding:10px 15px;font-size:16px}.gist .CopyBlock{line-height:20px;cursor:pointer}.gist .CopyBlock .octicon-clippy{display:none}.gist .CopyBlock:active,.gist .CopyBlock:focus,.gist .CopyBlock:hover{background-color:#fff;outline:none}.gist .CopyBlock:active .octicon-clippy,.gist .CopyBlock:focus .octicon-clippy,.gist .CopyBlock:hover .octicon-clippy{display:inline-block}.gist .blob-wrapper{overflow-x:auto;overflow-y:hidden}.gist .page-blob.height-full .blob-wrapper{overflow-y:auto}.gist .page-edit-blob.height-full .CodeMirror{height:300px}.gist .page-edit-blob.height-full .CodeMirror,.gist .page-edit-blob.height-full .CodeMirror-scroll{display:flex;flex-direction:column;flex:1 1 auto}.gist .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.gist .diff-table{width:100%;border-collapse:initial}.gist .diff-table .line-comments{padding:10px;vertical-align:top;border-top:1px solid #e1e4e8}.gist .diff-table .line-comments:first-child+.empty-cell{border-left-width:1px}.gist .diff-table tr:not(:last-child) .line-comments{border-top:1px solid #e1e4e8;border-bottom:1px solid #e1e4e8}.gist .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gist .blob-num:hover{color:rgba(27,31,35,.6)}.gist .blob-num:before{content:attr(data-line-number)}.gist .blob-num.non-expandable{cursor:default}.gist .blob-num.non-expandable:hover{color:rgba(27,31,35,.3)}.gist .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.gist .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.gist .blob-code-inner .x-first{border-top-left-radius:.2em;border-bottom-left-radius:.2em}.gist .blob-code-inner .x-last{border-top-right-radius:.2em;border-bottom-right-radius:.2em}.gist .blob-code-inner.highlighted,.gist .blob-code-inner .highlighted{background-color:#fffbdd}.gist .blob-code-marker:before{padding-right:8px;content:attr(data-code-marker)}.gist .blob-code-marker-addition:before{content:"+ "}.gist .blob-code-marker-deletion:before{content:"- "}.gist .blob-code-marker-context:before{content:" "}.gist .soft-wrap .diff-table{table-layout:fixed}.gist .soft-wrap .blob-code{padding-left:18px;text-indent:-7px}.gist .soft-wrap .blob-code-inner{word-wrap:break-word;white-space:pre-wrap}.gist .soft-wrap .no-nl-marker{display:none}.gist .soft-wrap .add-line-comment{margin-left:-28px}.gist .blob-code-hunk,.gist .blob-num-expandable,.gist .blob-num-hunk{color:rgba(27,31,35,.7);vertical-align:middle}.gist .blob-num-expandable,.gist .blob-num-hunk{background-color:#dbedff}.gist .blob-code-hunk{padding-top:4px;padding-bottom:4px;background-color:#f1f8ff;border-width:1px 0}.gist .blob-expanded .blob-code,.gist .blob-expanded .blob-num{background-color:#fafbfc}.gist .blob-expanded+tr:not(.blob-expanded) .blob-code,.gist .blob-expanded+tr:not(.blob-expanded) .blob-num,.gist .blob-expanded .blob-num-hunk,.gist tr:not(.blob-expanded)+.blob-expanded .blob-code,.gist tr:not(.blob-expanded)+.blob-expanded .blob-num{border-top:1px solid #eaecef}.gist .blob-num-expandable{padding:0;font-size:12px;text-align:center}.gist .blob-num-expandable .diff-expander{display:block;width:auto;height:auto;padding:4px 11px 4px 10px;margin-right:-1px;color:#586069;cursor:pointer}.gist .blob-num-expandable .diff-expander .octicon{vertical-align:top}.gist .blob-num-expandable .directional-expander{display:block;width:auto;height:auto;margin-right:-1px;color:#586069;cursor:pointer}.gist .blob-num-expandable .single-expander{padding-top:4px;padding-bottom:4px}.gist .blob-num-expandable .diff-expander:hover,.gist .blob-num-expandable .directional-expander:hover{color:#fff;text-shadow:none;background-color:#0366d6;border-color:#0366d6}.gist .blob-code-addition{background-color:#e6ffed}.gist .blob-code-addition .x{color:#24292e;background-color:#acf2bd}.gist .blob-num-addition{background-color:#cdffd8;border-color:#bef5cb}.gist .blob-code-deletion{background-color:#ffeef0}.gist .blob-code-deletion .x{color:#24292e;background-color:#fdb8c0}.gist .blob-num-deletion{background-color:#ffdce0;border-color:#fdaeb7}.gist .is-selecting,.gist .is-selecting .blob-num{cursor:ns-resize !important}.gist .is-selecting .add-line-comment,.gist .is-selecting a{pointer-events:none;cursor:ns-resize !important}.gist .is-selecting .is-hovered .add-line-comment{opacity:0}.gist .is-selecting.file-diff-split,.gist .is-selecting.file-diff-split .blob-num{cursor:nwse-resize !important}.gist .is-selecting.file-diff-split .add-line-comment,.gist .is-selecting.file-diff-split .empty-cell,.gist .is-selecting.file-diff-split a{pointer-events:none;cursor:nwse-resize !important}.gist .selected-line{position:relative}.gist .selected-line:after{position:absolute;top:0;left:0;display:block;width:100%;height:100%;box-sizing:border-box;pointer-events:none;content:"";background:rgba(255,223,93,.2);mix-blend-mode:multiply}.gist .selected-line.selected-line-top:after{border-top:1px solid #ffd33d}.gist .selected-line.selected-line-bottom:after{border-bottom:1px solid #ffd33d}.gist .selected-line.selected-line-left:after,.gist .selected-line:first-child:after{border-left:1px solid #ffd33d}.gist .selected-line.selected-line-right:after,.gist .selected-line:last-child:after{border-right:1px solid #ffd33d}.gist .is-commenting .selected-line.blob-code:before{position:absolute;top:0;left:-1px;display:block;width:4px;height:100%;content:"";background:#0366d6}.gist .add-line-comment{position:relative;z-index:5;float:left;width:22px;height:22px;margin:-2px -10px -2px -20px;line-height:21px;color:#fff;text-align:center;text-indent:0;cursor:pointer;background-color:#0366d6;background-image:linear-gradient(#0372ef,#0366d6);border-radius:3px;box-shadow:0 1px 4px rgba(27,31,35,.15);opacity:0;transition:transform .1s ease-in-out;transform:scale(.8)}.gist .add-line-comment:hover{transform:scale(1)}.gist .add-line-comment:focus,.is-hovered .gist .add-line-comment{opacity:1}.gist .add-line-comment .octicon{vertical-align:text-top;pointer-events:none}.gist .add-line-comment.octicon-check{background:#333;opacity:1}.gist .inline-comment-form{border:1px solid #dfe2e5;border-radius:3px}.gist .inline-review-comment{margin-top:0 !important;margin-bottom:10px !important}.gist .inline-review-comment .gc:first-child+tr .blob-code,.gist .inline-review-comment .gc:first-child+tr .blob-num{padding-top:5px}.gist .inline-review-comment tr:last-child{border-bottom-right-radius:3px;border-bottom-left-radius:3px}.gist .inline-review-comment tr:last-child .blob-code,.gist .inline-review-comment tr:last-child .blob-num{padding-bottom:8px}.gist .inline-review-comment tr:last-child .blob-code:first-child,.gist .inline-review-comment tr:last-child .blob-num:first-child{border-bottom-left-radius:3px}.gist .inline-review-comment tr:last-child .blob-code:last-child,.gist .inline-review-comment tr:last-child .blob-num:last-child{border-bottom-right-radius:3px}.gist .timeline-inline-comments{width:100%;table-layout:fixed}.gist .show-inline-notes .inline-comments,.gist .timeline-inline-comments .inline-comments{display:table-row}.gist .inline-comments,.gist .inline-comments.is-collapsed{display:none}.gist .inline-comments .line-comments.is-collapsed{visibility:hidden}.gist .inline-comments .line-comments+.blob-num{border-left-width:1px}.gist .inline-comments .timeline-comment{margin-bottom:10px}.gist .comment-holder,.gist .inline-comments .inline-comment-form,.gist .inline-comments .inline-comment-form-container{max-width:780px}.gist .empty-cell+.line-comments,.gist .line-comments+.line-comments{border-left:1px solid #eaecef}.gist .inline-comment-form-container .inline-comment-form,.gist .inline-comment-form-container.open .inline-comment-form-actions{display:none}.gist .inline-comment-form-container .inline-comment-form-actions,.gist .inline-comment-form-container.open .inline-comment-form{display:block}.gist body.full-width .container,.gist body.full-width .container-lg,.gist body.full-width .container-xl,.gist body.split-diff .container,.gist body.split-diff .container-lg,.gist body.split-diff .container-xl{width:100%;max-width:none;padding-right:20px;padding-left:20px}.gist body.full-width .repository-content,.gist body.split-diff .repository-content{width:100%}.gist body.full-width .new-pr-form,.gist body.split-diff .new-pr-form{max-width:980px}.gist .file-diff-split{table-layout:fixed}.gist .file-diff-split .blob-code+.blob-num{border-left:1px solid #f6f8fa}.gist .file-diff-split .blob-code-inner{word-wrap:break-word;white-space:pre-wrap}.gist .file-diff-split .empty-cell{cursor:default;background-color:#fafbfc;border-right-color:#eaecef}@media (max-width:1280px){.gist .file-diff-split .write-selected .comment-form-head{margin-bottom:48px !important}.gist .file-diff-split markdown-toolbar{position:absolute;right:8px;bottom:-40px}}.gist .submodule-diff-stats .octicon-diff-removed{color:#cb2431}.gist .submodule-diff-stats .octicon-diff-renamed{color:#677a85}.gist .submodule-diff-stats .octicon-diff-modified{color:#d0b44c}.gist .submodule-diff-stats .octicon-diff-added{color:#28a745}.gist .BlobToolbar{left:-17px}.gist .BlobToolbar-dropdown{margin-left:-2px}.gist .code-navigation-banner{background:linear-gradient(180deg,rgba(242,248,254,0),rgba(242,248,254,.47))}.gist .code-navigation-banner .code-navigation-banner-illo{background-image:url(code-navigation-banner-illo.svg);background-repeat:no-repeat;background-position:50%}.gist .pl-token.active,.gist .pl-token:hover{cursor:pointer;background:#ffea7f}.gist .task-list-item{list-style-type:none}.gist .task-list-item label{font-weight:400}.gist .task-list-item.enabled label{cursor:pointer}.gist .task-list-item+.task-list-item{margin-top:3px}.gist .task-list-item .handle{display:none}.gist .task-list-item-checkbox{margin:0 .2em .25em -1.6em;vertical-align:middle}.gist .reorderable-task-lists .markdown-body .contains-task-list{padding:0}.gist .reorderable-task-lists .markdown-body li:not(.task-list-item){margin-left:26px}.gist .reorderable-task-lists .markdown-body ol:not(.contains-task-list) li,.gist .reorderable-task-lists .markdown-body ul:not(.contains-task-list) li{margin-left:0}.gist .reorderable-task-lists .markdown-body li p{margin-top:0}.gist .reorderable-task-lists .markdown-body .task-list-item{padding-right:15px;padding-left:42px;margin-right:-15px;margin-left:-15px;border:1px solid transparent}.gist .reorderable-task-lists .markdown-body .task-list-item+.task-list-item{margin-top:0}.gist .reorderable-task-lists .markdown-body .task-list-item .contains-task-list{padding-top:4px}.gist .reorderable-task-lists .markdown-body .task-list-item .handle{display:block;float:left;width:20px;padding:2px 0 0 2px;margin-left:-43px;opacity:0}.gist .reorderable-task-lists .markdown-body .task-list-item .drag-handle{fill:#333}.gist .reorderable-task-lists .markdown-body .task-list-item.hovered>.handle{opacity:1}.gist .reorderable-task-lists .markdown-body .task-list-item.is-dragging{opacity:0}.gist .review-comment-contents .markdown-body .task-list-item{padding-left:42px;margin-right:-12px;margin-left:-12px;border-top-left-radius:3px;border-bottom-left-radius:3px}.gist .review-comment-contents .markdown-body .task-list-item.hovered{border-left-color:#ededed}.gist .highlight{padding:0;margin:0;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;font-weight:400;line-height:1.4;color:#333;background:#fff;border:0}.gist .octospinner,.gist .render-viewer-error,.gist .render-viewer-fatal,.gist .render-viewer-invalid{display:none}.gist iframe.render-viewer{width:100%;height:480px;overflow:hidden;border:0}.gist code,.gist pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace !important}.gist .gist-meta{padding:10px;overflow:hidden;font:12px -apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;color:#586069;background-color:#f7f7f7;border-radius:0 0 3px 3px}.gist .gist-meta a{font-weight:600;color:#666;text-decoration:none;border:0}.gist .gist-data{overflow:auto;word-wrap:normal;background-color:#fff;border-bottom:1px solid #ddd;border-radius:3px 3px 0 0}.gist .gist-file{margin-bottom:1em;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;border:1px solid;border-color:#ddd #ddd #ccc;border-radius:3px}.gist .gist-file article{padding:6px}.gist .gist-file .scroll .gist-data{position:absolute;top:0;right:0;bottom:30px;left:0;overflow:scroll}.gist .gist-file .scroll .gist-meta{position:absolute;right:0;bottom:0;left:0}.gist .blob-num{min-width:inherit}.gist .blob-code,.gist .blob-num{padding:1px 10px !important;background:transparent}.gist .blob-code{text-align:left;border:0}.gist .blob-wrapper table{border-collapse:collapse}.gist table,.gist table tr,.gist table tr td,.gist table tr th{border-collapse:collapse}.gist .blob-wrapper tr:first-child td{padding-top:4px}.gist .markdown-body .anchor{display:none}</style>
</head>
<body>
<h1>
<a id="user-content-fstarpervasives" class="anchor" href="#fstarpervasives" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>FStar.Pervasives</h1>
<p>This is a file from the core library, dependencies must be explicit</p>
<ul>
<li>Opens module <a href="Prims.html">Prims</a>
</li>
<li>Includes module <a href="FStar.Pervasives.Native.html">FStar.Pervasives.Native</a>
</li>
</ul>
<blockquote>
<p>This module is implicitly opened in the scope of all other
modules.</p>
<p>It provides several basic definitions in F* that are common to
most programs. Broadly, these include:</p>
<ul>
<li>
<p>Utility types and functions, like <a href="#id"><code>id</code></a>, <a href="#either"><code>either</code></a>, dependent
tuples, etc.</p>
</li>
<li>
<p>Utility effect definitions, including <a href="#DIV"><code>DIV</code></a> for divergence,
<a href="#EXN"><code>EXN</code></a> of exceptions, <a href="#STATE_h"><code>STATE_h</code></a> a template for state, and (the
poorly named) <a href="#ALL_h"><code>ALL_h</code></a> which combines them all.</p>
</li>
<li>
<p>Some utilities to control proofs, e.g., inversion of inductive
type definitions.</p>
</li>
<li>
<p>Built-in attributes that can be used to decorate definitions and
trigger various kinds of special treatments for those
definitions.</p>
</li>
</ul>
</blockquote>
<h4>
<a id="user-content-remove_unused_type_parameters" class="anchor" href="#remove_unused_type_parameters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>remove_unused_type_parameters</h4>
<p><a href="#remove_unused_type_parameters"><code>remove_unused_type_parameters</code></a></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">remove_unused_type_parameters</span> <span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-c1">int</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tot</span> <span class="pl-c1">unit</span></pre></div>
<p>This attribute is used to decorate signatures in interfaces for
type abbreviations, indicating that the 0-based positional
parameters are unused in the definition and should be eliminated
for extraction.</p>
<p>This is important particularly for use with F# extraction, since
F# does not accept type abbreviations with unused type parameters.</p>
<p>See tests/bug-reports/RemoveUnusedTyparsIFace.A.fsti</p>
<h4>
<a id="user-content-pattern" class="anchor" href="#pattern" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>pattern</h4>
<p>Values of type <a href="#pattern"><code>pattern</code></a> are used to tag <a href="#Lemma"><code>Lemma</code></a>s with SMT
quantifier triggers</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">type</span> <span class="pl-en">pattern</span> <span class="pl-c1">:</span> <span class="pl-c1">Type0</span> <span class="pl-c1">=</span> <span class="pl-c1">unit</span></pre></div>
<h4>
<a id="user-content-smt_pat" class="anchor" href="#smt_pat" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>smt_pat</h4>
<p>The concrete syntax <code>SMTPat</code> desugars to <a href="#smt_pat"><code>smt_pat</code></a></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">smt_pat</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-en">pattern</span></pre></div>
<h4>
<a id="user-content-smt_pat_or" class="anchor" href="#smt_pat_or" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>smt_pat_or</h4>
<p>The concrete syntax <code>SMTPatOr</code> desugars to <a href="#smt_pat_or"><code>smt_pat_or</code></a>. This is
used to represent a disjunction of conjunctions of patterns.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">smt_pat_or</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-c1">(</span><span class="pl-en">list</span> <span class="pl-en">pattern</span><span class="pl-c1">))</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-en">pattern</span></pre></div>
<p>Note, the typing discipline and syntax of patterns is laxer than
it should be. Patterns like <code>SMTPatOr </code>SMTPatOr `...``` are
expressible, but unsupported by F*</p>
<p>TODO: We should tighten this up, perhaps just reusing the
attribute mechanism for patterns.</p>
<h4>
<a id="user-content-lemma" class="anchor" href="#lemma" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Lemma</h4>
<p><a href="#Lemma"><code>Lemma</code></a> is a very widely used effect abbreviation.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-en">effect</span> <span class="pl-c1">Lemma</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">pre</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">post</span><span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-k">squash</span> <span class="pl-en">pre</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Type))</span> <span class="pl-c1">(</span><span class="pl-en">pats</span><span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-en">pattern</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-c1">Pure</span> <span class="pl-en">a</span> <span class="pl-en">pre</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">r</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">post</span> <span class="pl-c1">())</span></pre></div>
<p>It stands for a unit-returning <code>Ghost</code> computation, whose main
value is its logical payload in proving an implication between its
pre- and postcondition.</p>
<p><a href="#Lemma"><code>Lemma</code></a> is desugared specially. The valid forms are:</p>
<p>Lemma (ensures post)
Lemma post <code>SMTPat ...</code>
Lemma (ensures post) <code>SMTPat ...</code>
Lemma (ensures post) (decreases d)
Lemma (ensures post) (decreases d) <code>SMTPat ...</code>
Lemma (requires pre) (ensures post) (decreases d)
Lemma (requires pre) (ensures post) <code>SMTPat ...</code>
Lemma (requires pre) (ensures post) (decreases d) <code>SMTPat ...</code></p>
<p>and</p>
<p>Lemma post    (== Lemma (ensures post))</p>
<p>the squash argument on the postcondition allows to assume the
precondition for the <em>well-formedness</em> of the postcondition.</p>
<h4>
<a id="user-content-spinoff" class="anchor" href="#spinoff" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>spinoff</h4>
<p>In the default mode of operation, all proofs in a verification
condition are bundled into a single SMT query. Sub-terms marked
with the <a href="#spinoff"><code>spinoff</code></a> below are the exception: each of them is
spawned off into a separate SMT query</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">spinoff</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-c1">Type0)</span> <span class="pl-c1">:</span> <span class="pl-c1">Type0</span></pre></div>
<h4>
<a id="user-content-assert_spinoff" class="anchor" href="#assert_spinoff" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>assert_spinoff</h4>
<p>Logically equivalent to assert, but spins off separate query</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">assert_spinoff</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">:</span> <span class="pl-c1">Pure</span> <span class="pl-c1">unit</span> <span class="pl-c1">(</span><span class="pl-en">requires</span> <span class="pl-c1">(</span><span class="pl-en">spinoff</span> <span class="pl-c1">(</span><span class="pl-k">squash</span> <span class="pl-en">p</span><span class="pl-c1">)))</span> <span class="pl-c1">(</span><span class="pl-en">ensures</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">x</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">p</span><span class="pl-c1">))</span></pre></div>
<h4>
<a id="user-content-id" class="anchor" href="#id" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>id</h4>
<p>The polymorphic identity function</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">id</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-en">a</span> <span class="pl-c1">=</span> <span class="pl-en">x</span></pre></div>
<h4>
<a id="user-content-trivial_pure_post" class="anchor" href="#trivial_pure_post" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>trivial_pure_post</h4>
<p>Trivial postconditions for the <code>PURE</code> effect</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">trivial_pure_post</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">:</span> <span class="pl-en">pure_post</span> <span class="pl-en">a</span> <span class="pl-c1">=</span> <span class="pl-k">fun</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">True</span></pre></div>
<h4>
<a id="user-content-ambient" class="anchor" href="#ambient" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ambient</h4>
<p>Sometimes it is convenient to explicit introduce nullary symbols
into the ambient context, so that SMT can appeal to their definitions
even when they are no mentioned explicitly in the program, e.g., when
needed for triggers.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-c1">[</span>@@ <span class="pl-en">remove_unused_type_parameters</span> <span class="pl-c1">[</span><span class="pl-c1">0</span><span class="pl-c1">;</span> <span class="pl-c1">1</span><span class="pl-c1">;]]</span>
<span class="pl-k">val</span> <span class="pl-en">ambient</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Type0</span></pre></div>
<p>Use <code>intro_ambient t</code> for that.
See, e.g., LowStar.Monotonic.Buffer.fst and its usage there for loc_none</p>
<h4>
<a id="user-content-intro_ambient" class="anchor" href="#intro_ambient" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>intro_ambient</h4>
<p>cf. <a href="#ambient"><code>ambient</code></a>, above</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">intro_ambient</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-k">squash</span> <span class="pl-c1">(</span><span class="pl-en">ambient</span> <span class="pl-en">x</span><span class="pl-c1">))</span></pre></div>
<blockquote>
<p>Controlling normalization</p>
</blockquote>
<h4>
<a id="user-content-normalize_term" class="anchor" href="#normalize_term" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>normalize_term</h4>
<p>In any invocation of the F* normalizer, every occurrence of
<code>normalize_term e</code> is reduced to the full normal for of <code>e</code>.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">normalize_term</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-en">a</span></pre></div>
<h4>
<a id="user-content-normalize" class="anchor" href="#normalize" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>normalize</h4>
<p>In any invocation of the F* normalizer, every occurrence of
<code>normalize e</code> is reduced to the full normal for of <code>e</code>.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">normalize</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type0)</span> <span class="pl-c1">:</span> <span class="pl-c1">Type0</span></pre></div>
<h4>
<a id="user-content-norm_step" class="anchor" href="#norm_step" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>norm_step</h4>
<p>Value of <a href="#norm_step"><code>norm_step</code></a> are used to enable specific normalization
steps, controlling how the normalizer reduces terms.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">norm_step</span> <span class="pl-c1">:</span> <span class="pl-c1">Type0</span></pre></div>
<h4>
<a id="user-content-simplify" class="anchor" href="#simplify" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>simplify</h4>
<p>Logical simplification, e.g., <code>P /\ True ~&gt; P</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">simplify</span> <span class="pl-c1">:</span> <span class="pl-en">norm_step</span></pre></div>
<h4>
<a id="user-content-weak" class="anchor" href="#weak" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>weak</h4>
<p>Weak reduction: Do not reduce under binders</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">weak</span> <span class="pl-c1">:</span> <span class="pl-en">norm_step</span></pre></div>
<h4>
<a id="user-content-hnf" class="anchor" href="#hnf" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>hnf</h4>
<p>Head normal form</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">hnf</span> <span class="pl-c1">:</span> <span class="pl-en">norm_step</span></pre></div>
<h4>
<a id="user-content-primops" class="anchor" href="#primops" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>primops</h4>
<p>Reduce primitive operators, e.g., <code>1 + 1 ~&gt; 2</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">primops</span> <span class="pl-c1">:</span> <span class="pl-en">norm_step</span></pre></div>
<h4>
<a id="user-content-delta" class="anchor" href="#delta" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>delta</h4>
<p>Unfold all non-recursive definitions</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">delta</span> <span class="pl-c1">:</span> <span class="pl-en">norm_step</span></pre></div>
<h4>
<a id="user-content-zeta" class="anchor" href="#zeta" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>zeta</h4>
<p>Unroll recursive calls</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">zeta</span> <span class="pl-c1">:</span> <span class="pl-en">norm_step</span></pre></div>
<p>Note: Since F*'s termination check is semantic rather than
syntactically structural, recursive calls in inconsistent contexts,
or recursive evaluation of open terms can diverge.</p>
<p>When asking for the <a href="#zeta"><code>zeta</code></a> step, F* implements a heuristic to
disable <a href="#zeta"><code>zeta</code></a> when reducing terms beneath a blocked match. This
helps prevent some trivial looping behavior. However, it also
means that with <a href="#zeta"><code>zeta</code></a> alone, your term may not reduce as much as
you might want. See <a href="#zeta_full"><code>zeta_full</code></a> for that.</p>
<h4>
<a id="user-content-zeta_full" class="anchor" href="#zeta_full" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>zeta_full</h4>
<p>Unroll recursive calls</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">zeta_full</span> <span class="pl-c1">:</span> <span class="pl-en">norm_step</span></pre></div>
<p>Unlike <a href="#zeta"><code>zeta</code></a>, <a href="#zeta_full"><code>zeta_full</code></a> has no looping prevention
heuristics. F* will try to unroll recursive functions as much as
it can, potentially looping. Use with care.</p>
<p>Note, <a href="#zeta_full"><code>zeta_full</code></a> implies <a href="#zeta"><code>zeta</code></a>.
See <code>tests/micro-benchmarks/ReduceRecUnderMatch.fst</code> for an example.</p>
<h4>
<a id="user-content-iota" class="anchor" href="#iota" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>iota</h4>
<p>Reduce case analysis (i.e., match)</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">iota</span> <span class="pl-c1">:</span> <span class="pl-en">norm_step</span></pre></div>
<h4>
<a id="user-content-nbe" class="anchor" href="#nbe" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>nbe</h4>
<p>Use normalization-by-evaluation, instead of interpretation (experimental)</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">nbe</span> <span class="pl-c1">:</span> <span class="pl-en">norm_step</span></pre></div>
<h4>
<a id="user-content-reify_" class="anchor" href="#reify_" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>reify_</h4>
<p>Reify effectful definitions into their representations</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">reify_</span> <span class="pl-c1">:</span> <span class="pl-en">norm_step</span></pre></div>
<h4>
<a id="user-content-delta_only" class="anchor" href="#delta_only" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>delta_only</h4>
<p>Unlike <a href="#delta"><code>delta</code></a>, unfold definitions for only the names in the given
list. Each string is a fully qualified name like <code>A.M.f</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">delta_only</span> <span class="pl-c1">(</span><span class="pl-en">s</span><span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-c1">string)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-en">norm_step</span></pre></div>
<h4>
<a id="user-content-delta_fully" class="anchor" href="#delta_fully" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>delta_fully</h4>
<p>Unfold definitions for only the names in the given list, but
unfold each definition encountered after unfolding as well.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">delta_fully</span> <span class="pl-c1">(</span><span class="pl-en">s</span><span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-c1">string)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-en">norm_step</span></pre></div>
<p>For example, given</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">f0</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span>
<span class="pl-k">let</span> <span class="pl-en">f1</span> <span class="pl-c1">=</span> <span class="pl-en">f0</span> <span class="pl-c1">+</span> <span class="pl-c1">1</span></pre></div>
<p><code>norm </code>delta_only <code>%f1</code> f1<code>will reduce to</code>f0 + 1<code>. </code>norm <code>delta_fully ``%f1`` f1</code> will reduce to <code>0 + 1</code>.</p>
<p>Each string is a fully qualified name like <code>A.M.f</code>, typically
constructed using a quotation, as in the example above.</p>
<h4>
<a id="user-content-delta_attr" class="anchor" href="#delta_attr" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>delta_attr</h4>
<p>Rather than mention a symbol to unfold by name, it can be
convenient to tag a collection of related symbols with a common
attribute and then to ask the normalizer to reduce them all.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">delta_attr</span> <span class="pl-c1">(</span><span class="pl-en">s</span><span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-c1">string)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-en">norm_step</span></pre></div>
<p>For example, given:</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">irreducible</span> <span class="pl-k">let</span> <span class="pl-en">my_attr</span> <span class="pl-c1">=</span> <span class="pl-c1">()</span>

<span class="pl-c1">`</span>@@<span class="pl-en">my_attr</span><span class="pl-c1">`</span>
<span class="pl-k">let</span> <span class="pl-en">f0</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span>

<span class="pl-c1">`</span>@@<span class="pl-en">my_attr</span><span class="pl-c1">`</span>
<span class="pl-k">let</span> <span class="pl-en">f1</span> <span class="pl-c1">=</span> <span class="pl-en">f0</span> <span class="pl-c1">+</span> <span class="pl-c1">1</span></pre></div>
<p><code>FStarnorm [delta_attr [`%my_attr]] f1</code></p>
<p>will reduce to <code>0 + 1</code>.</p>
<h4>
<a id="user-content-delta_qualifier" class="anchor" href="#delta_qualifier" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>delta_qualifier</h4>
<p>For example, given:</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">delta_qualifier</span> <span class="pl-c1">(</span><span class="pl-en">s</span><span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-c1">string)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-en">norm_step</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">f0</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span>

<span class="pl-k">inline_for_extraction</span>
<span class="pl-k">let</span> <span class="pl-en">f1</span> <span class="pl-c1">=</span> <span class="pl-en">f0</span> <span class="pl-c1">+</span> <span class="pl-c1">1</span>
</pre></div>
<p><code>FStarnorm [delta_qualifier ["unfold"; "inline_for_extraction"]] f1</code></p>
<p>will reduce to <code>0 + 1</code>.</p>
<h4>
<a id="user-content-unmeta" class="anchor" href="#unmeta" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>unmeta</h4>
<p>This step removes the some internal meta nodes during normalization</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">unmeta</span> <span class="pl-c1">:</span> <span class="pl-en">norm_step</span></pre></div>
<p>In most cases you shouldn't need to use this step explicitly</p>
<h4>
<a id="user-content-norm" class="anchor" href="#norm" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>norm</h4>
<p><code>norm s e</code> requests normalization of <code>e</code> with the reduction steps
<code>s</code>.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">norm</span> <span class="pl-c1">(</span><span class="pl-en">s</span><span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-en">norm_step</span><span class="pl-c1">)</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-en">a</span></pre></div>
<h4>
<a id="user-content-assert_norm" class="anchor" href="#assert_norm" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>assert_norm</h4>
<p><code>assert_norm p</code> reduces <code>p</code> as much as possible and then asks the
SMT solver to prove the reduct, concluding <code>p</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-k">assert_norm</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">:</span> <span class="pl-c1">Pure</span> <span class="pl-c1">unit</span> <span class="pl-c1">(</span><span class="pl-en">requires</span> <span class="pl-c1">(</span><span class="pl-en">normalize</span> <span class="pl-en">p</span><span class="pl-c1">))</span> <span class="pl-c1">(</span><span class="pl-en">ensures</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">p</span><span class="pl-c1">))</span></pre></div>
<h4>
<a id="user-content-normalize_term_spec" class="anchor" href="#normalize_term_spec" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>normalize_term_spec</h4>
<p>Sometimes it is convenient to introduce an equation between a term
and its normal form in the context.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">normalize_term_spec</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Lemma</span> <span class="pl-c1">(</span><span class="pl-en">normalize_term</span> <span class="pl-c1">#</span><span class="pl-en">a</span> <span class="pl-en">x</span> <span class="pl-c1">==</span> <span class="pl-en">x</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-normalize_spec" class="anchor" href="#normalize_spec" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>normalize_spec</h4>
<p>Like <a href="#normalize_term_spec"><code>normalize_term_spec</code></a>, but specialized to <code>Type0</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">normalize_spec</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type0)</span> <span class="pl-c1">:</span> <span class="pl-c1">Lemma</span> <span class="pl-c1">(</span><span class="pl-en">normalize</span> <span class="pl-en">a</span> <span class="pl-c1">==</span> <span class="pl-en">a</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-norm_spec" class="anchor" href="#norm_spec" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>norm_spec</h4>
<p>Like <a href="#normalize_term_spec"><code>normalize_term_spec</code></a>, but with specific normalization steps</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">norm_spec</span> <span class="pl-c1">(</span><span class="pl-en">s</span><span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-en">norm_step</span><span class="pl-c1">)</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Lemma</span> <span class="pl-c1">(</span><span class="pl-en">norm</span> <span class="pl-en">s</span> <span class="pl-c1">#</span><span class="pl-en">a</span> <span class="pl-en">x</span> <span class="pl-c1">==</span> <span class="pl-en">x</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-reveal_opaque" class="anchor" href="#reveal_opaque" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>reveal_opaque</h4>
<p>Use the following to expose an <code>"opaque_to_smt"</code> definition to the
solver as: <code>reveal_opaque (</code>%defn) defn`</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">reveal_opaque</span> <span class="pl-c1">(</span><span class="pl-en">s</span><span class="pl-c1">:</span> <span class="pl-c1">string)</span> <span class="pl-c1">=</span> <span class="pl-en">norm_spec</span> <span class="pl-c1">[</span><span class="pl-en">delta_only</span> <span class="pl-c1">[</span><span class="pl-en">s</span><span class="pl-c1">]]</span></pre></div>
<p>Wrappers over pure wp combinators that return a pure_wp type
(with monotonicity refinement)</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">pure_return</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span><span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-en">pure_wp</span> <span class="pl-en">a</span> <span class="pl-c1">=</span>
  <span class="pl-en">reveal_opaque</span> <span class="pl-c1">(`</span>%<span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">)</span> <span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">;</span>
  <span class="pl-en">pure_return0</span> <span class="pl-en">a</span> <span class="pl-en">x</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">pure_bind_wp</span> <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-en">b</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp1</span><span class="pl-c1">:</span><span class="pl-en">pure_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">wp2</span><span class="pl-c1">:(</span><span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">pure_wp</span> <span class="pl-en">b</span><span class="pl-c1">)))</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">pure_wp</span> <span class="pl-en">b</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-en">reveal_opaque</span> <span class="pl-c1">(`</span>%<span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">)</span> <span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">;</span>
  <span class="pl-en">pure_bind_wp0</span> <span class="pl-en">a</span> <span class="pl-en">b</span> <span class="pl-en">wp1</span> <span class="pl-en">wp2</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">pure_if_then_else</span> <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-en">p</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp_then</span> <span class="pl-en">wp_else</span><span class="pl-c1">:</span><span class="pl-en">pure_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">pure_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-en">reveal_opaque</span> <span class="pl-c1">(`</span>%<span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">)</span> <span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">;</span>
  <span class="pl-en">pure_if_then_else0</span> <span class="pl-en">a</span> <span class="pl-en">p</span> <span class="pl-en">wp_then</span> <span class="pl-en">wp_else</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">pure_ite_wp</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp</span><span class="pl-c1">:</span><span class="pl-en">pure_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">pure_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-en">reveal_opaque</span> <span class="pl-c1">(`</span>%<span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">)</span> <span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">;</span>
  <span class="pl-en">pure_ite_wp0</span> <span class="pl-en">a</span> <span class="pl-en">wp</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">pure_close_wp</span> <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-en">b</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp</span><span class="pl-c1">:</span><span class="pl-en">b</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">pure_wp</span> <span class="pl-en">a</span><span class="pl-c1">))</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">pure_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-en">reveal_opaque</span> <span class="pl-c1">(`</span>%<span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">)</span> <span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">;</span>
  <span class="pl-en">pure_close_wp0</span> <span class="pl-en">a</span> <span class="pl-en">b</span> <span class="pl-en">wp</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">pure_null_wp</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">pure_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-en">reveal_opaque</span> <span class="pl-c1">(`</span>%<span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">)</span> <span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">;</span>
  <span class="pl-en">pure_null_wp0</span> <span class="pl-en">a</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-c1">[</span>@@ <span class="pl-s"><span class="pl-pds">"</span>opaque_to_smt<span class="pl-pds">"</span></span><span class="pl-c1">]</span>
<span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">pure_assert_wp</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:Type)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">pure_wp</span> <span class="pl-c1">unit)</span> <span class="pl-c1">=</span>
  <span class="pl-en">reveal_opaque</span> <span class="pl-c1">(`</span>%<span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">)</span> <span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">;</span>
  <span class="pl-en">pure_assert_wp0</span> <span class="pl-en">p</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-c1">[</span>@@ <span class="pl-s"><span class="pl-pds">"</span>opaque_to_smt<span class="pl-pds">"</span></span><span class="pl-c1">]</span>
<span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">pure_assume_wp</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:Type)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">pure_wp</span> <span class="pl-c1">unit)</span> <span class="pl-c1">=</span>
  <span class="pl-en">reveal_opaque</span> <span class="pl-c1">(`</span>%<span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">)</span> <span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">;</span>
  <span class="pl-en">pure_assume_wp0</span> <span class="pl-en">p</span></pre></div>
<blockquote>
<p>The <a href="#DIV"><code>DIV</code></a> effect for divergent computations</p>
<p>The wp-calculus for <a href="#DIV"><code>DIV</code></a> is same as that of <code>PURE</code></p>
</blockquote>
<h4>
<a id="user-content-div" class="anchor" href="#div" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DIV</h4>
<p>The effect of divergence: from a specificational perspective it is
identical to PURE, however the specs are given a partial
correctness interpretation. Computations with the <a href="#DIV"><code>DIV</code></a> effect may
not terminate.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">new_effect</span> <span class="pl-c1">{</span>
  <span class="pl-c1">DIV</span> <span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">:Type</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">wp</span><span class="pl-c1">:</span><span class="pl-en">pure_wp</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Effect</span>
  <span class="pl-k">with</span>
    <span class="pl-en">return_wp</span> <span class="pl-c1">=</span> <span class="pl-en">pure_return</span>
  <span class="pl-c1">;</span> <span class="pl-en">bind_wp</span> <span class="pl-c1">=</span> <span class="pl-en">pure_bind_wp</span>
  <span class="pl-c1">;</span> <span class="pl-en">if_then_else</span> <span class="pl-c1">=</span> <span class="pl-en">pure_if_then_else</span>
  <span class="pl-c1">;</span> <span class="pl-en">ite_wp</span> <span class="pl-c1">=</span> <span class="pl-en">pure_ite_wp</span>
  <span class="pl-c1">;</span> <span class="pl-en">stronger</span> <span class="pl-c1">=</span> <span class="pl-en">pure_stronger</span>
  <span class="pl-c1">;</span> <span class="pl-en">close_wp</span> <span class="pl-c1">=</span> <span class="pl-en">pure_close_wp</span>
  <span class="pl-c1">;</span> <span class="pl-en">trivial</span> <span class="pl-c1">=</span> <span class="pl-en">pure_trivial</span>
<span class="pl-c1">}</span></pre></div>
<p><code>PURE</code> computations can be silently promoted for use in a <a href="#DIV"><code>DIV</code></a> context</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-en">sub_effect</span> <span class="pl-c1">PURE</span> <span class="pl-c1">~&gt;</span> <span class="pl-c1">DIV</span> <span class="pl-c1">{</span> <span class="pl-en">lift_wp</span> <span class="pl-c1">=</span> <span class="pl-en">purewp_id</span> <span class="pl-c1">}</span></pre></div>
<h4>
<a id="user-content-div_hoare_to_wp" class="anchor" href="#div_hoare_to_wp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>div_hoare_to_wp</h4>
<p><code>Div</code> is the Hoare-style counterpart of the wp-indexed <a href="#DIV"><code>DIV</code></a></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">div_hoare_to_wp</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(#</span><span class="pl-en">pre</span><span class="pl-c1">:</span><span class="pl-en">pure_pre</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">post</span><span class="pl-c1">:</span><span class="pl-en">pure_post'</span> <span class="pl-en">a</span> <span class="pl-en">pre</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">pure_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-en">reveal_opaque</span> <span class="pl-c1">(`</span>%<span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">)</span> <span class="pl-en">pure_wp_monotonic</span><span class="pl-c1">;</span>
  <span class="pl-k">fun</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span><span class="pl-en">pure_post</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">pre</span> <span class="pl-c1">/\</span> <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-en">a</span><span class="pl-c1">.</span> <span class="pl-en">post</span> <span class="pl-en">a</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">p</span> <span class="pl-en">a</span><span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-en">effect</span> <span class="pl-c1">Div</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">pre</span><span class="pl-c1">:</span> <span class="pl-en">pure_pre</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">post</span><span class="pl-c1">:</span> <span class="pl-en">pure_post'</span> <span class="pl-en">a</span> <span class="pl-en">pre</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-c1">DIV</span> <span class="pl-en">a</span> <span class="pl-c1">(</span><span class="pl-en">div_hoare_to_wp</span> <span class="pl-en">post</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-dv" class="anchor" href="#dv" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dv</h4>
<p><a href="#Dv"><code>Dv</code></a> is the instance of <a href="#DIV"><code>DIV</code></a> with trivial pre- and postconditions</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-en">effect</span> <span class="pl-c1">Dv</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-c1">DIV</span> <span class="pl-en">a</span> <span class="pl-c1">(</span><span class="pl-en">pure_null_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-ext" class="anchor" href="#ext" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>EXT</h4>
<p>We use the <a href="#EXT"><code>EXT</code></a> effect to underspecify external system calls
as being impure but having no observable effect on the state</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-en">effect</span> <span class="pl-c1">EXT</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-c1">Dv</span> <span class="pl-en">a</span></pre></div>
<blockquote>
<p>The <a href="#STATE_h"><code>STATE_h</code></a> effect template for stateful computations, generic
in the type of the state.</p>
<p>Note, <a href="#STATE_h"><code>STATE_h</code></a> is itself not a computation type in F*, since it
is parameterized by the type of heap. However, instantiations of
<a href="#STATE_h"><code>STATE_h</code></a> with specific types of the heap are computation
types. See, e.g., <code>FStar.ST</code> for such instantiations.</p>
<p>Weakest preconditions for stateful computations transform
<a href="#st_post_h"><code>st_post_h</code></a> postconditions to <a href="#st_pre_h"><code>st_pre_h</code></a> preconditions. Both are
parametric in the type of the state, here denoted by the
<code>heap:Type</code> variable.</p>
</blockquote>
<h4>
<a id="user-content-st_pre_h" class="anchor" href="#st_pre_h" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>st_pre_h</h4>
<p>Preconditions are predicates on the <code>heap</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">st_pre_h</span> <span class="pl-c1">(</span><span class="pl-en">heap</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-en">heap</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type0</span></pre></div>
<h4>
<a id="user-content-st_post_h" class="anchor" href="#st_post_h" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>st_post_h'</h4>
<p>Postconditions relate <code>a</code>-typed results to the final <code>heap</code>, here
refined by some pure proposition <code>pre</code>, typically instantiated to
the precondition applied to the initial <code>heap</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">st_post_h'</span> <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span> <span class="pl-en">pre</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">_</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">{</span><span class="pl-en">pre</span><span class="pl-c1">}</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type0</span></pre></div>
<h4>
<a id="user-content-st_post_h-1" class="anchor" href="#st_post_h-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>st_post_h</h4>
<p>Postconditions without refinements</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">st_post_h</span> <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-en">st_post_h'</span> <span class="pl-en">heap</span> <span class="pl-en">a</span> <span class="pl-c1">True</span></pre></div>
<h4>
<a id="user-content-st_wp_h" class="anchor" href="#st_wp_h" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>st_wp_h</h4>
<p>The type of the main WP-transformer for stateful comptuations</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">st_wp_h</span> <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-en">st_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">st_pre_h</span> <span class="pl-en">heap</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-st_return" class="anchor" href="#st_return" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>st_return</h4>
<p>Returning a value does not transform the state</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">st_return</span> <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">st_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-en">p</span> <span class="pl-en">x</span></pre></div>
<h4>
<a id="user-content-st_bind_wp" class="anchor" href="#st_bind_wp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>st_bind_wp</h4>
<p>Sequential composition of stateful WPs</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">st_bind_wp</span>
      <span class="pl-c1">(</span><span class="pl-en">heap</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span>
      <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-en">b</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span>
      <span class="pl-c1">(</span><span class="pl-en">wp1</span><span class="pl-c1">:</span> <span class="pl-en">st_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span>
      <span class="pl-c1">(</span><span class="pl-en">wp2</span><span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">(</span><span class="pl-en">st_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">b</span><span class="pl-c1">)))</span>
      <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">st_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">b</span><span class="pl-c1">)</span>
      <span class="pl-c1">(</span><span class="pl-en">h0</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">)</span>
     <span class="pl-c1">=</span> <span class="pl-en">wp1</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">a</span> <span class="pl-en">h1</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">wp2</span> <span class="pl-en">a</span> <span class="pl-en">p</span> <span class="pl-en">h1</span><span class="pl-c1">)</span> <span class="pl-en">h0</span></pre></div>
<h4>
<a id="user-content-st_if_then_else" class="anchor" href="#st_if_then_else" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>st_if_then_else</h4>
<p>Branching for stateful WPs</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">st_if_then_else</span>
      <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span> <span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span>
      <span class="pl-c1">(</span><span class="pl-en">wp_then</span> <span class="pl-en">wp_else</span><span class="pl-c1">:</span> <span class="pl-en">st_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span>
      <span class="pl-c1">(</span><span class="pl-en">post</span><span class="pl-c1">:</span> <span class="pl-en">st_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span>
      <span class="pl-c1">(</span><span class="pl-en">h0</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">)</span>
     <span class="pl-c1">=</span> <span class="pl-en">wp_then</span> <span class="pl-en">post</span> <span class="pl-en">h0</span> <span class="pl-c1">/\</span> <span class="pl-c1">(~</span><span class="pl-en">p</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">wp_else</span> <span class="pl-en">post</span> <span class="pl-en">h0</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-st_ite_wp" class="anchor" href="#st_ite_wp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>st_ite_wp</h4>
<p>As with <code>PURE</code> the <code>wp</code> combinator names the postcondition as
<code>k</code> to avoid duplicating it.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">st_ite_wp</span> <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp</span><span class="pl-c1">:</span> <span class="pl-en">st_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">post</span><span class="pl-c1">:</span> <span class="pl-en">st_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">h0</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">k</span><span class="pl-c1">:</span> <span class="pl-en">st_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">).</span>
    <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">h</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">).</span> <span class="pl-c1">{:pattern</span> <span class="pl-c1">(</span><span class="pl-en">guard_free</span> <span class="pl-c1">(</span><span class="pl-en">k</span> <span class="pl-en">x</span> <span class="pl-en">h</span><span class="pl-c1">))}</span> <span class="pl-en">post</span> <span class="pl-en">x</span> <span class="pl-en">h</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">k</span> <span class="pl-en">x</span> <span class="pl-en">h</span><span class="pl-c1">)</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">wp</span> <span class="pl-en">k</span> <span class="pl-en">h0</span></pre></div>
<h4>
<a id="user-content-st_stronger" class="anchor" href="#st_stronger" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>st_stronger</h4>
<p>Subsumption for stateful WPs</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">st_stronger</span> <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp1</span> <span class="pl-en">wp2</span><span class="pl-c1">:</span> <span class="pl-en">st_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">st_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">h</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">).</span> <span class="pl-en">wp1</span> <span class="pl-en">p</span> <span class="pl-en">h</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">wp2</span> <span class="pl-en">p</span> <span class="pl-en">h</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-st_close_wp" class="anchor" href="#st_close_wp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>st_close_wp</h4>
<p>Closing the scope of a binder within a stateful WP</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">st_close_wp</span> <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span> <span class="pl-en">b</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp</span><span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-en">b</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">(</span><span class="pl-en">st_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)))</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">st_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">h</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">b</span><span class="pl-c1">:</span> <span class="pl-en">b</span><span class="pl-c1">).</span> <span class="pl-en">wp</span> <span class="pl-en">b</span> <span class="pl-en">p</span> <span class="pl-en">h</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-st_trivial" class="anchor" href="#st_trivial" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>st_trivial</h4>
<p>Applying a stateful WP to a trivial postcondition</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">st_trivial</span> <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp</span><span class="pl-c1">:</span> <span class="pl-en">st_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-en">h0</span><span class="pl-c1">.</span> <span class="pl-en">wp</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">r</span> <span class="pl-en">h1</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">True</span><span class="pl-c1">)</span> <span class="pl-en">h0</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-state_h" class="anchor" href="#state_h" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>STATE_h</h4>
<p>Introducing a new effect template <a href="#STATE_h"><code>STATE_h</code></a></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">new_effect</span> <span class="pl-c1">{</span>
  <span class="pl-c1">STATE_h</span> <span class="pl-c1">(</span><span class="pl-en">heap</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">:</span> <span class="pl-en">result</span><span class="pl-c1">:</span> <span class="pl-c1">Type</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">wp</span><span class="pl-c1">:</span> <span class="pl-en">st_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">result</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Effect</span>
  <span class="pl-k">with</span>
    <span class="pl-en">return_wp</span> <span class="pl-c1">=</span> <span class="pl-en">st_return</span> <span class="pl-en">heap</span>
  <span class="pl-c1">;</span> <span class="pl-en">bind_wp</span> <span class="pl-c1">=</span> <span class="pl-en">st_bind_wp</span> <span class="pl-en">heap</span>
  <span class="pl-c1">;</span> <span class="pl-en">if_then_else</span> <span class="pl-c1">=</span> <span class="pl-en">st_if_then_else</span> <span class="pl-en">heap</span>
  <span class="pl-c1">;</span> <span class="pl-en">ite_wp</span> <span class="pl-c1">=</span> <span class="pl-en">st_ite_wp</span> <span class="pl-en">heap</span>
  <span class="pl-c1">;</span> <span class="pl-en">stronger</span> <span class="pl-c1">=</span> <span class="pl-en">st_stronger</span> <span class="pl-en">heap</span>
  <span class="pl-c1">;</span> <span class="pl-en">close_wp</span> <span class="pl-c1">=</span> <span class="pl-en">st_close_wp</span> <span class="pl-en">heap</span>
  <span class="pl-c1">;</span> <span class="pl-en">trivial</span> <span class="pl-c1">=</span> <span class="pl-en">st_trivial</span> <span class="pl-en">heap</span>
<span class="pl-c1">}</span></pre></div>
<blockquote>
<p>The <a href="#EXN"><code>EXN</code></a> effect for computations that may raise exceptions or
fatal errors</p>
<p>Weakest preconditions for stateful computations transform
<a href="#ex_post"><code>ex_post</code></a> postconditions (predicates on <a href="#result"><code>result</code></a>s) to <a href="#ex_pre"><code>ex_pre</code></a>
precondition propositions.</p>
</blockquote>
<h4>
<a id="user-content-result" class="anchor" href="#result" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>result</h4>
<p>Normal results are represented using <code>V x</code>.
Handleable exceptions are represented <code>E e</code>.
Fatal errors are <code>Err msg</code>.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">noeq</span>
<span class="pl-k">type</span> <span class="pl-en">result</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span>
  <span class="pl-c1">|</span> <span class="pl-c1">V</span> <span class="pl-c1">:</span> <span class="pl-en">v</span><span class="pl-c1">:</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">result</span> <span class="pl-en">a</span>
  <span class="pl-c1">|</span> <span class="pl-c1">E</span> <span class="pl-c1">:</span> <span class="pl-en">e</span><span class="pl-c1">:</span> <span class="pl-en">exn</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">result</span> <span class="pl-en">a</span>
  <span class="pl-c1">|</span> <span class="pl-c1">Err</span> <span class="pl-c1">:</span> <span class="pl-en">msg</span><span class="pl-c1">:</span> <span class="pl-c1">string</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">result</span> <span class="pl-en">a</span></pre></div>
<h4>
<a id="user-content-ex_pre" class="anchor" href="#ex_pre" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ex_pre</h4>
<p>Exceptional preconditions are just propositions</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">ex_pre</span> <span class="pl-c1">=</span> <span class="pl-c1">Type0</span></pre></div>
<h4>
<a id="user-content-ex_post" class="anchor" href="#ex_post" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ex_post'</h4>
<p>Postconditions on results refined by a precondition</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">ex_post'</span> <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-en">pre</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-c1">_</span><span class="pl-c1">:</span> <span class="pl-en">result</span> <span class="pl-en">a</span> <span class="pl-c1">{</span><span class="pl-en">pre</span><span class="pl-c1">}</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type0</span></pre></div>
<h4>
<a id="user-content-ex_post-1" class="anchor" href="#ex_post-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ex_post</h4>
<p>Postconditions on results</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">ex_post</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-en">ex_post'</span> <span class="pl-en">a</span> <span class="pl-c1">True</span></pre></div>
<h4>
<a id="user-content-ex_wp" class="anchor" href="#ex_wp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ex_wp</h4>
<p>Exceptions WP-predicate transformers</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">ex_wp</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-en">ex_post</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-en">ex_pre</span></pre></div>
<h4>
<a id="user-content-ex_return" class="anchor" href="#ex_return" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ex_return</h4>
<p>Returning a value <code>x</code> normally promotes it to the <code>V x</code> result</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">ex_return</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">ex_post</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type0</span> <span class="pl-c1">=</span> <span class="pl-en">p</span> <span class="pl-c1">(</span><span class="pl-c1">V</span> <span class="pl-en">x</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-ex_bind_wp" class="anchor" href="#ex_bind_wp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ex_bind_wp</h4>
<p>Sequential composition of exception-raising code requires case analysing
the result of the first computation before "running" the second one</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">ex_bind_wp</span> <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-en">b</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp1</span><span class="pl-c1">:</span> <span class="pl-en">ex_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">wp2</span><span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">(</span><span class="pl-en">ex_wp</span> <span class="pl-en">b</span><span class="pl-c1">)))</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">ex_post</span> <span class="pl-en">b</span><span class="pl-c1">)</span>
    <span class="pl-c1">:</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type0</span> <span class="pl-c1">=</span>
  <span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">k</span><span class="pl-c1">:</span> <span class="pl-en">ex_post</span> <span class="pl-en">b</span><span class="pl-c1">).</span>
    <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">rb</span><span class="pl-c1">:</span> <span class="pl-en">result</span> <span class="pl-en">b</span><span class="pl-c1">).</span> <span class="pl-c1">{:pattern</span> <span class="pl-c1">(</span><span class="pl-en">guard_free</span> <span class="pl-c1">(</span><span class="pl-en">k</span> <span class="pl-en">rb</span><span class="pl-c1">))}</span> <span class="pl-en">p</span> <span class="pl-en">rb</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">k</span> <span class="pl-en">rb</span><span class="pl-c1">)</span> <span class="pl-c1">==&gt;</span>
    <span class="pl-c1">(</span><span class="pl-en">wp1</span> <span class="pl-c1">(</span><span class="pl-k">function</span>
          <span class="pl-c1">|</span> <span class="pl-c1">V</span> <span class="pl-en">ra1</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">wp2</span> <span class="pl-en">ra1</span> <span class="pl-en">k</span>
          <span class="pl-c1">|</span> <span class="pl-c1">E</span> <span class="pl-en">e</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">k</span> <span class="pl-c1">(</span><span class="pl-c1">E</span> <span class="pl-en">e</span><span class="pl-c1">)</span>
          <span class="pl-c1">|</span> <span class="pl-c1">Err</span> <span class="pl-en">m</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">k</span> <span class="pl-c1">(</span><span class="pl-c1">Err</span> <span class="pl-en">m</span><span class="pl-c1">)))</span></pre></div>
<h4>
<a id="user-content-ex_if_then_else" class="anchor" href="#ex_if_then_else" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ex_if_then_else</h4>
<p>As for other effects, branching in <a href="#ex_wp"><code>ex_wp</code></a> appears in two forms.
First, a simple case analysis on <code>p</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">ex_if_then_else</span> <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp_then</span> <span class="pl-en">wp_else</span><span class="pl-c1">:</span> <span class="pl-en">ex_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">post</span><span class="pl-c1">:</span> <span class="pl-en">ex_post</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-en">wp_then</span> <span class="pl-en">post</span> <span class="pl-c1">/\</span> <span class="pl-c1">(~</span><span class="pl-en">p</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">wp_else</span> <span class="pl-en">post</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-ex_ite_wp" class="anchor" href="#ex_ite_wp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ex_ite_wp</h4>
<p>Naming continuations for use with branching</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">ex_ite_wp</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp</span><span class="pl-c1">:</span> <span class="pl-en">ex_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">post</span><span class="pl-c1">:</span> <span class="pl-en">ex_post</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">k</span><span class="pl-c1">:</span> <span class="pl-en">ex_post</span> <span class="pl-en">a</span><span class="pl-c1">).</span>
    <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">rb</span><span class="pl-c1">:</span> <span class="pl-en">result</span> <span class="pl-en">a</span><span class="pl-c1">).</span> <span class="pl-c1">{:pattern</span> <span class="pl-c1">(</span><span class="pl-en">guard_free</span> <span class="pl-c1">(</span><span class="pl-en">k</span> <span class="pl-en">rb</span><span class="pl-c1">))}</span> <span class="pl-en">post</span> <span class="pl-en">rb</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">k</span> <span class="pl-en">rb</span><span class="pl-c1">)</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">wp</span> <span class="pl-en">k</span></pre></div>
<h4>
<a id="user-content-ex_stronger" class="anchor" href="#ex_stronger" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ex_stronger</h4>
<p>Subsumption for exceptional WPs</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">ex_stronger</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp1</span> <span class="pl-en">wp2</span><span class="pl-c1">:</span> <span class="pl-en">ex_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">ex_post</span> <span class="pl-en">a</span><span class="pl-c1">).</span> <span class="pl-en">wp1</span> <span class="pl-en">p</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">wp2</span> <span class="pl-en">p</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-ex_close_wp" class="anchor" href="#ex_close_wp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ex_close_wp</h4>
<p>Closing the scope of a binder for exceptional WPs</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">ex_close_wp</span> <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-en">b</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp</span><span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-en">b</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">(</span><span class="pl-en">ex_wp</span> <span class="pl-en">a</span><span class="pl-c1">)))</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">ex_post</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">b</span><span class="pl-c1">:</span> <span class="pl-en">b</span><span class="pl-c1">).</span> <span class="pl-en">wp</span> <span class="pl-en">b</span> <span class="pl-en">p</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-ex_trivial" class="anchor" href="#ex_trivial" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ex_trivial</h4>
<p>Applying a computation with a trivial poscondition</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">ex_trivial</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp</span><span class="pl-c1">:</span> <span class="pl-en">ex_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-en">wp</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">r</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">True</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-exn" class="anchor" href="#exn" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>EXN</h4>
<p>Introduce a new effect for <a href="#EXN"><code>EXN</code></a></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">new_effect</span> <span class="pl-c1">{</span>
  <span class="pl-c1">EXN</span> <span class="pl-c1">:</span> <span class="pl-en">result</span><span class="pl-c1">:</span> <span class="pl-c1">Type</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">wp</span><span class="pl-c1">:</span> <span class="pl-en">ex_wp</span> <span class="pl-en">result</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Effect</span>
  <span class="pl-k">with</span>
    <span class="pl-en">return_wp</span> <span class="pl-c1">=</span> <span class="pl-en">ex_return</span>
  <span class="pl-c1">;</span> <span class="pl-en">bind_wp</span> <span class="pl-c1">=</span> <span class="pl-en">ex_bind_wp</span>
  <span class="pl-c1">;</span> <span class="pl-en">if_then_else</span> <span class="pl-c1">=</span> <span class="pl-en">ex_if_then_else</span>
  <span class="pl-c1">;</span> <span class="pl-en">ite_wp</span> <span class="pl-c1">=</span> <span class="pl-en">ex_ite_wp</span>
  <span class="pl-c1">;</span> <span class="pl-en">stronger</span> <span class="pl-c1">=</span> <span class="pl-en">ex_stronger</span>
  <span class="pl-c1">;</span> <span class="pl-en">close_wp</span> <span class="pl-c1">=</span> <span class="pl-en">ex_close_wp</span>
  <span class="pl-c1">;</span> <span class="pl-en">trivial</span> <span class="pl-c1">=</span> <span class="pl-en">ex_trivial</span>
<span class="pl-c1">}</span></pre></div>
<h4>
<a id="user-content-exn-1" class="anchor" href="#exn-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exn</h4>
<p>A Hoare-style abbreviation for EXN</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-en">effect</span> <span class="pl-c1">Exn</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">pre</span><span class="pl-c1">:</span> <span class="pl-en">ex_pre</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">post</span><span class="pl-c1">:</span> <span class="pl-en">ex_post'</span> <span class="pl-en">a</span> <span class="pl-en">pre</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-c1">EXN</span> <span class="pl-en">a</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">ex_post</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">pre</span> <span class="pl-c1">/\</span> <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">r</span><span class="pl-c1">:</span> <span class="pl-en">result</span> <span class="pl-en">a</span><span class="pl-c1">).</span> <span class="pl-en">post</span> <span class="pl-en">r</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">p</span> <span class="pl-en">r</span><span class="pl-c1">))</span></pre></div>
<h4>
<a id="user-content-lift_div_exn" class="anchor" href="#lift_div_exn" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>lift_div_exn</h4>
<p>We include divergence in exceptions.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">lift_div_exn</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp</span><span class="pl-c1">:</span> <span class="pl-en">pure_wp</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">ex_post</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-en">wp</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">p</span> <span class="pl-c1">(</span><span class="pl-c1">V</span> <span class="pl-en">a</span><span class="pl-c1">))</span>
<span class="pl-en">sub_effect</span> <span class="pl-c1">DIV</span> <span class="pl-c1">~&gt;</span> <span class="pl-c1">EXN</span> <span class="pl-c1">{</span> <span class="pl-en">lift_wp</span> <span class="pl-c1">=</span> <span class="pl-en">lift_div_exn</span> <span class="pl-c1">}</span></pre></div>
<p>NOTE: BE WARNED, CODE IN THE <a href="#EXN"><code>EXN</code></a> EFFECT IS ONLY CHECKED FOR
PARTIAL CORRECTNESS</p>
<h4>
<a id="user-content-ex" class="anchor" href="#ex" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ex</h4>
<p>A variant of <a href="#Exn"><code>Exn</code></a> with trivial pre- and postconditions</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-en">effect</span> <span class="pl-c1">Ex</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-c1">Exn</span> <span class="pl-en">a</span> <span class="pl-c1">True</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">v</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">True</span><span class="pl-c1">)</span></pre></div>
<blockquote>
<p>The <a href="#ALL_h"><code>ALL_h</code></a> effect template for computations that may diverge,
raise exceptions or fatal errors, and uses a generic state.</p>
<p>Note, this effect is poorly named, particularly as F* has since
gained many more user-defined effect. We no longer have an effect
that includes all others.</p>
<p>We might rename this in the future to something like <code>StExnDiv_h</code>.</p>
<p>We layer state on top of exceptions, meaning that raising an
exception does not discard the state.</p>
<p>As with <a href="#STATE_h"><code>STATE_h</code></a>, <a href="#ALL_h"><code>ALL_h</code></a> is not a computation type, though its
instantiation with a specific type of <code>heap</code> (in FStar.All) is.</p>
</blockquote>
<h4>
<a id="user-content-all_pre_h" class="anchor" href="#all_pre_h" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>all_pre_h</h4>
<p><a href="#all_pre_h"><code>all_pre_h</code></a> is a predicate on the initial state</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">all_pre_h</span> <span class="pl-c1">(</span><span class="pl-en">h</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-en">h</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type0</span></pre></div>
<h4>
<a id="user-content-all_post_h" class="anchor" href="#all_post_h" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>all_post_h'</h4>
<p>Postconditions relate <a href="#result"><code>result</code></a>s to final <code>heap</code>s refined by a precondition</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">all_post_h'</span> <span class="pl-c1">(</span><span class="pl-en">h</span> <span class="pl-en">a</span> <span class="pl-en">pre</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-en">result</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">_</span><span class="pl-c1">:</span> <span class="pl-en">h</span><span class="pl-c1">{</span><span class="pl-en">pre</span><span class="pl-c1">}</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type0</span></pre></div>
<h4>
<a id="user-content-all_post_h-1" class="anchor" href="#all_post_h-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>all_post_h</h4>
<p>A variant of <a href="#all_post_h'"><code>all_post_h'</code></a> without the precondition refinement</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">all_post_h</span> <span class="pl-c1">(</span><span class="pl-en">h</span> <span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-en">all_post_h'</span> <span class="pl-en">h</span> <span class="pl-en">a</span> <span class="pl-c1">True</span></pre></div>
<h4>
<a id="user-content-all_wp_h" class="anchor" href="#all_wp_h" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>all_wp_h</h4>
<p>WP predicate transformers for the <code>All_h</code> effect template</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">all_wp_h</span> <span class="pl-c1">(</span><span class="pl-en">h</span> <span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">=</span> <span class="pl-en">all_post_h</span> <span class="pl-en">h</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">all_pre_h</span> <span class="pl-en">h</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-all_return" class="anchor" href="#all_return" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>all_return</h4>
<p>Returning a value <code>x</code> normally promotes it to the <code>V x</code> result
without touching the <code>heap</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">all_return</span> <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">all_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-en">p</span> <span class="pl-c1">(</span><span class="pl-c1">V</span> <span class="pl-en">x</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-all_bind_wp" class="anchor" href="#all_bind_wp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>all_bind_wp</h4>
<p>Sequential composition for <a href="#ALL_h"><code>ALL_h</code></a> is like <a href="#EXN"><code>EXN</code></a>: case analysis of
the exceptional result before "running" the continuation</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">all_bind_wp</span>
      <span class="pl-c1">(</span><span class="pl-en">heap</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span>
      <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-en">b</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span>
      <span class="pl-c1">(</span><span class="pl-en">wp1</span><span class="pl-c1">:</span> <span class="pl-en">all_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span>
      <span class="pl-c1">(</span><span class="pl-en">wp2</span><span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">(</span><span class="pl-en">all_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">b</span><span class="pl-c1">)))</span>
      <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">all_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">b</span><span class="pl-c1">)</span>
      <span class="pl-c1">(</span><span class="pl-en">h0</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">)</span>
    <span class="pl-c1">:</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type0</span> <span class="pl-c1">=</span>
  <span class="pl-en">wp1</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">ra</span> <span class="pl-en">h1</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-c1">(</span><span class="pl-k">match</span> <span class="pl-en">ra</span> <span class="pl-k">with</span>
          <span class="pl-c1">|</span> <span class="pl-c1">V</span> <span class="pl-en">v</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">wp2</span> <span class="pl-en">v</span> <span class="pl-en">p</span> <span class="pl-en">h1</span>
          <span class="pl-c1">|</span> <span class="pl-c1">E</span> <span class="pl-en">e</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">p</span> <span class="pl-c1">(</span><span class="pl-c1">E</span> <span class="pl-en">e</span><span class="pl-c1">)</span> <span class="pl-en">h1</span>
          <span class="pl-c1">|</span> <span class="pl-c1">Err</span> <span class="pl-en">msg</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">p</span> <span class="pl-c1">(</span><span class="pl-c1">Err</span> <span class="pl-en">msg</span><span class="pl-c1">)</span> <span class="pl-en">h1</span><span class="pl-c1">))</span>
    <span class="pl-en">h0</span></pre></div>
<h4>
<a id="user-content-all_if_then_else" class="anchor" href="#all_if_then_else" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>all_if_then_else</h4>
<p>Case analysis in <a href="#ALL_h"><code>ALL_h</code></a></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">all_if_then_else</span>
      <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span> <span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span>
      <span class="pl-c1">(</span><span class="pl-en">wp_then</span> <span class="pl-en">wp_else</span><span class="pl-c1">:</span> <span class="pl-en">all_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span>
      <span class="pl-c1">(</span><span class="pl-en">post</span><span class="pl-c1">:</span> <span class="pl-en">all_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span>
      <span class="pl-c1">(</span><span class="pl-en">h0</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">)</span>
     <span class="pl-c1">=</span> <span class="pl-en">wp_then</span> <span class="pl-en">post</span> <span class="pl-en">h0</span> <span class="pl-c1">/\</span> <span class="pl-c1">(~</span><span class="pl-en">p</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">wp_else</span> <span class="pl-en">post</span> <span class="pl-en">h0</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-all_ite_wp" class="anchor" href="#all_ite_wp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>all_ite_wp</h4>
<p>Naming postcondition for better sharing in <a href="#ALL_h"><code>ALL_h</code></a></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">all_ite_wp</span> <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp</span><span class="pl-c1">:</span> <span class="pl-en">all_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">post</span><span class="pl-c1">:</span> <span class="pl-en">all_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">h0</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">k</span><span class="pl-c1">:</span> <span class="pl-en">all_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">).</span>
    <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">result</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">h</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">).</span> <span class="pl-c1">{:pattern</span> <span class="pl-c1">(</span><span class="pl-en">guard_free</span> <span class="pl-c1">(</span><span class="pl-en">k</span> <span class="pl-en">x</span> <span class="pl-en">h</span><span class="pl-c1">))}</span> <span class="pl-en">post</span> <span class="pl-en">x</span> <span class="pl-en">h</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">k</span> <span class="pl-en">x</span> <span class="pl-en">h</span><span class="pl-c1">)</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">wp</span> <span class="pl-en">k</span> <span class="pl-en">h0</span></pre></div>
<h4>
<a id="user-content-all_stronger" class="anchor" href="#all_stronger" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>all_stronger</h4>
<p>Subsumption in <a href="#ALL_h"><code>ALL_h</code></a></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">all_stronger</span> <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp1</span> <span class="pl-en">wp2</span><span class="pl-c1">:</span> <span class="pl-en">all_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">all_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">h</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">).</span> <span class="pl-en">wp1</span> <span class="pl-en">p</span> <span class="pl-en">h</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">wp2</span> <span class="pl-en">p</span> <span class="pl-en">h</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-all_close_wp" class="anchor" href="#all_close_wp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>all_close_wp</h4>
<p>Closing a binder in the scope of an <a href="#ALL_h"><code>ALL_h</code></a> wp</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">all_close_wp</span>
      <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span> <span class="pl-en">b</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span>
      <span class="pl-c1">(</span><span class="pl-en">wp</span><span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-en">b</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">(</span><span class="pl-en">all_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)))</span>
      <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span> <span class="pl-en">all_post_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span>
      <span class="pl-c1">(</span><span class="pl-en">h</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">)</span>
     <span class="pl-c1">=</span> <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">b</span><span class="pl-c1">:</span> <span class="pl-en">b</span><span class="pl-c1">).</span> <span class="pl-en">wp</span> <span class="pl-en">b</span> <span class="pl-en">p</span> <span class="pl-en">h</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-all_trivial" class="anchor" href="#all_trivial" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>all_trivial</h4>
<p>Applying an <a href="#ALL_h"><code>ALL_h</code></a> wp to a trivial postcondition</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span>
<span class="pl-k">let</span> <span class="pl-en">all_trivial</span> <span class="pl-c1">(</span><span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">wp</span><span class="pl-c1">:</span> <span class="pl-en">all_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">h0</span><span class="pl-c1">:</span> <span class="pl-en">heap</span><span class="pl-c1">).</span> <span class="pl-en">wp</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">r</span> <span class="pl-en">h1</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">True</span><span class="pl-c1">)</span> <span class="pl-en">h0</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-all_h" class="anchor" href="#all_h" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ALL_h</h4>
<p>Introducing the <a href="#ALL_h"><code>ALL_h</code></a> effect template</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">new_effect</span> <span class="pl-c1">{</span>
  <span class="pl-c1">ALL_h</span> <span class="pl-c1">(</span><span class="pl-en">heap</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">wp</span><span class="pl-c1">:</span> <span class="pl-en">all_wp_h</span> <span class="pl-en">heap</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Effect</span>
  <span class="pl-k">with</span>
    <span class="pl-en">return_wp</span> <span class="pl-c1">=</span> <span class="pl-en">all_return</span> <span class="pl-en">heap</span>
  <span class="pl-c1">;</span> <span class="pl-en">bind_wp</span> <span class="pl-c1">=</span> <span class="pl-en">all_bind_wp</span> <span class="pl-en">heap</span>
  <span class="pl-c1">;</span> <span class="pl-en">if_then_else</span> <span class="pl-c1">=</span> <span class="pl-en">all_if_then_else</span> <span class="pl-en">heap</span>
  <span class="pl-c1">;</span> <span class="pl-en">ite_wp</span> <span class="pl-c1">=</span> <span class="pl-en">all_ite_wp</span> <span class="pl-en">heap</span>
  <span class="pl-c1">;</span> <span class="pl-en">stronger</span> <span class="pl-c1">=</span> <span class="pl-en">all_stronger</span> <span class="pl-en">heap</span>
  <span class="pl-c1">;</span> <span class="pl-en">close_wp</span> <span class="pl-c1">=</span> <span class="pl-en">all_close_wp</span> <span class="pl-en">heap</span>
  <span class="pl-c1">;</span> <span class="pl-en">trivial</span> <span class="pl-c1">=</span> <span class="pl-en">all_trivial</span> <span class="pl-en">heap</span>
<span class="pl-c1">}</span></pre></div>
<h4>
<a id="user-content-inversion" class="anchor" href="#inversion" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>inversion</h4>
<p>Controlling inversions of inductive type</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-c1">[</span>@@ <span class="pl-en">remove_unused_type_parameters</span> <span class="pl-c1">[</span><span class="pl-c1">0</span><span class="pl-c1">]]</span>
<span class="pl-k">val</span> <span class="pl-en">inversion</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">:</span> <span class="pl-c1">Type0</span></pre></div>
<p>Given a value of an inductive type <code>v:t</code>, where <code>t = A | B</code>, the SMT
solver can only prove that <code>v=A \/ v=B</code> by <em>inverting</em> <code>t</code>. This
inversion is controlled by the <code>ifuel</code> setting, which usually limits
the recursion depth of the number of such inversions that the solver
can perform.</p>
<p>The <a href="#inversion"><code>inversion</code></a> predicate below is a way to circumvent the
<code>ifuel</code>-based restrictions on inversion depth. In particular, if the
<code>inversion t</code> is available in the SMT solver's context, it is free to
invert <code>t</code> infinitely, regardless of the <code>ifuel</code> setting.</p>
<p>Be careful using this, since it explicitly subverts the <code>ifuel</code>
setting. If used unwisely, this can lead to very poor SMT solver
performance.</p>
<h4>
<a id="user-content-allow_inversion" class="anchor" href="#allow_inversion" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>allow_inversion</h4>
<p>To introduce <code>inversion t</code> in the SMT solver's context, call
<code>allow_inverson t</code>.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">allow_inversion</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">:</span> <span class="pl-c1">Pure</span> <span class="pl-c1">unit</span> <span class="pl-c1">(</span><span class="pl-en">requires</span> <span class="pl-c1">True</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">ensures</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">x</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">inversion</span> <span class="pl-en">a</span><span class="pl-c1">))</span></pre></div>
<h4>
<a id="user-content-invertoption" class="anchor" href="#invertoption" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>invertOption</h4>
<p>Since the <code>option</code> type is so common, we always allow inverting
options, regardless of <code>ifuel</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">invertOption</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span>
    <span class="pl-c1">:</span> <span class="pl-c1">Lemma</span> <span class="pl-c1">(</span><span class="pl-en">requires</span> <span class="pl-c1">True</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">ensures</span> <span class="pl-c1">(</span><span class="pl-k">forall</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">option</span> <span class="pl-en">a</span><span class="pl-c1">).</span> <span class="pl-c1">None</span><span class="pl-c1">?</span> <span class="pl-en">x</span> <span class="pl-c1">\/</span> <span class="pl-c1">Some</span><span class="pl-c1">?</span> <span class="pl-en">x</span><span class="pl-c1">))</span> <span class="pl-c1">[</span><span class="pl-k">SMTPat</span> <span class="pl-c1">(</span><span class="pl-en">option</span> <span class="pl-en">a</span><span class="pl-c1">)]</span></pre></div>
<h4>
<a id="user-content-either" class="anchor" href="#either" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>either</h4>
<p>Values of type <code>a</code> or type <code>b</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">type</span> <span class="pl-en">either</span> <span class="pl-en">a</span> <span class="pl-en">b</span> <span class="pl-c1">=</span>
  <span class="pl-c1">|</span> <span class="pl-c1">Inl</span> <span class="pl-c1">:</span> <span class="pl-en">v</span><span class="pl-c1">:</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">either</span> <span class="pl-en">a</span> <span class="pl-en">b</span>
  <span class="pl-c1">|</span> <span class="pl-c1">Inr</span> <span class="pl-c1">:</span> <span class="pl-en">v</span><span class="pl-c1">:</span> <span class="pl-en">b</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">either</span> <span class="pl-en">a</span> <span class="pl-en">b</span></pre></div>
<h4>
<a id="user-content-dfst" class="anchor" href="#dfst" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>dfst</h4>
<p>Projections for the components of a dependent pair</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">dfst</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(#</span><span class="pl-en">b</span><span class="pl-c1">:</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">t</span><span class="pl-c1">:</span> <span class="pl-en">dtuple2</span> <span class="pl-en">a</span> <span class="pl-en">b</span><span class="pl-c1">)</span>
    <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-en">a</span>
  <span class="pl-c1">=</span> <span class="pl-c1">Mkdtuple2</span><span class="pl-c1">?.</span><span class="pl-en">_1</span> <span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">dsnd</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(#</span><span class="pl-en">b</span><span class="pl-c1">:</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">t</span><span class="pl-c1">:</span> <span class="pl-en">dtuple2</span> <span class="pl-en">a</span> <span class="pl-en">b</span><span class="pl-c1">)</span>
    <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">b</span>  <span class="pl-c1">(</span><span class="pl-c1">Mkdtuple2</span><span class="pl-c1">?.</span><span class="pl-en">_1</span> <span class="pl-en">t</span><span class="pl-c1">))</span>
  <span class="pl-c1">=</span> <span class="pl-c1">Mkdtuple2</span><span class="pl-c1">?.</span><span class="pl-en">_2</span> <span class="pl-en">t</span></pre></div>
<h4>
<a id="user-content-dtuple3" class="anchor" href="#dtuple3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>dtuple3</h4>
<p>Dependent triples, with sugar <code>x:a &amp; y:b x &amp; c x y</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unopteq</span>
<span class="pl-k">type</span> <span class="pl-en">dtuple3</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">b</span><span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type))</span> <span class="pl-c1">(</span><span class="pl-en">c</span><span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">b</span> <span class="pl-en">x</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type))</span> <span class="pl-c1">=</span>
  <span class="pl-c1">|</span> <span class="pl-c1">Mkdtuple3</span> <span class="pl-c1">:</span> <span class="pl-en">_1</span><span class="pl-c1">:</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">_2</span><span class="pl-c1">:</span> <span class="pl-en">b</span> <span class="pl-en">_1</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">_3</span><span class="pl-c1">:</span> <span class="pl-en">c</span> <span class="pl-en">_1</span> <span class="pl-en">_2</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">dtuple3</span> <span class="pl-en">a</span> <span class="pl-en">b</span> <span class="pl-en">c</span></pre></div>
<h4>
<a id="user-content-dtuple4" class="anchor" href="#dtuple4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>dtuple4</h4>
<p>Dependent quadruples, with sugar <code>x:a &amp; y:b x &amp; z:c x y &amp; d x y z</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unopteq</span>
<span class="pl-k">type</span> <span class="pl-en">dtuple4</span>
  <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">b</span><span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type))</span> <span class="pl-c1">(</span><span class="pl-en">c</span><span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">b</span> <span class="pl-en">x</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type))</span>
  <span class="pl-c1">(</span><span class="pl-en">d</span><span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">y</span><span class="pl-c1">:</span> <span class="pl-en">b</span> <span class="pl-en">x</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">z</span><span class="pl-c1">:</span> <span class="pl-en">c</span> <span class="pl-en">x</span> <span class="pl-en">y</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">GTot</span> <span class="pl-c1">Type))</span>
  <span class="pl-c1">=</span> <span class="pl-c1">|</span> <span class="pl-c1">Mkdtuple4</span> <span class="pl-c1">:</span> <span class="pl-en">_1</span><span class="pl-c1">:</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">_2</span><span class="pl-c1">:</span> <span class="pl-en">b</span> <span class="pl-en">_1</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">_3</span><span class="pl-c1">:</span> <span class="pl-en">c</span> <span class="pl-en">_1</span> <span class="pl-en">_2</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">_4</span><span class="pl-c1">:</span> <span class="pl-en">d</span> <span class="pl-en">_1</span> <span class="pl-en">_2</span> <span class="pl-en">_3</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">dtuple4</span> <span class="pl-en">a</span> <span class="pl-en">b</span> <span class="pl-en">c</span> <span class="pl-en">d</span></pre></div>
<h4>
<a id="user-content-ignore" class="anchor" href="#ignore" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ignore</h4>
<p>Explicitly discarding a value</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">ignore</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span> <span class="pl-c1">()</span></pre></div>
<h4>
<a id="user-content-false_elim" class="anchor" href="#false_elim" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>false_elim</h4>
<p>In a context where <code>false</code> is provable, you can prove that any
type <code>a</code> is inhabited.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">false_elim</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">u</span><span class="pl-c1">:</span> <span class="pl-c1">unit{</span><span class="pl-c1">False</span><span class="pl-c1">})</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-en">a</span></pre></div>
<p>There are many proofs of this fact in F*. Here, in the implementation, we build an
infinitely looping function, since the termination check succeeds
in a <code>False</code> context.</p>
<blockquote>
<p>Attributes:</p>
<p>An attribute is any F* term.</p>
<p>Attributes are desugared and checked for being well-scoped. But,
they are not type-checked.</p>
<p>It is associated with a definition using the <code>@@attribute</code>
notation, just preceding the definition.</p>
</blockquote>
<h4>
<a id="user-content-__internal_ocaml_attributes" class="anchor" href="#__internal_ocaml_attributes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>__internal_ocaml_attributes</h4>
<p>We collect several internal ocaml attributes into a single
inductive type.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">type</span> <span class="pl-en">__internal_ocaml_attributes</span> <span class="pl-c1">=</span>
  <span class="pl-c1">|</span> <span class="pl-c1">PpxDerivingShow</span>
  <span class="pl-c1">|</span> <span class="pl-c1">PpxDerivingShowConstant</span> <span class="pl-en">of</span> <span class="pl-c1">string</span> <span class="pl-c"><span class="pl-c">(*</span> Generate [@@@ deriving show ] on the resulting OCaml type <span class="pl-c">*)</span></span>
  <span class="pl-c1">|</span> <span class="pl-c1">PpxDerivingYoJson</span> <span class="pl-c"><span class="pl-c">(*</span> Similar, but for constant printers. <span class="pl-c">*)</span></span>
  <span class="pl-c1">|</span> <span class="pl-c1">CInline</span> <span class="pl-c"><span class="pl-c">(*</span> Generate [@@@ deriving yojson ] on the resulting OCaml type <span class="pl-c">*)</span></span></pre></div>
<p>This may be unnecessary. In the future, we are likely to flatten
this definition into several definitions of abstract top-level
names.</p>
<p>An example:</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-c1">`</span>@@ <span class="pl-c1">CInline</span> <span class="pl-c1">`</span> <span class="pl-k">let</span> <span class="pl-en">f</span> <span class="pl-en">x</span> <span class="pl-c1">=</span> <span class="pl-smi">UInt32.</span><span class="pl-c1">(</span><span class="pl-en">x</span> <span class="pl-c1">+</span>%<span class="pl-c1">^</span> <span class="pl-c1">1</span><span class="pl-c1">)</span></pre></div>
<p>is extracted to C by KReMLin to a C definition tagged with the
<code>inline</code> qualifier.</p>
<p>KreMLin-only: generates a C "inline" attribute on the resulting
* function declaration.
KreMLin-only: forces KreMLin to inline the function at call-site; this is
* deprecated and the recommended way is now to use F*'s
* <code>inline_for_extraction</code>, which now also works for stateful functions.
KreMLin-only: instructs KreMLin to heap-allocate any value of this
* data-type; this requires running with a conservative GC as the
* allocations are not freed.
KreMLin-only: attach a comment to the declaration. Note that using F*-doc
* syntax automatically fills in this attribute.
KreMLin-only: verbatim C code to be prepended to the declaration.
* Multiple attributes are valid and accumulate, separated by newlines.
KreMLin-only: indicates that the parameter with that name is to be marked
* as C const.  This will be checked by the C compiler, not by KreMLin or F*.
*
* This is deprecated and doesn't work as intended. Use
* LowStar.ConstBuffer.fst instead!
KreMLin-only: for types that compile to struct types (records and
* inductives), indicate that the header file should only contain a forward
* declaration, which in turn forces the client to only ever use this type
* through a pointer.
KreMLin-only: for a top-level <code>let v = e</code>, compile as a macro</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-c1">|</span> <span class="pl-c1">Substitute</span>
<span class="pl-c1">|</span> <span class="pl-c1">Gc</span>
<span class="pl-c1">|</span> <span class="pl-c1">Comment</span> <span class="pl-en">of</span> <span class="pl-c1">string</span>
<span class="pl-c1">|</span> <span class="pl-c1">CPrologue</span> <span class="pl-en">of</span> <span class="pl-c1">string</span>
<span class="pl-c1">|</span> <span class="pl-c1">CEpilogue</span> <span class="pl-en">of</span> <span class="pl-c1">string</span>
<span class="pl-c1">|</span> <span class="pl-c1">CConst</span> <span class="pl-en">of</span> <span class="pl-c1">string</span> <span class="pl-c"><span class="pl-c">(*</span> Ibid. <span class="pl-c">*)</span></span>
<span class="pl-c1">|</span> <span class="pl-c1">CCConv</span> <span class="pl-en">of</span> <span class="pl-c1">string</span>
<span class="pl-c1">|</span> <span class="pl-c1">CAbstractStruct</span> <span class="pl-c"><span class="pl-c">(*</span> A calling convention for C, one of stdcall, cdecl, fastcall <span class="pl-c">*)</span></span>
<span class="pl-c1">|</span> <span class="pl-c1">CIfDef</span>
<span class="pl-c1">|</span> <span class="pl-c1">CMacro</span> <span class="pl-c"><span class="pl-c">(*</span> KreMLin-only: on a given `val foo`, compile if foo with #ifdef. <span class="pl-c">*)</span></span></pre></div>
<h4>
<a id="user-content-inline_let" class="anchor" href="#inline_let" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>inline_let</h4>
<p>The <a href="#inline_let"><code>inline_let</code></a> attribute on a local let-binding, instructs the
extraction pipeline to inline the definition. This may be both to
avoid generating unnecessary intermediate variables, and also to
enable further partial evaluation. Note, use this with care, since
inlining all lets can lead to an exponential blowup in code
size.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">inline_let</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span></pre></div>
<h4>
<a id="user-content-rename_let" class="anchor" href="#rename_let" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>rename_let</h4>
<p>The <a href="#rename_let"><code>rename_let</code></a> attribute support a form of metaprogramming for
the names of let-bound variables used in extracted code.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">rename_let</span> <span class="pl-c1">(</span><span class="pl-en">new_name</span><span class="pl-c1">:</span> <span class="pl-c1">string)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">unit</span></pre></div>
<p>This is useful, particularly in conjunction with partial
evaluation, to ensure that names reflect their usage context.</p>
<p>See tests/micro-benchmarks/Renaming*.fst</p>
<h4>
<a id="user-content-plugin" class="anchor" href="#plugin" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>plugin</h4>
<p>The <a href="#plugin"><code>plugin</code></a> attribute is used in conjunction with native
compilation of F* components, accelerating their reduction
relative to the default strategy of just interpreting them.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">plugin</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-c1">int)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">unit</span></pre></div>
<p>See examples/native_tactics for several examples.</p>
<h4>
<a id="user-content-tcnorm" class="anchor" href="#tcnorm" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>tcnorm</h4>
<p>An attribute to mark things that the typechecker should <em>first</em>
elaborate and typecheck, but unfold before verification.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">tcnorm</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span></pre></div>
<h4>
<a id="user-content-must_erase_for_extraction" class="anchor" href="#must_erase_for_extraction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>must_erase_for_extraction</h4>
<p>We erase all ghost functions and unit-returning pure functions to
<code>()</code> at extraction. This creates a small issue with abstract
types. Consider a module that defines an abstract type <code>t</code> whose
(internal) definition is <code>unit</code> and also defines <code>f: int -&gt; t</code>. <code>f</code>
would be erased to be just <code>()</code> inside the module, while the
client calls to <code>f</code> would not, since <code>t</code> is abstract. To get
around this, when extracting interfaces, if we encounter an
abstract type, we tag it with this attribute, so that
extraction can treat it specially.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">must_erase_for_extraction</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span></pre></div>
<p>Note, since the use of cross-module inlining (the <code>--cmi</code> option),
this attribute is no longer necessary. We retain it for legacy,
but will remove it in the future.</p>
<h4>
<a id="user-content-dm4f_bind_range" class="anchor" href="#dm4f_bind_range" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>dm4f_bind_range</h4>
<p>This attribute is used with the Dijkstra Monads for Free
construction to track position information in generated VCs</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">dm4f_bind_range</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span></pre></div>
<h4>
<a id="user-content-expect_failure" class="anchor" href="#expect_failure" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>expect_failure</h4>
<p>When attached a top-level definition, the typechecker will succeed
if and only if checking the definition results in an error. The
error number list is actually OPTIONAL. If present, it will be
checked that the definition raises exactly those errors in the
specified multiplicity, but order does not matter.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">expect_failure</span> <span class="pl-c1">(</span><span class="pl-en">errs</span><span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-c1">int)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">unit</span></pre></div>
<h4>
<a id="user-content-expect_lax_failure" class="anchor" href="#expect_lax_failure" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>expect_lax_failure</h4>
<p>When --lax is present, with the previous attribute since some
definitions only fail when verification is turned on. With this
attribute, one can ensure that a definition fails while lax-checking
too. Same semantics as above, but lax mode will be turned on for the
definition.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">expect_lax_failure</span> <span class="pl-c1">(</span><span class="pl-en">errs</span><span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-c1">int)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">unit</span></pre></div>
<h4>
<a id="user-content-tcdecltime" class="anchor" href="#tcdecltime" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>tcdecltime</h4>
<p>Print the time it took to typecheck a top-level definition</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">tcdecltime</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span></pre></div>
<h4>
<a id="user-content-assume_strictly_positive" class="anchor" href="#assume_strictly_positive" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>assume_strictly_positive</h4>
<p><strong>THIS ATTRIBUTE IS AN ESCAPE HATCH AND CAN BREAK SOUNDNESS</strong></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">assume_strictly_positive</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span></pre></div>
<p><strong>USE WITH CARE</strong></p>
<p>The positivity check for inductive types stops at abstraction
boundaries. This results in spurious errors about positivity,
e.g., when defining types like <code>type t = ref (option t)</code> By adding
this attribute to a declaration of a top-level name positivity
checks on applications of that name are admitted.  See, for
instance, FStar.Monotonic.Heap.mref We plan to decorate binders of
abstract types with polarities to allow us to check positivity
across abstraction boundaries and will eventually remove this
attribute.</p>
<h4>
<a id="user-content-unifier_hint_injective" class="anchor" href="#unifier_hint_injective" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>unifier_hint_injective</h4>
<p>This attribute is to be used as a hint for the unifier.  A
function-typed symbol <code>t</code> marked with this attribute will be treated
as being injective in all its arguments by the unifier.  That is,
given a problem <code>t a1..an =?= t b1..bn</code> the unifier will solve it by
proving <code>ai =?= bi</code> for all <code>i</code>, without trying to unfold the
definition of <code>t</code>.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">unifier_hint_injective</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span></pre></div>
<h4>
<a id="user-content-strict_on_arguments" class="anchor" href="#strict_on_arguments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>strict_on_arguments</h4>
<p>This attribute is used to control the evaluation order
and unfolding strategy for certain definitions.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">strict_on_arguments</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-c1">int)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">unit</span></pre></div>
<p>In particular, given
<code>FStar `@@(strict_on_arguments `1;2`)` let f x0 (x1:list x0) (x1:option x0) = e </code></p>
<p>An application <code>f e0 e1 e2</code> is reduced by the normalizer by:</p>
<pre><code>1. evaluating `e0 ~&gt;* v0, e1 ~&gt;* v1, e2 ~&gt;* v2`

2 a.
   If, according to the positional arguments `1;2`,
   if v1 and v2 have constant head symbols
         (e.g., v1 = Cons _ _ _, and v2 = None _)
  then `f` is unfolded to `e` and reduced as
    ```FStare[v0/x0][v1/x1][v2/x2]```

2 b.

 Otherwise, `f` is not unfolded and the term is `f e0 e1 e2`
 reduces to `f v0 v1 v2`.
</code></pre>
<h4>
<a id="user-content-resolve_implicits" class="anchor" href="#resolve_implicits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>resolve_implicits</h4>
<ul>
<li>An attribute to tag a tactic designated to solve any</li>
<li>unsolved implicit arguments remaining at the end of type inference.</li>
<li>
</li>
</ul>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">resolve_implicits</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span></pre></div>
<h4>
<a id="user-content-erasable" class="anchor" href="#erasable" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>erasable</h4>
<p>This attribute can be added to an inductive type definition,
indicating that it should be erased on extraction to <code>unit</code>.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">erasable</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span></pre></div>
<p>However, any pattern matching on the inductive type results
in a <code>Ghost</code> effect, ensuring that computationally relevant
code cannot rely on the values of the erasable type.</p>
<p>See tests/micro-benchmarks/Erasable.fst, for examples.  Also
see <a href="https://github.com/FStarLang/FStar/issues/1844">https://github.com/FStarLang/FStar/issues/1844</a></p>
<h4>
<a id="user-content-allow_informative_binders" class="anchor" href="#allow_informative_binders" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>allow_informative_binders</h4>
<p>THIS ATTRIBUTE CAN BREAK EXTRACTION SOUNDNESS, USE WITH CARE</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">allow_informative_binders</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span></pre></div>
<p>Combinators for reifiable layered effects must have binders with
non-informative types, since at extraction time, those binders are
substituted with ().
This attribute can be added to a layered effect definition to skip this
check, i.e. adding it will allow informative binder types, but then
the code should not be extracted</p>
<h4>
<a id="user-content-commute_nested_matches" class="anchor" href="#commute_nested_matches" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>commute_nested_matches</h4>
<p><a href="#commute_nested_matches"><code>commute_nested_matches</code></a>
This attribute can be used to decorate an inductive type <code>t</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">commute_nested_matches</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span></pre></div>
<p>During normalization, if reduction is blocked on matching the
constructors of <code>t</code> in the following sense:</p>
<p>[
match (match e0 with | P1 -&gt; e1 | ... | Pn -&gt; en) with
| Q1 -&gt; f1 ... | Qm -&gt; fm
]</p>
<p>i.e., the outer match is stuck due to the inner match on <code>e0</code>
being stuck, and if the head constructor the outer <code>Qi</code> patterns
are the constructors of the decorated inductive type <code>t</code>, then,
this is reduced to</p>
<p>[
match e0 with
| P1 -&gt; (match e1 with | Q1 -&gt; f1 ... | Qm -&gt; fm)
| ...
| Pn -&gt; (match en with | Q1 -&gt; f1 ... | Qm -&gt; fm)
]</p>
<p>This is sometimes useful when partially evaluating code before
extraction, particularly when aiming to obtain first-order code
for KReMLin. However, this attribute should be used with care,
since if after the rewriting the inner matches do not reduce, then
this can cause an explosion in code size.</p>
<p>See tests/micro-benchmarks/CommuteNestedMatches.fst
and examples/layeredeffects/LowParseWriters.fsti</p>
<h4>
<a id="user-content-noextract_to" class="anchor" href="#noextract_to" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>noextract_to</h4>
<p>This attribute controls extraction: it can be used to disable
extraction of a given top-level definition into a specific backend,
such as "OCaml". If any extracted code must call into an erased
function, an error will be raised (code 340).</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">noextract_to</span> <span class="pl-c1">(</span><span class="pl-en">backend</span><span class="pl-c1">:string)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">unit</span></pre></div>
<h4>
<a id="user-content-normalize_for_extraction" class="anchor" href="#normalize_for_extraction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>normalize_for_extraction</h4>
<p>This attribute decorates a let binding, e.g.,</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">normalize_for_extraction</span> <span class="pl-c1">(</span><span class="pl-en">steps</span><span class="pl-c1">:</span><span class="pl-en">list</span> <span class="pl-en">norm_step</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">unit</span></pre></div>
<p><code>@@normalize_for_extraction steps</code>
let f = e</p>
<p>The effect is that prior to extraction, F* will first reduce <code>e</code>
using the normalization <code>steps</code>, and then proceed to extract it as
usual.</p>
<p>Almost the same behavior can be achieved by using a
<code>postprocess_for_extraction_with t</code> attribute, which runs tactic
<code>t</code> on the goal <code>e == ?u</code> and extracts the solution to <code>?u</code> in
place of <code>e</code>. However, using a tactic to postprocess a term is
more general than needed for some cases.</p>
<p>In particular, if we intend to only normalize <code>e</code> before
extraction (rather than applying some other form of equational
reasoning), then using <a href="#normalize_for_extraction"><code>normalize_for_extraction</code></a> can be more
efficient, for the following reason:</p>
<p>Since we are reducing <code>e</code> just before extraction, F* can enable an
otherwise non-user-facing normalization feature that allows all
arguments marked <code>@@@erasable</code> to be erased to <code>()</code>---these terms
will anyway be extracted to <code>()</code> so erasing them during
normalization is a useful optimization.</p>
<h4>
<a id="user-content-ite_soundness_by" class="anchor" href="#ite_soundness_by" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ite_soundness_by</h4>
<p>A layered effect definition may optionally be annoated with
(ite_soundness_by t) attribute, where t is another attribute
When so, the implicits and the smt guard generated when
checking the soundness of the if-then-else combinator, are
dispatched to the tactic in scope that has the t attribute (in addition
to the resolve_implicits attribute as usual)</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">ite_soundness_by</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span></pre></div>
<p>See examples/layeredeffects/IteSoundess.fst for a few examples</p>
<h4>
<a id="user-content-strictly_positive" class="anchor" href="#strictly_positive" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>strictly_positive</h4>
<p>A binder in a definition/declaration may optionally be annotated as strictly_positive
When the let definition is used in a data constructor type in an inductive
definition, this annotation is used to check the positivity of the inductive</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">strictly_positive</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span></pre></div>
<p>Further F* checks that the binder is actually positive in the let definition</p>
<p>See tests/micro-benchmarks/Positivity.fst and NegativeTests.Positivity.fst for a few examples</p>
<h4>
<a id="user-content-singleton" class="anchor" href="#singleton" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>singleton</h4>
<p>Pure and ghost inner let bindings are now always inlined during
the wp computation, if: the return type is not unit and the head
symbol is not marked irreducible.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">singleton</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-c1">(</span><span class="pl-en">y</span><span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">{</span><span class="pl-en">y</span> <span class="pl-c1">==</span> <span class="pl-en">x</span><span class="pl-c1">})</span></pre></div>
<p>To circumvent this behavior, singleton can be used.
See the example usage in ulib/FStar.Algebra.Monoid.fst.</p>
<h4>
<a id="user-content-with_type" class="anchor" href="#with_type" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>with_type</h4>
<p><code>with_type t e</code> is just an identity function, but it receives
special treatment in the SMT encoding, where in addition to being
an identity function, we have an SMT axiom:
<code>forall t e.{:pattern (with_type t e)} has_type (with_type t e) t</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">with_type</span> <span class="pl-c1">(#</span><span class="pl-en">t</span><span class="pl-c1">:</span> <span class="pl-c1">Type)</span> <span class="pl-c1">(</span><span class="pl-en">e</span><span class="pl-c1">:</span> <span class="pl-en">t</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tot</span> <span class="pl-en">t</span></pre></div>
<h4>
<a id="user-content-eqtype_as_type" class="anchor" href="#eqtype_as_type" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>eqtype_as_type</h4>
<p>A weakening coercion from eqtype to Type.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">unfold</span> <span class="pl-k">let</span> <span class="pl-en">eqtype_as_type</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:eqtype)</span> <span class="pl-c1">:</span> <span class="pl-c1">Type</span> <span class="pl-c1">=</span> <span class="pl-en">a</span></pre></div>
<p>One of its uses is in types of layered effect combinators that
are subjected to stricter typing discipline (no subtyping)</p>

</body>
</html>
