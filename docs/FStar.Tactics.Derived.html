<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>FStar.Tactics.Derived</title>
  <style>@charset "utf-8"; .gist{font-size:16px;color:#333;text-align:left;/*!* GitHub Light v0.4.1 * Copyright(c) 2012 - 2017 GitHub,Inc. * Licensed under MIT(https://github.com/primer/github-syntax-theme-generator/blob/master/LICENSE) */ direction:ltr}.gist .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.gist .markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.gist .markdown-body:before{display:table;content:""}.gist .markdown-body:after{display:table;clear:both;content:""}.gist .markdown-body>:first-child{margin-top:0 !important}.gist .markdown-body>:last-child{margin-bottom:0 !important}.gist .markdown-body a:not([href]){color:inherit;text-decoration:none}.gist .markdown-body .absent{color:#cb2431}.gist .markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.gist .markdown-body .anchor:focus{outline:none}.gist .markdown-body blockquote,.gist .markdown-body details,.gist .markdown-body dl,.gist .markdown-body ol,.gist .markdown-body p,.gist .markdown-body pre,.gist .markdown-body table,.gist .markdown-body ul{margin-top:0;margin-bottom:16px}.gist .markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.gist .markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.gist .markdown-body blockquote>:first-child{margin-top:0}.gist .markdown-body blockquote>:last-child{margin-bottom:0}.gist .markdown-body h1,.gist .markdown-body h2,.gist .markdown-body h3,.gist .markdown-body h4,.gist .markdown-body h5,.gist .markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.gist .markdown-body h1 .octicon-link,.gist .markdown-body h2 .octicon-link,.gist .markdown-body h3 .octicon-link,.gist .markdown-body h4 .octicon-link,.gist .markdown-body h5 .octicon-link,.gist .markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.gist .markdown-body h1:hover .anchor,.gist .markdown-body h2:hover .anchor,.gist .markdown-body h3:hover .anchor,.gist .markdown-body h4:hover .anchor,.gist .markdown-body h5:hover .anchor,.gist .markdown-body h6:hover .anchor{text-decoration:none}.gist .markdown-body h1:hover .anchor .octicon-link,.gist .markdown-body h2:hover .anchor .octicon-link,.gist .markdown-body h3:hover .anchor .octicon-link,.gist .markdown-body h4:hover .anchor .octicon-link,.gist .markdown-body h5:hover .anchor .octicon-link,.gist .markdown-body h6:hover .anchor .octicon-link{visibility:visible}.gist .markdown-body h1 code,.gist .markdown-body h1 tt,.gist .markdown-body h2 code,.gist .markdown-body h2 tt,.gist .markdown-body h3 code,.gist .markdown-body h3 tt,.gist .markdown-body h4 code,.gist .markdown-body h4 tt,.gist .markdown-body h5 code,.gist .markdown-body h5 tt,.gist .markdown-body h6 code,.gist .markdown-body h6 tt{font-size:inherit}.gist .markdown-body h1{font-size:2em}.gist .markdown-body h1,.gist .markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.gist .markdown-body h2{font-size:1.5em}.gist .markdown-body h3{font-size:1.25em}.gist .markdown-body h4{font-size:1em}.gist .markdown-body h5{font-size:.875em}.gist .markdown-body h6{font-size:.85em;color:#6a737d}.gist .markdown-body ol,.gist .markdown-body ul{padding-left:2em}.gist .markdown-body ol.no-list,.gist .markdown-body ul.no-list{padding:0;list-style-type:none}.gist .markdown-body ol ol,.gist .markdown-body ol ul,.gist .markdown-body ul ol,.gist .markdown-body ul ul{margin-top:0;margin-bottom:0}.gist .markdown-body li{word-wrap:break-all}.gist .markdown-body li>p{margin-top:16px}.gist .markdown-body li+li{margin-top:.25em}.gist .markdown-body dl{padding:0}.gist .markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.gist .markdown-body dl dd{padding:0 16px;margin-bottom:16px}.gist .markdown-body table{display:block;width:100%;overflow:auto}.gist .markdown-body table th{font-weight:600}.gist .markdown-body table td,.gist .markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.gist .markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.gist .markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.gist .markdown-body table img{background-color:initial}.gist .markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.gist .markdown-body img[align=right]{padding-left:20px}.gist .markdown-body img[align=left]{padding-right:20px}.gist .markdown-body .emoji{max-width:none;vertical-align:text-top;background-color:initial}.gist .markdown-body span.frame{display:block;overflow:hidden}.gist .markdown-body span.frame>span{display:block;float:left;width:auto;padding:7px;margin:13px 0 0;overflow:hidden;border:1px solid #dfe2e5}.gist .markdown-body span.frame span img{display:block;float:left}.gist .markdown-body span.frame span span{display:block;padding:5px 0 0;clear:both;color:#24292e}.gist .markdown-body span.align-center{display:block;overflow:hidden;clear:both}.gist .markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.gist .markdown-body span.align-center span img{margin:0 auto;text-align:center}.gist .markdown-body span.align-right{display:block;overflow:hidden;clear:both}.gist .markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.gist .markdown-body span.align-right span img{margin:0;text-align:right}.gist .markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.gist .markdown-body span.float-left span{margin:13px 0 0}.gist .markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.gist .markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.gist .markdown-body code,.gist .markdown-body tt{padding:.2em .4em;margin:0;font-size:85%;background-color:#f6f8fa;border-radius:3px}.gist .markdown-body code br,.gist .markdown-body tt br{display:none}.gist .markdown-body del code{text-decoration:inherit}.gist .markdown-body pre{word-wrap:normal}.gist .markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.gist .markdown-body .highlight{margin-bottom:16px}.gist .markdown-body .highlight pre{margin-bottom:0;word-break:normal}.gist .markdown-body .highlight pre,.gist .markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.gist .markdown-body pre code,.gist .markdown-body pre tt{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:#f6f8fa;border:0}.gist .markdown-body .csv-data td,.gist .markdown-body .csv-data th{padding:5px;overflow:hidden;font-size:12px;line-height:1;text-align:left;white-space:nowrap}.gist .markdown-body .csv-data .blob-num{padding:10px 8px 9px;text-align:right;background:#fff;border:0}.gist .markdown-body .csv-data tr{border-top:0}.gist .markdown-body .csv-data th{font-weight:600;background:#f6f8fa;border-top:0}.gist .pl-c{color:#6a737d}.gist .pl-c1,.gist .pl-s .pl-v{color:#005cc5}.gist .pl-e,.gist .pl-en{color:#6f42c1}.gist .pl-s .pl-s1,.gist .pl-smi{color:#24292e}.gist .pl-ent{color:#22863a}.gist .pl-k{color:#d73a49}.gist .pl-pds,.gist .pl-s,.gist .pl-s .pl-pse .pl-s1,.gist .pl-sr,.gist .pl-sr .pl-cce,.gist .pl-sr .pl-sra,.gist .pl-sr .pl-sre{color:#032f62}.gist .pl-smw,.gist .pl-v{color:#e36209}.gist .pl-bu{color:#b31d28}.gist .pl-ii{color:#fafbfc;background-color:#b31d28}.gist .pl-c2{color:#fafbfc;background-color:#d73a49}.gist .pl-c2:before{content:"^M"}.gist .pl-sr .pl-cce{font-weight:700;color:#22863a}.gist .pl-ml{color:#735c0f}.gist .pl-mh,.gist .pl-mh .pl-en,.gist .pl-ms{font-weight:700;color:#005cc5}.gist .pl-mi{font-style:italic;color:#24292e}.gist .pl-mb{font-weight:700;color:#24292e}.gist .pl-md{color:#b31d28;background-color:#ffeef0}.gist .pl-mi1{color:#22863a;background-color:#f0fff4}.gist .pl-mc{color:#e36209;background-color:#ffebda}.gist .pl-mi2{color:#f6f8fa;background-color:#005cc5}.gist .pl-mdr{font-weight:700;color:#6f42c1}.gist .pl-ba{color:#586069}.gist .pl-sg{color:#959da5}.gist .pl-corl{text-decoration:underline;color:#032f62}.gist .breadcrumb{font-size:16px;color:#586069}.gist .breadcrumb .separator{white-space:pre-wrap}.gist .breadcrumb .separator:after,.gist .breadcrumb .separator:before{content:" "}.gist .breadcrumb strong.final-path{color:#24292e}.gist strong{font-weight:bolder}.gist .editor-abort{display:inline;font-size:14px}.gist .blob-interaction-bar{position:relative;background-color:#f2f2f2;border-bottom:1px solid #e5e5e5}.gist .blob-interaction-bar:before{display:table;content:""}.gist .blob-interaction-bar:after{display:table;clear:both;content:""}.gist .blob-interaction-bar .octicon-search{position:absolute;top:10px;left:10px;font-size:12px;color:#586069}.gist .blob-filter{width:100%;padding:4px 20px 5px 30px;font-size:12px;border:0;border-radius:0;outline:none}.gist .blob-filter:focus{outline:none}.gist .html-blob{margin-bottom:15px}.gist .TagsearchPopover{width:inherit;max-width:600px}.gist .TagsearchPopover-content{max-height:300px}.gist .TagsearchPopover-list .TagsearchPopover-list-item:hover{background-color:#f6f8fa}.gist .TagsearchPopover-list .TagsearchPopover-list-item .TagsearchPopover-item:hover{text-decoration:none}.gist .TagsearchPopover-list .blob-code-inner{white-space:pre-wrap}.gist .linejump .linejump-input{width:340px;background-color:#fafbfc}.gist .linejump .btn,.gist .linejump .linejump-input{padding:10px 15px;font-size:16px}.gist .CopyBlock{line-height:20px;cursor:pointer}.gist .CopyBlock .octicon-clippy{display:none}.gist .CopyBlock:active,.gist .CopyBlock:focus,.gist .CopyBlock:hover{background-color:#fff;outline:none}.gist .CopyBlock:active .octicon-clippy,.gist .CopyBlock:focus .octicon-clippy,.gist .CopyBlock:hover .octicon-clippy{display:inline-block}.gist .blob-wrapper{overflow-x:auto;overflow-y:hidden}.gist .page-blob.height-full .blob-wrapper{overflow-y:auto}.gist .page-edit-blob.height-full .CodeMirror{height:300px}.gist .page-edit-blob.height-full .CodeMirror,.gist .page-edit-blob.height-full .CodeMirror-scroll{display:flex;flex-direction:column;flex:1 1 auto}.gist .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.gist .diff-table{width:100%;border-collapse:initial}.gist .diff-table .line-comments{padding:10px;vertical-align:top;border-top:1px solid #e1e4e8}.gist .diff-table .line-comments:first-child+.empty-cell{border-left-width:1px}.gist .diff-table tr:not(:last-child) .line-comments{border-top:1px solid #e1e4e8;border-bottom:1px solid #e1e4e8}.gist .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gist .blob-num:hover{color:rgba(27,31,35,.6)}.gist .blob-num:before{content:attr(data-line-number)}.gist .blob-num.non-expandable{cursor:default}.gist .blob-num.non-expandable:hover{color:rgba(27,31,35,.3)}.gist .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.gist .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.gist .blob-code-inner .x-first{border-top-left-radius:.2em;border-bottom-left-radius:.2em}.gist .blob-code-inner .x-last{border-top-right-radius:.2em;border-bottom-right-radius:.2em}.gist .blob-code-inner.highlighted,.gist .blob-code-inner .highlighted{background-color:#fffbdd}.gist .blob-code-marker:before{padding-right:8px;content:attr(data-code-marker)}.gist .blob-code-marker-addition:before{content:"+ "}.gist .blob-code-marker-deletion:before{content:"- "}.gist .blob-code-marker-context:before{content:" "}.gist .soft-wrap .diff-table{table-layout:fixed}.gist .soft-wrap .blob-code{padding-left:18px;text-indent:-7px}.gist .soft-wrap .blob-code-inner{word-wrap:break-word;white-space:pre-wrap}.gist .soft-wrap .no-nl-marker{display:none}.gist .soft-wrap .add-line-comment{margin-left:-28px}.gist .blob-code-hunk,.gist .blob-num-expandable,.gist .blob-num-hunk{color:rgba(27,31,35,.7);vertical-align:middle}.gist .blob-num-expandable,.gist .blob-num-hunk{background-color:#dbedff}.gist .blob-code-hunk{padding-top:4px;padding-bottom:4px;background-color:#f1f8ff;border-width:1px 0}.gist .blob-expanded .blob-code,.gist .blob-expanded .blob-num{background-color:#fafbfc}.gist .blob-expanded+tr:not(.blob-expanded) .blob-code,.gist .blob-expanded+tr:not(.blob-expanded) .blob-num,.gist .blob-expanded .blob-num-hunk,.gist tr:not(.blob-expanded)+.blob-expanded .blob-code,.gist tr:not(.blob-expanded)+.blob-expanded .blob-num{border-top:1px solid #eaecef}.gist .blob-num-expandable{padding:0;font-size:12px;text-align:center}.gist .blob-num-expandable .diff-expander{display:block;width:auto;height:auto;padding:4px 11px 4px 10px;margin-right:-1px;color:#586069;cursor:pointer}.gist .blob-num-expandable .diff-expander .octicon{vertical-align:top}.gist .blob-num-expandable .directional-expander{display:block;width:auto;height:auto;margin-right:-1px;color:#586069;cursor:pointer}.gist .blob-num-expandable .single-expander{padding-top:4px;padding-bottom:4px}.gist .blob-num-expandable .diff-expander:hover,.gist .blob-num-expandable .directional-expander:hover{color:#fff;text-shadow:none;background-color:#0366d6;border-color:#0366d6}.gist .blob-code-addition{background-color:#e6ffed}.gist .blob-code-addition .x{color:#24292e;background-color:#acf2bd}.gist .blob-num-addition{background-color:#cdffd8;border-color:#bef5cb}.gist .blob-code-deletion{background-color:#ffeef0}.gist .blob-code-deletion .x{color:#24292e;background-color:#fdb8c0}.gist .blob-num-deletion{background-color:#ffdce0;border-color:#fdaeb7}.gist .is-selecting,.gist .is-selecting .blob-num{cursor:ns-resize !important}.gist .is-selecting .add-line-comment,.gist .is-selecting a{pointer-events:none;cursor:ns-resize !important}.gist .is-selecting .is-hovered .add-line-comment{opacity:0}.gist .is-selecting.file-diff-split,.gist .is-selecting.file-diff-split .blob-num{cursor:nwse-resize !important}.gist .is-selecting.file-diff-split .add-line-comment,.gist .is-selecting.file-diff-split .empty-cell,.gist .is-selecting.file-diff-split a{pointer-events:none;cursor:nwse-resize !important}.gist .selected-line{position:relative}.gist .selected-line:after{position:absolute;top:0;left:0;display:block;width:100%;height:100%;box-sizing:border-box;pointer-events:none;content:"";background:rgba(255,223,93,.2);mix-blend-mode:multiply}.gist .selected-line.selected-line-top:after{border-top:1px solid #ffd33d}.gist .selected-line.selected-line-bottom:after{border-bottom:1px solid #ffd33d}.gist .selected-line.selected-line-left:after,.gist .selected-line:first-child:after{border-left:1px solid #ffd33d}.gist .selected-line.selected-line-right:after,.gist .selected-line:last-child:after{border-right:1px solid #ffd33d}.gist .is-commenting .selected-line.blob-code:before{position:absolute;top:0;left:-1px;display:block;width:4px;height:100%;content:"";background:#0366d6}.gist .add-line-comment{position:relative;z-index:5;float:left;width:22px;height:22px;margin:-2px -10px -2px -20px;line-height:21px;color:#fff;text-align:center;text-indent:0;cursor:pointer;background-color:#0366d6;background-image:linear-gradient(#0372ef,#0366d6);border-radius:3px;box-shadow:0 1px 4px rgba(27,31,35,.15);opacity:0;transition:transform .1s ease-in-out;transform:scale(.8)}.gist .add-line-comment:hover{transform:scale(1)}.gist .add-line-comment:focus,.is-hovered .gist .add-line-comment{opacity:1}.gist .add-line-comment .octicon{vertical-align:text-top;pointer-events:none}.gist .add-line-comment.octicon-check{background:#333;opacity:1}.gist .inline-comment-form{border:1px solid #dfe2e5;border-radius:3px}.gist .inline-review-comment{margin-top:0 !important;margin-bottom:10px !important}.gist .inline-review-comment .gc:first-child+tr .blob-code,.gist .inline-review-comment .gc:first-child+tr .blob-num{padding-top:5px}.gist .inline-review-comment tr:last-child{border-bottom-right-radius:3px;border-bottom-left-radius:3px}.gist .inline-review-comment tr:last-child .blob-code,.gist .inline-review-comment tr:last-child .blob-num{padding-bottom:8px}.gist .inline-review-comment tr:last-child .blob-code:first-child,.gist .inline-review-comment tr:last-child .blob-num:first-child{border-bottom-left-radius:3px}.gist .inline-review-comment tr:last-child .blob-code:last-child,.gist .inline-review-comment tr:last-child .blob-num:last-child{border-bottom-right-radius:3px}.gist .timeline-inline-comments{width:100%;table-layout:fixed}.gist .show-inline-notes .inline-comments,.gist .timeline-inline-comments .inline-comments{display:table-row}.gist .inline-comments,.gist .inline-comments.is-collapsed{display:none}.gist .inline-comments .line-comments.is-collapsed{visibility:hidden}.gist .inline-comments .line-comments+.blob-num{border-left-width:1px}.gist .inline-comments .timeline-comment{margin-bottom:10px}.gist .comment-holder,.gist .inline-comments .inline-comment-form,.gist .inline-comments .inline-comment-form-container{max-width:780px}.gist .empty-cell+.line-comments,.gist .line-comments+.line-comments{border-left:1px solid #eaecef}.gist .inline-comment-form-container .inline-comment-form,.gist .inline-comment-form-container.open .inline-comment-form-actions{display:none}.gist .inline-comment-form-container .inline-comment-form-actions,.gist .inline-comment-form-container.open .inline-comment-form{display:block}.gist body.full-width .container,.gist body.full-width .container-lg,.gist body.full-width .container-xl,.gist body.split-diff .container,.gist body.split-diff .container-lg,.gist body.split-diff .container-xl{width:100%;max-width:none;padding-right:20px;padding-left:20px}.gist body.full-width .repository-content,.gist body.split-diff .repository-content{width:100%}.gist body.full-width .new-pr-form,.gist body.split-diff .new-pr-form{max-width:980px}.gist .file-diff-split{table-layout:fixed}.gist .file-diff-split .blob-code+.blob-num{border-left:1px solid #f6f8fa}.gist .file-diff-split .blob-code-inner{word-wrap:break-word;white-space:pre-wrap}.gist .file-diff-split .empty-cell{cursor:default;background-color:#fafbfc;border-right-color:#eaecef}@media (max-width:1280px){.gist .file-diff-split .write-selected .comment-form-head{margin-bottom:48px !important}.gist .file-diff-split markdown-toolbar{position:absolute;right:8px;bottom:-40px}}.gist .submodule-diff-stats .octicon-diff-removed{color:#cb2431}.gist .submodule-diff-stats .octicon-diff-renamed{color:#677a85}.gist .submodule-diff-stats .octicon-diff-modified{color:#d0b44c}.gist .submodule-diff-stats .octicon-diff-added{color:#28a745}.gist .BlobToolbar{left:-17px}.gist .BlobToolbar-dropdown{margin-left:-2px}.gist .code-navigation-banner{background:linear-gradient(180deg,rgba(242,248,254,0),rgba(242,248,254,.47))}.gist .code-navigation-banner .code-navigation-banner-illo{background-image:url(code-navigation-banner-illo.svg);background-repeat:no-repeat;background-position:50%}.gist .pl-token.active,.gist .pl-token:hover{cursor:pointer;background:#ffea7f}.gist .task-list-item{list-style-type:none}.gist .task-list-item label{font-weight:400}.gist .task-list-item.enabled label{cursor:pointer}.gist .task-list-item+.task-list-item{margin-top:3px}.gist .task-list-item .handle{display:none}.gist .task-list-item-checkbox{margin:0 .2em .25em -1.6em;vertical-align:middle}.gist .reorderable-task-lists .markdown-body .contains-task-list{padding:0}.gist .reorderable-task-lists .markdown-body li:not(.task-list-item){margin-left:26px}.gist .reorderable-task-lists .markdown-body ol:not(.contains-task-list) li,.gist .reorderable-task-lists .markdown-body ul:not(.contains-task-list) li{margin-left:0}.gist .reorderable-task-lists .markdown-body li p{margin-top:0}.gist .reorderable-task-lists .markdown-body .task-list-item{padding-right:15px;padding-left:42px;margin-right:-15px;margin-left:-15px;border:1px solid transparent}.gist .reorderable-task-lists .markdown-body .task-list-item+.task-list-item{margin-top:0}.gist .reorderable-task-lists .markdown-body .task-list-item .contains-task-list{padding-top:4px}.gist .reorderable-task-lists .markdown-body .task-list-item .handle{display:block;float:left;width:20px;padding:2px 0 0 2px;margin-left:-43px;opacity:0}.gist .reorderable-task-lists .markdown-body .task-list-item .drag-handle{fill:#333}.gist .reorderable-task-lists .markdown-body .task-list-item.hovered>.handle{opacity:1}.gist .reorderable-task-lists .markdown-body .task-list-item.is-dragging{opacity:0}.gist .review-comment-contents .markdown-body .task-list-item{padding-left:42px;margin-right:-12px;margin-left:-12px;border-top-left-radius:3px;border-bottom-left-radius:3px}.gist .review-comment-contents .markdown-body .task-list-item.hovered{border-left-color:#ededed}.gist .highlight{padding:0;margin:0;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;font-weight:400;line-height:1.4;color:#333;background:#fff;border:0}.gist .octospinner,.gist .render-viewer-error,.gist .render-viewer-fatal,.gist .render-viewer-invalid{display:none}.gist iframe.render-viewer{width:100%;height:480px;overflow:hidden;border:0}.gist code,.gist pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace !important}.gist .gist-meta{padding:10px;overflow:hidden;font:12px -apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;color:#586069;background-color:#f7f7f7;border-radius:0 0 3px 3px}.gist .gist-meta a{font-weight:600;color:#666;text-decoration:none;border:0}.gist .gist-data{overflow:auto;word-wrap:normal;background-color:#fff;border-bottom:1px solid #ddd;border-radius:3px 3px 0 0}.gist .gist-file{margin-bottom:1em;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;border:1px solid;border-color:#ddd #ddd #ccc;border-radius:3px}.gist .gist-file article{padding:6px}.gist .gist-file .scroll .gist-data{position:absolute;top:0;right:0;bottom:30px;left:0;overflow:scroll}.gist .gist-file .scroll .gist-meta{position:absolute;right:0;bottom:0;left:0}.gist .blob-num{min-width:inherit}.gist .blob-code,.gist .blob-num{padding:1px 10px !important;background:transparent}.gist .blob-code{text-align:left;border:0}.gist .blob-wrapper table{border-collapse:collapse}.gist table,.gist table tr,.gist table tr td,.gist table tr th{border-collapse:collapse}.gist .blob-wrapper tr:first-child td{padding-top:4px}.gist .markdown-body .anchor{display:none}</style>
</head>
<body>
<h1>
<a id="user-content-fstartacticsderived" class="anchor" href="#fstartacticsderived" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>FStar.Tactics.Derived</h1>
<ul>
<li>Opens module <a href="FStar.List.Tot.html">FStar.List.Tot</a>
</li>
<li>Opens module <a href="FStar.Reflection.html">FStar.Reflection</a>
</li>
<li>Opens module <a href="FStar.Reflection.Formula.html">FStar.Reflection.Formula</a>
</li>
<li>Opens module <a href="FStar.Tactics.Types.html">FStar.Tactics.Types</a>
</li>
<li>Opens module <a href="FStar.Tactics.Effect.html">FStar.Tactics.Effect</a>
</li>
<li>Opens module <a href="FStar.Tactics.Builtins.html">FStar.Tactics.Builtins</a>
</li>
<li>Opens module <a href="FStar.Tactics.Result.html">FStar.Tactics.Result</a>
</li>
<li>Opens module <a href="FStar.Tactics.Util.html">FStar.Tactics.Util</a>
</li>
<li>Opens module <a href="FStar.Tactics.SyntaxHelpers.html">FStar.Tactics.SyntaxHelpers</a>
</li>
<li>Aliases module <a href="FStar.List.Tot.html"> FStar.List.Tot</a> as <code>L </code>
</li>
</ul>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">exception</span> <span class="pl-c1">Goal_not_trivial</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">goals</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(</span><span class="pl-en">list</span> <span class="pl-en">goal</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-en">goals_of</span> <span class="pl-c1">(</span><span class="pl-en">get</span> <span class="pl-c1">())</span>
<span class="pl-k">let</span> <span class="pl-en">smt_goals</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(</span><span class="pl-en">list</span> <span class="pl-en">goal</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-en">smt_goals_of</span> <span class="pl-c1">(</span><span class="pl-en">get</span> <span class="pl-c1">())</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">fail</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">m</span><span class="pl-c1">:string)</span> <span class="pl-c1">=</span>
  <span class="pl-en">raise</span> <span class="pl-c1">#</span><span class="pl-en">a</span> <span class="pl-c1">(</span><span class="pl-c1">TacticFailure</span> <span class="pl-en">m</span><span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">fail_silently</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">m</span><span class="pl-c1">:string)</span> <span class="pl-c1">=</span>
  <span class="pl-en">set_urgency</span> <span class="pl-c1">0</span><span class="pl-c1">;</span>
  <span class="pl-en">raise</span> <span class="pl-c1">#</span><span class="pl-en">a</span> <span class="pl-c1">(</span><span class="pl-c1">TacticFailure</span> <span class="pl-en">m</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-_cur_goal" class="anchor" href="#_cur_goal" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>_cur_goal</h4>
<p>Return the current <em>goal</em>, not its type. (Ignores SMT goals)</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">_cur_goal</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">goal</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">goals</span> <span class="pl-c1">()</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span>   <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>no more goals<span class="pl-pds">"</span></span>
    <span class="pl-c1">|</span> <span class="pl-en">g</span><span class="pl-c1">::</span><span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">g</span></pre></div>
<h4>
<a id="user-content-cur_env" class="anchor" href="#cur_env" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>cur_env</h4>
<p><a href="#cur_env"><code>cur_env</code></a> returns the current goal's environment</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">cur_env</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">env</span> <span class="pl-c1">=</span> <span class="pl-en">goal_env</span> <span class="pl-c1">(</span><span class="pl-en">_cur_goal</span> <span class="pl-c1">())</span></pre></div>
<h4>
<a id="user-content-cur_goal" class="anchor" href="#cur_goal" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>cur_goal</h4>
<p><a href="#cur_goal"><code>cur_goal</code></a> returns the current goal's type</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">cur_goal</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">typ</span> <span class="pl-c1">=</span> <span class="pl-en">goal_type</span> <span class="pl-c1">(</span><span class="pl-en">_cur_goal</span> <span class="pl-c1">())</span></pre></div>
<h4>
<a id="user-content-cur_witness" class="anchor" href="#cur_witness" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>cur_witness</h4>
<p><a href="#cur_witness"><code>cur_witness</code></a> returns the current goal's witness</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">cur_witness</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span> <span class="pl-c1">=</span> <span class="pl-en">goal_witness</span> <span class="pl-c1">(</span><span class="pl-en">_cur_goal</span> <span class="pl-c1">())</span></pre></div>
<h4>
<a id="user-content-cur_goal_safe" class="anchor" href="#cur_goal_safe" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>cur_goal_safe</h4>
<p><a href="#cur_goal_safe"><code>cur_goal_safe</code></a> will always return the current goal, without failing.
It must be statically verified that there indeed is a goal in order to
call it.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">cur_goal_safe</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">TacH</span> <span class="pl-en">goal</span> <span class="pl-c1">(</span><span class="pl-en">requires</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">ps</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">~(</span><span class="pl-en">goals_of</span> <span class="pl-en">ps</span> <span class="pl-c1">==</span> <span class="pl-c1">[])))</span>
                                 <span class="pl-c1">(</span><span class="pl-en">ensures</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">ps0</span> <span class="pl-en">r</span> <span class="pl-c1">-&gt;</span> <span class="pl-k">exists</span> <span class="pl-en">g</span><span class="pl-c1">.</span> <span class="pl-en">r</span> <span class="pl-c1">==</span> <span class="pl-c1">Success</span> <span class="pl-en">g</span> <span class="pl-en">ps0</span><span class="pl-c1">))</span>
 <span class="pl-c1">=</span> <span class="pl-k">match</span> <span class="pl-en">goals_of</span> <span class="pl-c1">(</span><span class="pl-en">get</span> <span class="pl-c1">())</span> <span class="pl-k">with</span>
   <span class="pl-c1">|</span> <span class="pl-en">g</span> <span class="pl-c1">::</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">g</span></pre></div>
<h4>
<a id="user-content-cur_binders" class="anchor" href="#cur_binders" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>cur_binders</h4>
<p><a href="#cur_binders"><code>cur_binders</code></a> returns the list of binders in the current goal.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">cur_binders</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">binders</span> <span class="pl-c1">=</span>
    <span class="pl-en">binders_of_env</span> <span class="pl-c1">(</span><span class="pl-en">cur_env</span> <span class="pl-c1">())</span></pre></div>
<h4>
<a id="user-content-with_policy" class="anchor" href="#with_policy" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>with_policy</h4>
<p>Set the guard policy only locally, without affecting calling code</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">with_policy</span> <span class="pl-en">pol</span> <span class="pl-c1">(</span><span class="pl-en">f</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">old_pol</span> <span class="pl-c1">=</span> <span class="pl-en">get_guard_policy</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-en">set_guard_policy</span> <span class="pl-en">pol</span><span class="pl-c1">;</span>
    <span class="pl-k">let</span> <span class="pl-en">r</span> <span class="pl-c1">=</span> <span class="pl-en">f</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-en">set_guard_policy</span> <span class="pl-en">old_pol</span><span class="pl-c1">;</span>
    <span class="pl-en">r</span></pre></div>
<h4>
<a id="user-content-exact" class="anchor" href="#exact" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>exact</h4>
<p><code>exact e</code> will solve a goal <code>Gamma |- w : t</code> if <code>e</code> has type exactly
<code>t</code> in <code>Gamma</code>.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">exact</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">with_policy</span> <span class="pl-c1">SMT</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">t_exact</span> <span class="pl-c1">true</span> <span class="pl-c1">false</span> <span class="pl-en">t</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-exact_with_ref" class="anchor" href="#exact_with_ref" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>exact_with_ref</h4>
<p><code>exact_with_ref e</code> will solve a goal <code>Gamma |- w : t</code> if <code>e</code> has
type <code>t'</code> where <code>t'</code> is a subtype of <code>t</code> in <code>Gamma</code>. This is a more
flexible variant of <a href="#exact"><code>exact</code></a>.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">exact_with_ref</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">with_policy</span> <span class="pl-c1">SMT</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">t_exact</span> <span class="pl-c1">true</span> <span class="pl-c1">true</span> <span class="pl-en">t</span><span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">trivial</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
  <span class="pl-en">norm</span> <span class="pl-c1">[</span><span class="pl-en">iota</span><span class="pl-c1">;</span> <span class="pl-en">zeta</span><span class="pl-c1">;</span> <span class="pl-en">reify_</span><span class="pl-c1">;</span> <span class="pl-en">delta</span><span class="pl-c1">;</span> <span class="pl-en">primops</span><span class="pl-c1">;</span> <span class="pl-en">simplify</span><span class="pl-c1">;</span> <span class="pl-en">unmeta</span><span class="pl-c1">];</span>
  <span class="pl-k">let</span> <span class="pl-en">g</span> <span class="pl-c1">=</span> <span class="pl-en">cur_goal</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
  <span class="pl-k">match</span> <span class="pl-en">term_as_formula</span> <span class="pl-en">g</span> <span class="pl-k">with</span>
  <span class="pl-c1">|</span> <span class="pl-c1">True_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">exact</span> <span class="pl-c1">(`())</span>
  <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">raise</span> <span class="pl-c1">Goal_not_trivial</span></pre></div>
<p>Another hook to just run a tactic without goals, just by reusing <code>with_tactic</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">run_tactic</span> <span class="pl-c1">(</span><span class="pl-en">t</span><span class="pl-c1">:unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit)</span>
  <span class="pl-c1">:</span> <span class="pl-c1">Pure</span> <span class="pl-c1">unit</span>
         <span class="pl-c1">(</span><span class="pl-en">requires</span> <span class="pl-c1">(</span><span class="pl-en">set_range_of</span> <span class="pl-c1">(</span><span class="pl-en">with_tactic</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">trivial</span> <span class="pl-c1">();</span> <span class="pl-en">t</span> <span class="pl-c1">())</span> <span class="pl-c1">(</span><span class="pl-k">squash</span> <span class="pl-c1">True</span><span class="pl-c1">))</span> <span class="pl-c1">(</span><span class="pl-en">range_of</span> <span class="pl-en">t</span><span class="pl-c1">)))</span>
         <span class="pl-c1">(</span><span class="pl-en">ensures</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">True</span><span class="pl-c1">))</span>
  <span class="pl-c1">=</span> <span class="pl-c1">()</span></pre></div>
<h4>
<a id="user-content-dismiss" class="anchor" href="#dismiss" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>dismiss</h4>
<p>Ignore the current goal. If left unproven, this will fail after
the tactic finishes.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">dismiss</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">goals</span> <span class="pl-c1">()</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>dismiss: no more goals<span class="pl-pds">"</span></span>
    <span class="pl-c1">|</span> <span class="pl-c1">_</span><span class="pl-c1">::</span><span class="pl-en">gs</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">set_goals</span> <span class="pl-en">gs</span></pre></div>
<h4>
<a id="user-content-flip" class="anchor" href="#flip" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>flip</h4>
<p>Flip the order of the first two goals.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">flip</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">gs</span> <span class="pl-c1">=</span> <span class="pl-en">goals</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-k">match</span> <span class="pl-en">goals</span> <span class="pl-c1">()</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">|</span> <span class="pl-c1">[</span><span class="pl-c1">_</span><span class="pl-c1">]</span>   <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>flip: less than two goals<span class="pl-pds">"</span></span>
    <span class="pl-c1">|</span> <span class="pl-en">g1</span><span class="pl-c1">::</span><span class="pl-en">g2</span><span class="pl-c1">::</span><span class="pl-en">gs</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">set_goals</span> <span class="pl-c1">(</span><span class="pl-en">g2</span><span class="pl-c1">::</span><span class="pl-en">g1</span><span class="pl-c1">::</span><span class="pl-en">gs</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-qed" class="anchor" href="#qed" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>qed</h4>
<p>Succeed if there are no more goals left, and fail otherwise.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">qed</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">goals</span> <span class="pl-c1">()</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">()</span>
    <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>qed: not done!<span class="pl-pds">"</span></span></pre></div>
<h4>
<a id="user-content-debug" class="anchor" href="#debug" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>debug</h4>
<p><code>debug str</code> is similar to <code>print str</code>, but will only print the message
if the <code>--debug</code> option was given for the current module AND
<code>--debug_level Tac</code> is on.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">debug</span> <span class="pl-c1">(</span><span class="pl-en">m</span><span class="pl-c1">:string)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">if</span> <span class="pl-en">debugging</span> <span class="pl-c1">()</span> <span class="pl-k">then</span> <span class="pl-en">print</span> <span class="pl-en">m</span></pre></div>
<h4>
<a id="user-content-smt" class="anchor" href="#smt" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>smt</h4>
<p><a href="#smt"><code>smt</code></a> will mark the current goal for being solved through the SMT.
This does not immediately run the SMT: it just dumps the goal in the
SMT bin. Note, if you dump a proof-relevant goal there, the engine will
later raise an error.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">smt</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">goals</span> <span class="pl-c1">(),</span> <span class="pl-en">smt_goals</span> <span class="pl-c1">()</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[],</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>smt: no active goals<span class="pl-pds">"</span></span>
    <span class="pl-c1">|</span> <span class="pl-en">g</span><span class="pl-c1">::</span><span class="pl-en">gs</span><span class="pl-c1">,</span> <span class="pl-en">gs'</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">begin</span>
        <span class="pl-en">set_goals</span> <span class="pl-en">gs</span><span class="pl-c1">;</span>
        <span class="pl-en">set_smt_goals</span> <span class="pl-c1">(</span><span class="pl-en">g</span> <span class="pl-c1">::</span> <span class="pl-en">gs'</span><span class="pl-c1">)</span>
        <span class="pl-k">end</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">idtac</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span> <span class="pl-c1">()</span></pre></div>
<h4>
<a id="user-content-later" class="anchor" href="#later" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>later</h4>
<p>Push the current goal to the back.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">later</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">goals</span> <span class="pl-c1">()</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-en">g</span><span class="pl-c1">::</span><span class="pl-en">gs</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">set_goals</span> <span class="pl-c1">(</span><span class="pl-en">gs</span> @ <span class="pl-c1">[</span><span class="pl-en">g</span><span class="pl-c1">])</span>
    <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>later: no goals<span class="pl-pds">"</span></span></pre></div>
<h4>
<a id="user-content-apply" class="anchor" href="#apply" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>apply</h4>
<p><code>apply f</code> will attempt to produce a solution to the goal by an application
of <code>f</code> to any amount of arguments (which need to be solved as further goals).
The amount of arguments introduced is the least such that <code>f a_i</code> unifies
with the goal's type.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">apply</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">t_apply</span> <span class="pl-c1">true</span> <span class="pl-c1">false</span> <span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">apply_noinst</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">t_apply</span> <span class="pl-c1">true</span> <span class="pl-c1">true</span> <span class="pl-en">t</span></pre></div>
<h4>
<a id="user-content-apply_lemma" class="anchor" href="#apply_lemma" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>apply_lemma</h4>
<p><code>apply_lemma l</code> will solve a goal of type <code>squash phi</code> when <code>l</code> is a
Lemma ensuring <code>phi</code>. The arguments to <code>l</code> and its requires clause are
introduced as new goals. As a small optimization, <code>unit</code> arguments are
discharged by the engine. Just a thin wrapper around <code>t_apply_lemma</code>.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">apply_lemma</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">t_apply_lemma</span> <span class="pl-c1">false</span> <span class="pl-c1">false</span> <span class="pl-en">t</span></pre></div>
<h4>
<a id="user-content-trefl" class="anchor" href="#trefl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>trefl</h4>
<p>See docs for <code>t_trefl</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">trefl</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
  <span class="pl-en">t_trefl</span> <span class="pl-c1">false</span></pre></div>
<h4>
<a id="user-content-trefl_guard" class="anchor" href="#trefl_guard" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>trefl_guard</h4>
<p>See docs for <code>t_trefl</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">trefl_guard</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
  <span class="pl-en">t_trefl</span> <span class="pl-c1">true</span></pre></div>
<h4>
<a id="user-content-commute_applied_match" class="anchor" href="#commute_applied_match" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>commute_applied_match</h4>
<p>See docs for <code>t_commute_applied_match</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">commute_applied_match</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
  <span class="pl-en">t_commute_applied_match</span> <span class="pl-c1">()</span></pre></div>
<h4>
<a id="user-content-apply_lemma_noinst" class="anchor" href="#apply_lemma_noinst" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>apply_lemma_noinst</h4>
<p>Similar to <a href="#apply_lemma"><code>apply_lemma</code></a>, but will not instantiate uvars in the
goal while applying.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">apply_lemma_noinst</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">t_apply_lemma</span> <span class="pl-c1">true</span> <span class="pl-c1">false</span> <span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">apply_lemma_rw</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">t_apply_lemma</span> <span class="pl-c1">false</span> <span class="pl-c1">true</span> <span class="pl-en">t</span></pre></div>
<h4>
<a id="user-content-apply_raw" class="anchor" href="#apply_raw" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>apply_raw</h4>
<p><code>apply_raw f</code> is like <a href="#apply"><code>apply</code></a>, but will ask for all arguments
regardless of whether they appear free in further goals. See the
explanation in <code>t_apply</code>.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">apply_raw</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">t_apply</span> <span class="pl-c1">false</span> <span class="pl-c1">false</span> <span class="pl-en">t</span></pre></div>
<h4>
<a id="user-content-exact_guard" class="anchor" href="#exact_guard" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>exact_guard</h4>
<p>Like <a href="#exact"><code>exact</code></a>, but allows for the term <code>e</code> to have a type <code>t</code> only
under some guard <code>g</code>, adding the guard as a goal.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">exact_guard</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">with_policy</span> <span class="pl-c1">Goal</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">t_exact</span> <span class="pl-c1">true</span> <span class="pl-c1">false</span> <span class="pl-en">t</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-t_pointwise" class="anchor" href="#t_pointwise" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>t_pointwise</h4>
<p>(TODO: explain bettter) When running <code>pointwise tau</code> For every
subterm <code>t'</code> of the goal's type <code>t</code>, the engine will build a goal <code>Gamma |= t' == ?u</code> and run <code>tau</code> on it. When the tactic proves the goal,
the engine will rewrite <code>t'</code> for <code>?u</code> in the original goal type. This
is done for every subterm, bottom-up. This allows to recurse over an
unknown goal type. By inspecting the goal, the <code>tau</code> can then decide
what to do (to not do anything, use <a href="#trefl"><code>trefl</code></a>).</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">t_pointwise</span> <span class="pl-c1">(</span><span class="pl-en">d</span><span class="pl-c1">:</span><span class="pl-en">direction</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">tau</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
  <span class="pl-k">let</span> <span class="pl-en">ctrl</span> <span class="pl-c1">(</span><span class="pl-en">t</span><span class="pl-c1">:</span><span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(bool</span> <span class="pl-c1">&amp;</span> <span class="pl-en">ctrl_flag</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
    <span class="pl-c1">true</span><span class="pl-c1">,</span> <span class="pl-c1">Continue</span>
  <span class="pl-k">in</span>
  <span class="pl-k">let</span> <span class="pl-en">rw</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">tau</span> <span class="pl-c1">()</span>
  <span class="pl-k">in</span>
  <span class="pl-en">ctrl_rewrite</span> <span class="pl-en">d</span> <span class="pl-en">ctrl</span> <span class="pl-en">rw</span></pre></div>
<h4>
<a id="user-content-topdown_rewrite" class="anchor" href="#topdown_rewrite" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>topdown_rewrite</h4>
<p><code>topdown_rewrite ctrl rw</code> is used to rewrite those sub-terms <code>t</code>
of the goal on which <code>fst (ctrl t)</code> returns true.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">topdown_rewrite</span> <span class="pl-c1">(</span><span class="pl-en">ctrl</span> <span class="pl-c1">:</span> <span class="pl-en">term</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(bool</span> * <span class="pl-c1">int))</span>
                    <span class="pl-c1">(</span><span class="pl-en">rw</span><span class="pl-c1">:unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span>
  <span class="pl-c1">=</span> <span class="pl-k">let</span> <span class="pl-en">ctrl'</span> <span class="pl-c1">(</span><span class="pl-en">t</span><span class="pl-c1">:</span><span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(bool</span> <span class="pl-c1">&amp;</span> <span class="pl-en">ctrl_flag</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
      <span class="pl-k">let</span> <span class="pl-en">b</span><span class="pl-c1">,</span> <span class="pl-en">i</span> <span class="pl-c1">=</span> <span class="pl-en">ctrl</span> <span class="pl-en">t</span> <span class="pl-k">in</span>
      <span class="pl-k">let</span> <span class="pl-en">f</span> <span class="pl-c1">=</span>
        <span class="pl-k">match</span> <span class="pl-en">i</span> <span class="pl-k">with</span>
        <span class="pl-c1">|</span> <span class="pl-c1">0</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Continue</span>
        <span class="pl-c1">|</span> <span class="pl-c1">1</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Skip</span>
        <span class="pl-c1">|</span> <span class="pl-c1">2</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Abort</span>
        <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>topdown_rewrite: bad value from ctrl<span class="pl-pds">"</span></span>
      <span class="pl-k">in</span>
      <span class="pl-en">b</span><span class="pl-c1">,</span> <span class="pl-en">f</span>
    <span class="pl-k">in</span>
    <span class="pl-en">ctrl_rewrite</span> <span class="pl-c1">TopDown</span> <span class="pl-en">ctrl'</span> <span class="pl-en">rw</span></pre></div>
<p>On each such sub-term, <code>rw</code> is presented with an equality of goal
of the form <code>Gamma |= t == ?u</code>. When <code>rw</code> proves the goal,
the engine will rewrite <code>t</code> for <code>?u</code> in the original goal
type.</p>
<p>The goal formula is traversed top-down and the traversal can be
controlled by <code>snd (ctrl t)</code>:</p>
<p>When <code>snd (ctrl t) = 0</code>, the traversal continues down through the
position in the goal term.</p>
<p>When <code>snd (ctrl t) = 1</code>, the traversal continues to the next
sub-tree of the goal.</p>
<p>When <code>snd (ctrl t) = 2</code>, no more rewrites are performed in the
goal.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">pointwise</span>  <span class="pl-c1">(</span><span class="pl-en">tau</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span> <span class="pl-en">t_pointwise</span> <span class="pl-c1">BottomUp</span> <span class="pl-en">tau</span>
<span class="pl-k">let</span> <span class="pl-en">pointwise'</span> <span class="pl-c1">(</span><span class="pl-en">tau</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span> <span class="pl-en">t_pointwise</span> <span class="pl-c1">TopDown</span>  <span class="pl-en">tau</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">cur_module</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">name</span> <span class="pl-c1">=</span>
    <span class="pl-en">moduleof</span> <span class="pl-c1">(</span><span class="pl-en">top_env</span> <span class="pl-c1">())</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">open_modules</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(</span><span class="pl-en">list</span> <span class="pl-en">name</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
    <span class="pl-en">env_open_modules</span> <span class="pl-c1">(</span><span class="pl-en">top_env</span> <span class="pl-c1">())</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">repeatn</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">n</span> <span class="pl-c1">:</span> <span class="pl-c1">int)</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(</span><span class="pl-en">list</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
    <span class="pl-k">if</span> <span class="pl-en">n</span> &lt;<span class="pl-c1">=</span> <span class="pl-c1">0</span>
    <span class="pl-k">then</span> <span class="pl-c1">[]</span>
    <span class="pl-k">else</span> <span class="pl-en">t</span> <span class="pl-c1">()</span> <span class="pl-c1">::</span> <span class="pl-en">repeatn</span> <span class="pl-c1">(</span><span class="pl-en">n</span> <span class="pl-c1">-</span> <span class="pl-c1">1</span><span class="pl-c1">)</span> <span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">fresh_uvar</span> <span class="pl-c1">(</span><span class="pl-en">o</span> <span class="pl-c1">:</span> <span class="pl-en">option</span> <span class="pl-en">typ</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">e</span> <span class="pl-c1">=</span> <span class="pl-en">cur_env</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-en">uvar_env</span> <span class="pl-en">e</span> <span class="pl-en">o</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">unify</span> <span class="pl-c1">(</span><span class="pl-en">t1</span> <span class="pl-en">t2</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">bool</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">e</span> <span class="pl-c1">=</span> <span class="pl-en">cur_env</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-en">unify_env</span> <span class="pl-en">e</span> <span class="pl-en">t1</span> <span class="pl-en">t2</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">unify_guard</span> <span class="pl-c1">(</span><span class="pl-en">t1</span> <span class="pl-en">t2</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">bool</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">e</span> <span class="pl-c1">=</span> <span class="pl-en">cur_env</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-en">unify_guard_env</span> <span class="pl-en">e</span> <span class="pl-en">t1</span> <span class="pl-en">t2</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">tmatch</span> <span class="pl-c1">(</span><span class="pl-en">t1</span> <span class="pl-en">t2</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">bool</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">e</span> <span class="pl-c1">=</span> <span class="pl-en">cur_env</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-en">match_env</span> <span class="pl-en">e</span> <span class="pl-en">t1</span> <span class="pl-en">t2</span></pre></div>
<h4>
<a id="user-content-divide" class="anchor" href="#divide" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>divide</h4>
<p><code>divide n t1 t2</code> will split the current set of goals into the <code>n</code>
first ones, and the rest. It then runs <code>t1</code> on the first set, and <code>t2</code>
on the second, returning both results (and concatenating remaining goals).</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">divide</span> <span class="pl-c1">(</span><span class="pl-en">n</span><span class="pl-c1">:int)</span> <span class="pl-c1">(</span><span class="pl-en">l</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">r</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'b</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(</span><span class="pl-smi">'a</span> * <span class="pl-smi">'b</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
    <span class="pl-k">if</span> <span class="pl-en">n</span> &lt; <span class="pl-c1">0</span> <span class="pl-k">then</span>
      <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>divide: negative n<span class="pl-pds">"</span></span><span class="pl-c1">;</span>
    <span class="pl-k">let</span> <span class="pl-en">gs</span><span class="pl-c1">,</span> <span class="pl-en">sgs</span> <span class="pl-c1">=</span> <span class="pl-en">goals</span> <span class="pl-c1">(),</span> <span class="pl-en">smt_goals</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-k">let</span> <span class="pl-en">gs1</span><span class="pl-c1">,</span> <span class="pl-en">gs2</span> <span class="pl-c1">=</span> <span class="pl-smi">List.Tot.Base.</span><span class="pl-en">splitAt</span> <span class="pl-en">n</span> <span class="pl-en">gs</span> <span class="pl-k">in</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-en">set_goals</span> <span class="pl-en">gs1</span><span class="pl-c1">;</span> <span class="pl-en">set_smt_goals</span> <span class="pl-c1">[];</span>
<span class="pl-k">let</span> <span class="pl-en">x</span> <span class="pl-c1">=</span> <span class="pl-en">l</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
<span class="pl-k">let</span> <span class="pl-en">gsl</span><span class="pl-c1">,</span> <span class="pl-en">sgsl</span> <span class="pl-c1">=</span> <span class="pl-en">goals</span> <span class="pl-c1">(),</span> <span class="pl-en">smt_goals</span> <span class="pl-c1">()</span> <span class="pl-k">in</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-en">set_goals</span> <span class="pl-en">gs2</span><span class="pl-c1">;</span> <span class="pl-en">set_smt_goals</span> <span class="pl-c1">[];</span>
<span class="pl-k">let</span> <span class="pl-en">y</span> <span class="pl-c1">=</span> <span class="pl-en">r</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
<span class="pl-k">let</span> <span class="pl-en">gsr</span><span class="pl-c1">,</span> <span class="pl-en">sgsr</span> <span class="pl-c1">=</span> <span class="pl-en">goals</span> <span class="pl-c1">(),</span> <span class="pl-en">smt_goals</span> <span class="pl-c1">()</span> <span class="pl-k">in</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-en">set_goals</span> <span class="pl-c1">(</span><span class="pl-en">gsl</span> @ <span class="pl-en">gsr</span><span class="pl-c1">);</span> <span class="pl-en">set_smt_goals</span> <span class="pl-c1">(</span><span class="pl-en">sgs</span> @ <span class="pl-en">sgsl</span> @ <span class="pl-en">sgsr</span><span class="pl-c1">);</span>
<span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">,</span> <span class="pl-en">y</span><span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">iseq</span> <span class="pl-c1">(</span><span class="pl-en">ts</span> <span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-c1">(unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit))</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">ts</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-en">t</span><span class="pl-c1">::</span><span class="pl-en">ts</span> <span class="pl-c1">-&gt;</span> <span class="pl-k">let</span> <span class="pl-c1">_</span> <span class="pl-c1">=</span> <span class="pl-en">divide</span> <span class="pl-c1">1</span> <span class="pl-en">t</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">iseq</span> <span class="pl-en">ts</span><span class="pl-c1">)</span> <span class="pl-k">in</span> <span class="pl-c1">()</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span>    <span class="pl-c1">-&gt;</span> <span class="pl-c1">()</span></pre></div>
<h4>
<a id="user-content-focus" class="anchor" href="#focus" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>focus</h4>
<p><code>focus t</code> runs <code>t ()</code> on the current active goal, hiding all others
and restoring them at the end.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">focus</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">goals</span> <span class="pl-c1">()</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>focus: no goals<span class="pl-pds">"</span></span>
    <span class="pl-c1">|</span> <span class="pl-en">g</span><span class="pl-c1">::</span><span class="pl-en">gs</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">sgs</span> <span class="pl-c1">=</span> <span class="pl-en">smt_goals</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
        <span class="pl-en">set_goals</span> <span class="pl-c1">[</span><span class="pl-en">g</span><span class="pl-c1">];</span> <span class="pl-en">set_smt_goals</span> <span class="pl-c1">[];</span>
        <span class="pl-k">let</span> <span class="pl-en">x</span> <span class="pl-c1">=</span> <span class="pl-en">t</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
        <span class="pl-en">set_goals</span> <span class="pl-c1">(</span><span class="pl-en">goals</span> <span class="pl-c1">()</span> @ <span class="pl-en">gs</span><span class="pl-c1">);</span> <span class="pl-en">set_smt_goals</span> <span class="pl-c1">(</span><span class="pl-en">smt_goals</span> <span class="pl-c1">()</span> @ <span class="pl-en">sgs</span><span class="pl-c1">);</span>
        <span class="pl-en">x</span></pre></div>
<h4>
<a id="user-content-dump1" class="anchor" href="#dump1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>dump1</h4>
<p>Similar to <code>dump</code>, but only dumping the current goal.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">dump1</span> <span class="pl-c1">(</span><span class="pl-en">m</span> <span class="pl-c1">:</span> <span class="pl-c1">string)</span> <span class="pl-c1">=</span> <span class="pl-en">focus</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">dump</span> <span class="pl-en">m</span><span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">mapAll</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(</span><span class="pl-en">list</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">goals</span> <span class="pl-c1">()</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">[]</span>
    <span class="pl-c1">|</span> <span class="pl-c1">_</span><span class="pl-c1">::</span><span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-k">let</span> <span class="pl-c1">(</span><span class="pl-en">h</span><span class="pl-c1">,</span> <span class="pl-en">t</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-en">divide</span> <span class="pl-c1">1</span> <span class="pl-en">t</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">mapAll</span> <span class="pl-en">t</span><span class="pl-c1">)</span> <span class="pl-k">in</span> <span class="pl-en">h</span><span class="pl-c1">::</span><span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">iterAll</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span></pre></div>
<p>Could use mapAll, but why even build that list</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">match</span> <span class="pl-en">goals</span> <span class="pl-c1">()</span> <span class="pl-k">with</span>
<span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">()</span>
<span class="pl-c1">|</span> <span class="pl-c1">_</span><span class="pl-c1">::</span><span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-k">let</span> <span class="pl-c1">_</span> <span class="pl-c1">=</span> <span class="pl-en">divide</span> <span class="pl-c1">1</span> <span class="pl-en">t</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">iterAll</span> <span class="pl-en">t</span><span class="pl-c1">)</span> <span class="pl-k">in</span> <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">iterAllSMT</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">gs</span><span class="pl-c1">,</span> <span class="pl-en">sgs</span> <span class="pl-c1">=</span> <span class="pl-en">goals</span> <span class="pl-c1">(),</span> <span class="pl-en">smt_goals</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-en">set_goals</span> <span class="pl-en">sgs</span><span class="pl-c1">;</span>
    <span class="pl-en">set_smt_goals</span> <span class="pl-c1">[];</span>
    <span class="pl-en">iterAll</span> <span class="pl-en">t</span><span class="pl-c1">;</span>
    <span class="pl-k">let</span> <span class="pl-en">gs'</span><span class="pl-c1">,</span> <span class="pl-en">sgs'</span> <span class="pl-c1">=</span> <span class="pl-en">goals</span> <span class="pl-c1">(),</span> <span class="pl-en">smt_goals</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-en">set_goals</span> <span class="pl-en">gs</span><span class="pl-c1">;</span>
    <span class="pl-en">set_smt_goals</span> <span class="pl-c1">(</span><span class="pl-en">gs'</span>@<span class="pl-en">sgs'</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-seq" class="anchor" href="#seq" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>seq</h4>
<p>Runs tactic <code>t1</code> on the current goal, and then tactic <code>t2</code> on <em>each</em>
subgoal produced by <code>t1</code>. Each invocation of <code>t2</code> runs on a proofstate
with a single goal (they're "focused").</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">seq</span> <span class="pl-c1">(</span><span class="pl-en">f</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit)</span> <span class="pl-c1">(</span><span class="pl-en">g</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">focus</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">f</span> <span class="pl-c1">();</span> <span class="pl-en">iterAll</span> <span class="pl-en">g</span><span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">exact_args</span> <span class="pl-c1">(</span><span class="pl-en">qs</span> <span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-en">aqualv</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">focus</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">n</span> <span class="pl-c1">=</span> <span class="pl-smi">List.Tot.Base.</span><span class="pl-en">length</span> <span class="pl-en">qs</span> <span class="pl-k">in</span>
        <span class="pl-k">let</span> <span class="pl-en">uvs</span> <span class="pl-c1">=</span> <span class="pl-en">repeatn</span> <span class="pl-en">n</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fresh_uvar</span> <span class="pl-c1">None</span><span class="pl-c1">)</span> <span class="pl-k">in</span>
        <span class="pl-k">let</span> <span class="pl-en">t'</span> <span class="pl-c1">=</span> <span class="pl-en">mk_app</span> <span class="pl-en">t</span> <span class="pl-c1">(</span><span class="pl-en">zip</span> <span class="pl-en">uvs</span> <span class="pl-en">qs</span><span class="pl-c1">)</span> <span class="pl-k">in</span>
        <span class="pl-en">exact</span> <span class="pl-en">t'</span><span class="pl-c1">;</span>
        <span class="pl-en">iter</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">uv</span> <span class="pl-c1">-&gt;</span> <span class="pl-k">if</span> <span class="pl-en">is_uvar</span> <span class="pl-en">uv</span>
                        <span class="pl-k">then</span> <span class="pl-en">unshelve</span> <span class="pl-en">uv</span>
                        <span class="pl-k">else</span> <span class="pl-c1">())</span> <span class="pl-c1">(</span><span class="pl-smi">L.</span><span class="pl-en">rev</span> <span class="pl-en">uvs</span><span class="pl-c1">)</span>
    <span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">exact_n</span> <span class="pl-c1">(</span><span class="pl-en">n</span> <span class="pl-c1">:</span> <span class="pl-c1">int)</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">exact_args</span> <span class="pl-c1">(</span><span class="pl-en">repeatn</span> <span class="pl-en">n</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Q_Explicit</span><span class="pl-c1">))</span> <span class="pl-en">t</span></pre></div>
<h4>
<a id="user-content-ngoals" class="anchor" href="#ngoals" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ngoals</h4>
<p><code>ngoals ()</code> returns the number of goals</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">ngoals</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">int</span> <span class="pl-c1">=</span> <span class="pl-smi">List.Tot.Base.</span><span class="pl-en">length</span> <span class="pl-c1">(</span><span class="pl-en">goals</span> <span class="pl-c1">())</span></pre></div>
<h4>
<a id="user-content-ngoals_smt" class="anchor" href="#ngoals_smt" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ngoals_smt</h4>
<p><code>ngoals_smt ()</code> returns the number of SMT goals</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">ngoals_smt</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">int</span> <span class="pl-c1">=</span> <span class="pl-smi">List.Tot.Base.</span><span class="pl-en">length</span> <span class="pl-c1">(</span><span class="pl-en">smt_goals</span> <span class="pl-c1">())</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">fresh_bv</span> <span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">bv</span> <span class="pl-c1">=</span></pre></div>
<p>These bvs are fresh anyway through a separate counter,
* but adding the integer allows for more readability when
* generating code</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">i</span> <span class="pl-c1">=</span> <span class="pl-en">fresh</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
<span class="pl-en">fresh_bv_named</span> <span class="pl-c1">(</span><span class="pl-s"><span class="pl-pds">"</span>x<span class="pl-pds">"</span></span> <span class="pl-c1">^</span> <span class="pl-en">string_of_int</span> <span class="pl-en">i</span><span class="pl-c1">)</span> <span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">fresh_binder_named</span> <span class="pl-en">nm</span> <span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">binder</span> <span class="pl-c1">=</span>
    <span class="pl-en">mk_binder</span> <span class="pl-c1">(</span><span class="pl-en">fresh_bv_named</span> <span class="pl-en">nm</span> <span class="pl-en">t</span><span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">fresh_binder</span> <span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">binder</span> <span class="pl-c1">=</span></pre></div>
<p>See comment in fresh_bv</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">i</span> <span class="pl-c1">=</span> <span class="pl-en">fresh</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
<span class="pl-en">fresh_binder_named</span> <span class="pl-c1">(</span><span class="pl-s"><span class="pl-pds">"</span>x<span class="pl-pds">"</span></span> <span class="pl-c1">^</span> <span class="pl-en">string_of_int</span> <span class="pl-en">i</span><span class="pl-c1">)</span> <span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">fresh_implicit_binder_named</span> <span class="pl-en">nm</span> <span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">binder</span> <span class="pl-c1">=</span>
    <span class="pl-en">mk_implicit_binder</span> <span class="pl-c1">(</span><span class="pl-en">fresh_bv_named</span> <span class="pl-en">nm</span> <span class="pl-en">t</span><span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">fresh_implicit_binder</span> <span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">binder</span> <span class="pl-c1">=</span></pre></div>
<p>See comment in fresh_bv</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">i</span> <span class="pl-c1">=</span> <span class="pl-en">fresh</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
<span class="pl-en">fresh_implicit_binder_named</span> <span class="pl-c1">(</span><span class="pl-s"><span class="pl-pds">"</span>x<span class="pl-pds">"</span></span> <span class="pl-c1">^</span> <span class="pl-en">string_of_int</span> <span class="pl-en">i</span><span class="pl-c1">)</span> <span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">guard</span> <span class="pl-c1">(</span><span class="pl-en">b</span> <span class="pl-c1">:</span> <span class="pl-c1">bool)</span> <span class="pl-c1">:</span> <span class="pl-c1">TacH</span> <span class="pl-c1">unit</span> <span class="pl-c1">(</span><span class="pl-en">requires</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">True</span><span class="pl-c1">))</span>
                                 <span class="pl-c1">(</span><span class="pl-en">ensures</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">ps</span> <span class="pl-en">r</span> <span class="pl-c1">-&gt;</span> <span class="pl-k">if</span> <span class="pl-en">b</span>
                                                       <span class="pl-k">then</span> <span class="pl-c1">Success</span><span class="pl-c1">?</span> <span class="pl-en">r</span> <span class="pl-c1">/\</span> <span class="pl-c1">Success</span><span class="pl-c1">?.</span><span class="pl-en">ps</span> <span class="pl-en">r</span> <span class="pl-c1">==</span> <span class="pl-en">ps</span>
                                                       <span class="pl-k">else</span> <span class="pl-c1">Failed</span><span class="pl-c1">?</span> <span class="pl-en">r</span><span class="pl-c1">))</span></pre></div>
<p>^ the proofstate on failure is not exactly equal (has the psc set)</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-c1">=</span>
<span class="pl-k">if</span> <span class="pl-en">not</span> <span class="pl-en">b</span> <span class="pl-k">then</span>
    <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>guard failed<span class="pl-pds">"</span></span>
<span class="pl-k">else</span> <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">try_with</span> <span class="pl-c1">(</span><span class="pl-en">f</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">h</span> <span class="pl-c1">:</span> <span class="pl-en">exn</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">catch</span> <span class="pl-en">f</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Inl</span> <span class="pl-en">e</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">h</span> <span class="pl-en">e</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Inr</span> <span class="pl-en">x</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">x</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">trytac</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(</span><span class="pl-en">option</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
    <span class="pl-k">try</span> <span class="pl-c1">Some</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">())</span>
    <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">None</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">or_else</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">t1</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">t2</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">a</span> <span class="pl-c1">=</span>
    <span class="pl-k">try</span> <span class="pl-en">t1</span> <span class="pl-c1">()</span>
    <span class="pl-k">with</span> <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">t2</span> <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-c1">(</span>&lt;<span class="pl-c1">|&gt;)</span> <span class="pl-c1">:</span> <span class="pl-c1">(unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">-&gt;</span>
            <span class="pl-c1">(unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">-&gt;</span>
            <span class="pl-c1">(unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span>
<span class="pl-k">let</span> <span class="pl-c1">(</span>&lt;<span class="pl-c1">|&gt;)</span> <span class="pl-en">t1</span> <span class="pl-en">t2</span> <span class="pl-c1">=</span> <span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">or_else</span> <span class="pl-en">t1</span> <span class="pl-en">t2</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">first</span> <span class="pl-c1">(</span><span class="pl-en">ts</span> <span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-c1">(unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">))</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span> <span class="pl-c1">=</span>
    <span class="pl-smi">L.</span><span class="pl-en">fold_right</span> <span class="pl-c1">(</span>&lt;<span class="pl-c1">|&gt;)</span> <span class="pl-en">ts</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>no tactics to try<span class="pl-pds">"</span></span><span class="pl-c1">)</span> <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">repeat</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(</span><span class="pl-en">list</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">catch</span> <span class="pl-en">t</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Inl</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">[]</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Inr</span> <span class="pl-en">x</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">x</span> <span class="pl-c1">::</span> <span class="pl-en">repeat</span> <span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">repeat1</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(</span><span class="pl-en">list</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
    <span class="pl-en">t</span> <span class="pl-c1">()</span> <span class="pl-c1">::</span> <span class="pl-en">repeat</span> <span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">repeat'</span> <span class="pl-c1">(</span><span class="pl-en">f</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-c1">_</span> <span class="pl-c1">=</span> <span class="pl-en">repeat</span> <span class="pl-en">f</span> <span class="pl-k">in</span> <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">norm_term</span> <span class="pl-c1">(</span><span class="pl-en">s</span> <span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-en">norm_step</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">e</span> <span class="pl-c1">=</span>
        <span class="pl-k">try</span> <span class="pl-en">cur_env</span> <span class="pl-c1">()</span>
        <span class="pl-k">with</span> <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">top_env</span> <span class="pl-c1">()</span>
    <span class="pl-k">in</span>
    <span class="pl-en">norm_term_env</span> <span class="pl-en">e</span> <span class="pl-en">s</span> <span class="pl-en">t</span></pre></div>
<h4>
<a id="user-content-join_all_smt_goals" class="anchor" href="#join_all_smt_goals" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>join_all_smt_goals</h4>
<p>Join all of the SMT goals into one. This helps when all of them are
expected to be similar, and therefore easier to prove at once by the SMT
solver. TODO: would be nice to try to join them in a more meaningful
way, as the order can matter.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">join_all_smt_goals</span> <span class="pl-c1">()</span> <span class="pl-c1">=</span>
  <span class="pl-k">let</span> <span class="pl-en">gs</span><span class="pl-c1">,</span> <span class="pl-en">sgs</span> <span class="pl-c1">=</span> <span class="pl-en">goals</span> <span class="pl-c1">(),</span> <span class="pl-en">smt_goals</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
  <span class="pl-en">set_smt_goals</span> <span class="pl-c1">[];</span>
  <span class="pl-en">set_goals</span> <span class="pl-en">sgs</span><span class="pl-c1">;</span>
  <span class="pl-en">repeat'</span> <span class="pl-en">join</span><span class="pl-c1">;</span>
  <span class="pl-k">let</span> <span class="pl-en">sgs'</span> <span class="pl-c1">=</span> <span class="pl-en">goals</span> <span class="pl-c1">()</span> <span class="pl-k">in</span> <span class="pl-c">// should be a single one</span>
  <span class="pl-en">set_goals</span> <span class="pl-en">gs</span><span class="pl-c1">;</span>
  <span class="pl-en">set_smt_goals</span> <span class="pl-en">sgs'</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">discard</span> <span class="pl-c1">(</span><span class="pl-en">tau</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-k">let</span> <span class="pl-c1">_</span> <span class="pl-c1">=</span> <span class="pl-en">tau</span> <span class="pl-c1">()</span> <span class="pl-k">in</span> <span class="pl-c1">()</span></pre></div>
<p>TODO: do we want some value out of this?</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">repeatseq</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-c1">_</span> <span class="pl-c1">=</span> <span class="pl-en">trytac</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">(</span><span class="pl-en">discard</span> <span class="pl-en">t</span><span class="pl-c1">)</span> <span class="pl-c1">`</span><span class="pl-en">seq</span><span class="pl-c1">`</span> <span class="pl-c1">(</span><span class="pl-en">discard</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">repeatseq</span> <span class="pl-en">t</span><span class="pl-c1">)))</span> <span class="pl-k">in</span> <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">tadmit</span> <span class="pl-c1">()</span> <span class="pl-c1">=</span> <span class="pl-en">tadmit_t</span> <span class="pl-c1">(`())</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">admit1</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">tadmit</span> <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">admit_all</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-c1">_</span> <span class="pl-c1">=</span> <span class="pl-en">repeat</span> <span class="pl-en">tadmit</span> <span class="pl-k">in</span>
    <span class="pl-c1">()</span></pre></div>
<h4>
<a id="user-content-is_guard" class="anchor" href="#is_guard" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>is_guard</h4>
<p><a href="#is_guard"><code>is_guard</code></a> returns whether the current goal arised from a typechecking guard</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">is_guard</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">bool</span> <span class="pl-c1">=</span>
    <span class="pl-smi">Tactics.Types.</span><span class="pl-en">is_guard</span> <span class="pl-c1">(</span><span class="pl-en">_cur_goal</span> <span class="pl-c1">())</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">skip_guard</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">if</span> <span class="pl-en">is_guard</span> <span class="pl-c1">()</span>
    <span class="pl-k">then</span> <span class="pl-en">smt</span> <span class="pl-c1">()</span>
    <span class="pl-k">else</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">guards_to_smt</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-c1">_</span> <span class="pl-c1">=</span> <span class="pl-en">repeat</span> <span class="pl-en">skip_guard</span> <span class="pl-k">in</span>
    <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">simpl</span>   <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span> <span class="pl-en">norm</span> <span class="pl-c1">[</span><span class="pl-en">simplify</span><span class="pl-c1">;</span> <span class="pl-en">primops</span><span class="pl-c1">]</span>
<span class="pl-k">let</span> <span class="pl-en">whnf</span>    <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span> <span class="pl-en">norm</span> <span class="pl-c1">[</span><span class="pl-en">weak</span><span class="pl-c1">;</span> <span class="pl-en">hnf</span><span class="pl-c1">;</span> <span class="pl-en">primops</span><span class="pl-c1">;</span> <span class="pl-en">delta</span><span class="pl-c1">]</span>
<span class="pl-k">let</span> <span class="pl-en">compute</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span> <span class="pl-en">norm</span> <span class="pl-c1">[</span><span class="pl-en">primops</span><span class="pl-c1">;</span> <span class="pl-en">iota</span><span class="pl-c1">;</span> <span class="pl-en">delta</span><span class="pl-c1">;</span> <span class="pl-en">zeta</span><span class="pl-c1">]</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">intros</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(</span><span class="pl-en">list</span> <span class="pl-en">binder</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-en">repeat</span> <span class="pl-en">intro</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">intros'</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span> <span class="pl-k">let</span> <span class="pl-c1">_</span> <span class="pl-c1">=</span> <span class="pl-en">intros</span> <span class="pl-c1">()</span> <span class="pl-k">in</span> <span class="pl-c1">()</span>
<span class="pl-k">let</span> <span class="pl-en">destruct</span> <span class="pl-en">tm</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span> <span class="pl-k">let</span> <span class="pl-c1">_</span> <span class="pl-c1">=</span> <span class="pl-en">t_destruct</span> <span class="pl-en">tm</span> <span class="pl-k">in</span> <span class="pl-c1">()</span>
<span class="pl-k">let</span> <span class="pl-en">destruct_intros</span> <span class="pl-en">tm</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span> <span class="pl-en">seq</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-k">let</span> <span class="pl-c1">_</span> <span class="pl-c1">=</span> <span class="pl-en">t_destruct</span> <span class="pl-en">tm</span> <span class="pl-k">in</span> <span class="pl-c1">())</span> <span class="pl-en">intros'</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">__cut</span> <span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">(</span><span class="pl-en">b</span><span class="pl-c1">:Type)</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">b</span><span class="pl-c1">)</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">b</span>
<span class="pl-k">private</span> <span class="pl-k">let</span> <span class="pl-en">__cut</span> <span class="pl-en">a</span> <span class="pl-en">b</span> <span class="pl-en">f</span> <span class="pl-en">x</span> <span class="pl-c1">=</span> <span class="pl-en">f</span> <span class="pl-en">x</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">tcut</span> <span class="pl-c1">(</span><span class="pl-en">t</span><span class="pl-c1">:</span><span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">binder</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">g</span> <span class="pl-c1">=</span> <span class="pl-en">cur_goal</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-k">let</span> <span class="pl-en">tt</span> <span class="pl-c1">=</span> <span class="pl-en">mk_e_app</span> <span class="pl-c1">(`</span><span class="pl-en">__cut</span><span class="pl-c1">)</span> <span class="pl-c1">[</span><span class="pl-en">t</span><span class="pl-c1">;</span> <span class="pl-en">g</span><span class="pl-c1">]</span> <span class="pl-k">in</span>
    <span class="pl-en">apply</span> <span class="pl-en">tt</span><span class="pl-c1">;</span>
    <span class="pl-en">intro</span> <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">pose</span> <span class="pl-c1">(</span><span class="pl-en">t</span><span class="pl-c1">:</span><span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">binder</span> <span class="pl-c1">=</span>
    <span class="pl-en">apply</span> <span class="pl-c1">(`</span><span class="pl-en">__cut</span><span class="pl-c1">);</span>
    <span class="pl-en">flip</span> <span class="pl-c1">();</span>
    <span class="pl-en">exact</span> <span class="pl-en">t</span><span class="pl-c1">;</span>
    <span class="pl-en">intro</span> <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">intro_as</span> <span class="pl-c1">(</span><span class="pl-en">s</span><span class="pl-c1">:string)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">binder</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">b</span> <span class="pl-c1">=</span> <span class="pl-en">intro</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-en">rename_to</span> <span class="pl-en">b</span> <span class="pl-en">s</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">pose_as</span> <span class="pl-c1">(</span><span class="pl-en">s</span><span class="pl-c1">:string)</span> <span class="pl-c1">(</span><span class="pl-en">t</span><span class="pl-c1">:</span><span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">binder</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">b</span> <span class="pl-c1">=</span> <span class="pl-en">pose</span> <span class="pl-en">t</span> <span class="pl-k">in</span>
    <span class="pl-en">rename_to</span> <span class="pl-en">b</span> <span class="pl-en">s</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">for_each_binder</span> <span class="pl-c1">(</span><span class="pl-en">f</span> <span class="pl-c1">:</span> <span class="pl-en">binder</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(</span><span class="pl-en">list</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
    <span class="pl-en">map</span> <span class="pl-en">f</span> <span class="pl-c1">(</span><span class="pl-en">cur_binders</span> <span class="pl-c1">())</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">revert_all</span> <span class="pl-c1">(</span><span class="pl-en">bs</span><span class="pl-c1">:</span><span class="pl-en">binders</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">bs</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">()</span>
    <span class="pl-c1">|</span> <span class="pl-c1">_</span><span class="pl-c1">::</span><span class="pl-en">tl</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">revert</span> <span class="pl-c1">();</span>
               <span class="pl-en">revert_all</span> <span class="pl-en">tl</span></pre></div>
<p>Some syntax utility functions</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">bv_to_term</span> <span class="pl-c1">(</span><span class="pl-en">bv</span> <span class="pl-c1">:</span> <span class="pl-en">bv</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span> <span class="pl-c1">=</span> <span class="pl-en">pack</span> <span class="pl-c1">(</span><span class="pl-c1">Tv_Var</span> <span class="pl-en">bv</span><span class="pl-c1">)</span>
<span class="pl-k">let</span> <span class="pl-en">binder_to_term</span> <span class="pl-c1">(</span><span class="pl-en">b</span> <span class="pl-c1">:</span> <span class="pl-en">binder</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span> <span class="pl-c1">=</span> <span class="pl-k">let</span> <span class="pl-en">bv</span><span class="pl-c1">,</span> <span class="pl-c1">_</span> <span class="pl-c1">=</span> <span class="pl-en">inspect_binder</span> <span class="pl-en">b</span> <span class="pl-k">in</span> <span class="pl-en">bv_to_term</span> <span class="pl-en">bv</span></pre></div>
<p>Cannot define this inside <code>assumption</code> due to #1091</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">private</span>
<span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">__assumption_aux</span> <span class="pl-c1">(</span><span class="pl-en">bs</span> <span class="pl-c1">:</span> <span class="pl-en">binders</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">bs</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>no assumption matches goal<span class="pl-pds">"</span></span>
    <span class="pl-c1">|</span> <span class="pl-en">b</span><span class="pl-c1">::</span><span class="pl-en">bs</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">t</span> <span class="pl-c1">=</span> <span class="pl-en">binder_to_term</span> <span class="pl-en">b</span> <span class="pl-k">in</span>
        <span class="pl-k">try</span> <span class="pl-en">exact</span> <span class="pl-en">t</span> <span class="pl-k">with</span> <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">try</span> <span class="pl-c1">(</span><span class="pl-en">apply</span> <span class="pl-c1">(`</span><span class="pl-smi">FStar.Squash.</span><span class="pl-en">return_squash</span><span class="pl-c1">);</span>
             <span class="pl-en">exact</span> <span class="pl-en">t</span><span class="pl-c1">)</span> <span class="pl-k">with</span> <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-en">__assumption_aux</span> <span class="pl-en">bs</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">assumption</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">__assumption_aux</span> <span class="pl-c1">(</span><span class="pl-en">cur_binders</span> <span class="pl-c1">())</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">destruct_equality_implication</span> <span class="pl-c1">(</span><span class="pl-en">t</span><span class="pl-c1">:</span><span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(</span><span class="pl-en">option</span> <span class="pl-c1">(</span><span class="pl-en">formula</span> * <span class="pl-en">term</span><span class="pl-c1">))</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">term_as_formula</span> <span class="pl-en">t</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Implies</span> <span class="pl-en">lhs</span> <span class="pl-en">rhs</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">lhs</span> <span class="pl-c1">=</span> <span class="pl-en">term_as_formula'</span> <span class="pl-en">lhs</span> <span class="pl-k">in</span>
        <span class="pl-k">begin</span> <span class="pl-k">match</span> <span class="pl-en">lhs</span> <span class="pl-k">with</span>
        <span class="pl-c1">|</span> <span class="pl-c1">Comp</span> <span class="pl-c1">(</span><span class="pl-c1">Eq</span> <span class="pl-c1">_</span><span class="pl-c1">)</span> <span class="pl-c1">_</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Some</span> <span class="pl-c1">(</span><span class="pl-en">lhs</span><span class="pl-c1">,</span> <span class="pl-en">rhs</span><span class="pl-c1">)</span>
        <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">None</span>
        <span class="pl-k">end</span>
    <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">None</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">private</span>
<span class="pl-k">let</span> <span class="pl-en">__eq_sym</span> <span class="pl-c1">#</span><span class="pl-en">t</span> <span class="pl-c1">(</span><span class="pl-en">a</span> <span class="pl-en">b</span> <span class="pl-c1">:</span> <span class="pl-en">t</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Lemma</span> <span class="pl-c1">((</span><span class="pl-en">a</span> <span class="pl-c1">==</span> <span class="pl-en">b</span><span class="pl-c1">)</span> <span class="pl-c1">==</span> <span class="pl-c1">(</span><span class="pl-en">b</span> <span class="pl-c1">==</span> <span class="pl-en">a</span><span class="pl-c1">))</span> <span class="pl-c1">=</span>
  <span class="pl-smi">FStar.PropositionalExtensionality.</span><span class="pl-en">apply</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">==</span><span class="pl-en">b</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">b</span><span class="pl-c1">==</span><span class="pl-en">a</span><span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-rewrite" class="anchor" href="#rewrite" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>rewrite'</h4>
<p>Like <code>rewrite</code>, but works with equalities <code>v == e</code> and <code>e == v</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">rewrite'</span> <span class="pl-c1">(</span><span class="pl-en">b</span><span class="pl-c1">:</span><span class="pl-en">binder</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-c1">((</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">rewrite</span> <span class="pl-en">b</span><span class="pl-c1">)</span>
     &lt;<span class="pl-c1">|&gt;</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">binder_retype</span> <span class="pl-en">b</span><span class="pl-c1">;</span>
                    <span class="pl-en">apply_lemma</span> <span class="pl-c1">(`</span><span class="pl-en">__eq_sym</span><span class="pl-c1">);</span>
                    <span class="pl-en">rewrite</span> <span class="pl-en">b</span><span class="pl-c1">)</span>
     &lt;<span class="pl-c1">|&gt;</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>rewrite' failed<span class="pl-pds">"</span></span><span class="pl-c1">))</span>
    <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">try_rewrite_equality</span> <span class="pl-c1">(</span><span class="pl-en">x</span><span class="pl-c1">:</span><span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">bs</span><span class="pl-c1">:</span><span class="pl-en">binders</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">bs</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">()</span>
    <span class="pl-c1">|</span> <span class="pl-en">x_t</span><span class="pl-c1">::</span><span class="pl-en">bs</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">begin</span> <span class="pl-k">match</span> <span class="pl-en">term_as_formula</span> <span class="pl-c1">(</span><span class="pl-en">type_of_binder</span> <span class="pl-en">x_t</span><span class="pl-c1">)</span> <span class="pl-k">with</span>
        <span class="pl-c1">|</span> <span class="pl-c1">Comp</span> <span class="pl-c1">(</span><span class="pl-c1">Eq</span> <span class="pl-c1">_</span><span class="pl-c1">)</span> <span class="pl-en">y</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
            <span class="pl-k">if</span> <span class="pl-en">term_eq</span> <span class="pl-en">x</span> <span class="pl-en">y</span>
            <span class="pl-k">then</span> <span class="pl-en">rewrite</span> <span class="pl-en">x_t</span>
            <span class="pl-k">else</span> <span class="pl-en">try_rewrite_equality</span> <span class="pl-en">x</span> <span class="pl-en">bs</span>
        <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
            <span class="pl-en">try_rewrite_equality</span> <span class="pl-en">x</span> <span class="pl-en">bs</span>
        <span class="pl-k">end</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">rewrite_all_context_equalities</span> <span class="pl-c1">(</span><span class="pl-en">bs</span><span class="pl-c1">:</span><span class="pl-en">binders</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">bs</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">()</span>
    <span class="pl-c1">|</span> <span class="pl-en">x_t</span><span class="pl-c1">::</span><span class="pl-en">bs</span> <span class="pl-c1">-&gt;</span> <span class="pl-k">begin</span>
        <span class="pl-c1">(</span><span class="pl-k">try</span> <span class="pl-en">rewrite</span> <span class="pl-en">x_t</span> <span class="pl-k">with</span> <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">());</span>
        <span class="pl-en">rewrite_all_context_equalities</span> <span class="pl-en">bs</span>
    <span class="pl-k">end</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">rewrite_eqs_from_context</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">rewrite_all_context_equalities</span> <span class="pl-c1">(</span><span class="pl-en">cur_binders</span> <span class="pl-c1">())</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">rewrite_equality</span> <span class="pl-c1">(</span><span class="pl-en">t</span><span class="pl-c1">:</span><span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">try_rewrite_equality</span> <span class="pl-en">t</span> <span class="pl-c1">(</span><span class="pl-en">cur_binders</span> <span class="pl-c1">())</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">unfold_def</span> <span class="pl-c1">(</span><span class="pl-en">t</span><span class="pl-c1">:</span><span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">inspect</span> <span class="pl-en">t</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_FVar</span> <span class="pl-en">fv</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">n</span> <span class="pl-c1">=</span> <span class="pl-en">implode_qn</span> <span class="pl-c1">(</span><span class="pl-en">inspect_fv</span> <span class="pl-en">fv</span><span class="pl-c1">)</span> <span class="pl-k">in</span>
        <span class="pl-en">norm</span> <span class="pl-c1">[</span><span class="pl-en">delta_fully</span> <span class="pl-c1">[</span><span class="pl-en">n</span><span class="pl-c1">]]</span>
    <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>unfold_def: term is not a fv<span class="pl-pds">"</span></span></pre></div>
<h4>
<a id="user-content-l_to_r" class="anchor" href="#l_to_r" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>l_to_r</h4>
<p>Rewrites left-to-right, and bottom-up, given a set of lemmas stating
equalities. The lemmas need to prove <em>propositional</em> equalities, that
is, using <code>==</code>.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">l_to_r</span> <span class="pl-c1">(</span><span class="pl-en">lems</span><span class="pl-c1">:</span><span class="pl-en">list</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">first_or_trefl</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
        <span class="pl-en">fold_left</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">k</span> <span class="pl-en">l</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span>
                    <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">apply_lemma_rw</span> <span class="pl-en">l</span><span class="pl-c1">)</span>
                    <span class="pl-c1">`</span><span class="pl-en">or_else</span><span class="pl-c1">`</span> <span class="pl-en">k</span><span class="pl-c1">)</span>
                  <span class="pl-en">trefl</span> <span class="pl-en">lems</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-en">pointwise</span> <span class="pl-en">first_or_trefl</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">mk_squash</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-en">term</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">sq</span> <span class="pl-c1">:</span> <span class="pl-en">term</span> <span class="pl-c1">=</span> <span class="pl-en">pack_ln</span> <span class="pl-c1">(</span><span class="pl-c1">Tv_FVar</span> <span class="pl-c1">(</span><span class="pl-en">pack_fv</span> <span class="pl-en">squash_qn</span><span class="pl-c1">))</span> <span class="pl-k">in</span>
    <span class="pl-en">mk_e_app</span> <span class="pl-en">sq</span> <span class="pl-c1">[</span><span class="pl-en">t</span><span class="pl-c1">]</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">mk_sq_eq</span> <span class="pl-c1">(</span><span class="pl-en">t1</span> <span class="pl-en">t2</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-en">term</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">eq</span> <span class="pl-c1">:</span> <span class="pl-en">term</span> <span class="pl-c1">=</span> <span class="pl-en">pack_ln</span> <span class="pl-c1">(</span><span class="pl-c1">Tv_FVar</span> <span class="pl-c1">(</span><span class="pl-en">pack_fv</span> <span class="pl-en">eq2_qn</span><span class="pl-c1">))</span> <span class="pl-k">in</span>
    <span class="pl-en">mk_squash</span> <span class="pl-c1">(</span><span class="pl-en">mk_e_app</span> <span class="pl-en">eq</span> <span class="pl-c1">[</span><span class="pl-en">t1</span><span class="pl-c1">;</span> <span class="pl-en">t2</span><span class="pl-c1">])</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">grewrite</span> <span class="pl-c1">(</span><span class="pl-en">t1</span> <span class="pl-en">t2</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">e</span> <span class="pl-c1">=</span> <span class="pl-en">tcut</span> <span class="pl-c1">(</span><span class="pl-en">mk_sq_eq</span> <span class="pl-en">t1</span> <span class="pl-en">t2</span><span class="pl-c1">)</span> <span class="pl-k">in</span>
    <span class="pl-k">let</span> <span class="pl-en">e</span> <span class="pl-c1">=</span> <span class="pl-en">pack_ln</span> <span class="pl-c1">(</span><span class="pl-c1">Tv_Var</span> <span class="pl-c1">(</span><span class="pl-en">bv_of_binder</span> <span class="pl-en">e</span><span class="pl-c1">))</span> <span class="pl-k">in</span>
    <span class="pl-en">pointwise</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-k">try</span> <span class="pl-en">exact</span> <span class="pl-en">e</span> <span class="pl-k">with</span> <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">trefl</span> <span class="pl-c1">())</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">private</span>
<span class="pl-k">let</span> <span class="pl-en">__un_sq_eq</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">x</span> <span class="pl-en">y</span> <span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-c1">_</span> <span class="pl-c1">:</span> <span class="pl-c1">(</span><span class="pl-en">x</span> <span class="pl-c1">==</span> <span class="pl-en">y</span><span class="pl-c1">))</span> <span class="pl-c1">:</span> <span class="pl-c1">Lemma</span> <span class="pl-c1">(</span><span class="pl-en">x</span> <span class="pl-c1">==</span> <span class="pl-en">y</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-c1">()</span></pre></div>
<h4>
<a id="user-content-grewrite_eq" class="anchor" href="#grewrite_eq" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>grewrite_eq</h4>
<p>A wrapper to <code>grewrite</code> which takes a binder of an equality type</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">grewrite_eq</span> <span class="pl-c1">(</span><span class="pl-en">b</span><span class="pl-c1">:</span><span class="pl-en">binder</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
  <span class="pl-k">match</span> <span class="pl-en">term_as_formula</span> <span class="pl-c1">(</span><span class="pl-en">type_of_binder</span> <span class="pl-en">b</span><span class="pl-c1">)</span> <span class="pl-k">with</span>
  <span class="pl-c1">|</span> <span class="pl-c1">Comp</span> <span class="pl-c1">(</span><span class="pl-c1">Eq</span> <span class="pl-c1">_</span><span class="pl-c1">)</span> <span class="pl-en">l</span> <span class="pl-en">r</span> <span class="pl-c1">-&gt;</span>
    <span class="pl-en">grewrite</span> <span class="pl-en">l</span> <span class="pl-en">r</span><span class="pl-c1">;</span>
    <span class="pl-en">iseq</span> <span class="pl-c1">[</span><span class="pl-en">idtac</span><span class="pl-c1">;</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">exact</span> <span class="pl-c1">(</span><span class="pl-en">binder_to_term</span> <span class="pl-en">b</span><span class="pl-c1">))]</span>
  <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
    <span class="pl-k">begin</span> <span class="pl-k">match</span> <span class="pl-en">term_as_formula'</span> <span class="pl-c1">(</span><span class="pl-en">type_of_binder</span> <span class="pl-en">b</span><span class="pl-c1">)</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Comp</span> <span class="pl-c1">(</span><span class="pl-c1">Eq</span> <span class="pl-c1">_</span><span class="pl-c1">)</span> <span class="pl-en">l</span> <span class="pl-en">r</span> <span class="pl-c1">-&gt;</span>
      <span class="pl-en">grewrite</span> <span class="pl-en">l</span> <span class="pl-en">r</span><span class="pl-c1">;</span>
      <span class="pl-en">iseq</span> <span class="pl-c1">[</span><span class="pl-en">idtac</span><span class="pl-c1">;</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">apply_lemma</span> <span class="pl-c1">(`</span><span class="pl-en">__un_sq_eq</span><span class="pl-c1">);</span>
                              <span class="pl-en">exact</span> <span class="pl-c1">(</span><span class="pl-en">binder_to_term</span> <span class="pl-en">b</span><span class="pl-c1">))]</span>
    <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
      <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>grewrite_eq: binder type is not an equality<span class="pl-pds">"</span></span>
    <span class="pl-k">end</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">push1</span> <span class="pl-c1">:</span> <span class="pl-c1">(#</span><span class="pl-en">p</span><span class="pl-c1">:Type)</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">(#</span><span class="pl-en">q</span><span class="pl-c1">:Type)</span> <span class="pl-c1">-&gt;</span>
                        <span class="pl-k">squash</span> <span class="pl-c1">(</span><span class="pl-en">p</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">q</span><span class="pl-c1">)</span> <span class="pl-c1">-&gt;</span>
                        <span class="pl-k">squash</span> <span class="pl-en">p</span> <span class="pl-c1">-&gt;</span>
                        <span class="pl-k">squash</span> <span class="pl-en">q</span>
<span class="pl-k">private</span> <span class="pl-k">let</span> <span class="pl-en">push1</span> <span class="pl-c1">#</span><span class="pl-en">p</span> <span class="pl-c1">#</span><span class="pl-en">q</span> <span class="pl-en">f</span> <span class="pl-en">u</span> <span class="pl-c1">=</span> <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-en">push1'</span> <span class="pl-c1">:</span> <span class="pl-c1">(#</span><span class="pl-en">p</span><span class="pl-c1">:Type)</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">(#</span><span class="pl-en">q</span><span class="pl-c1">:Type)</span> <span class="pl-c1">-&gt;</span>
                         <span class="pl-c1">(</span><span class="pl-en">p</span> <span class="pl-c1">==&gt;</span> <span class="pl-en">q</span><span class="pl-c1">)</span> <span class="pl-c1">-&gt;</span>
                         <span class="pl-k">squash</span> <span class="pl-en">p</span> <span class="pl-c1">-&gt;</span>
                         <span class="pl-k">squash</span> <span class="pl-en">q</span>
<span class="pl-k">private</span> <span class="pl-k">let</span> <span class="pl-en">push1'</span> <span class="pl-c1">#</span><span class="pl-en">p</span> <span class="pl-c1">#</span><span class="pl-en">q</span> <span class="pl-en">f</span> <span class="pl-en">u</span> <span class="pl-c1">=</span> <span class="pl-c1">()</span></pre></div>
<ul>
<li>Some easier applying, which should prevent frustation</li>
<li>(or cause more when it doesn't do what you wanted to)</li>
</ul>
<p>Before anything, try a vanilla apply and apply_lemma</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">apply_squash_or_lem</span> <span class="pl-c1">:</span> <span class="pl-en">d</span><span class="pl-c1">:nat</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">term</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span>
<span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">apply_squash_or_lem</span> <span class="pl-en">d</span> <span class="pl-en">t</span> <span class="pl-c1">=</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">try</span> <span class="pl-en">apply</span> <span class="pl-en">t</span> <span class="pl-k">with</span> <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
<span class="pl-k">try</span> <span class="pl-en">apply</span> <span class="pl-c1">(`</span><span class="pl-smi">FStar.Squash.</span><span class="pl-en">return_squash</span><span class="pl-c1">);</span> <span class="pl-en">apply</span> <span class="pl-en">t</span> <span class="pl-k">with</span> <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
<span class="pl-k">try</span> <span class="pl-en">apply_lemma</span> <span class="pl-en">t</span> <span class="pl-k">with</span> <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span></pre></div>
<p>Fuel cutoff, just in case.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">if</span> <span class="pl-en">d</span> &lt;<span class="pl-c1">=</span> <span class="pl-c1">0</span> <span class="pl-k">then</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>mapply: out of fuel<span class="pl-pds">"</span></span> <span class="pl-k">else</span> <span class="pl-k">begin</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">ty</span> <span class="pl-c1">=</span> <span class="pl-en">tc</span> <span class="pl-c1">(</span><span class="pl-en">cur_env</span> <span class="pl-c1">())</span> <span class="pl-en">t</span> <span class="pl-k">in</span>
<span class="pl-k">let</span> <span class="pl-en">tys</span><span class="pl-c1">,</span> <span class="pl-en">c</span> <span class="pl-c1">=</span> <span class="pl-en">collect_arr</span> <span class="pl-en">ty</span> <span class="pl-k">in</span>
<span class="pl-k">match</span> <span class="pl-en">inspect_comp</span> <span class="pl-en">c</span> <span class="pl-k">with</span>
<span class="pl-c1">|</span> <span class="pl-c1">C_Lemma</span> <span class="pl-en">pre</span> <span class="pl-en">post</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
   <span class="pl-k">begin</span>
   <span class="pl-k">let</span> <span class="pl-en">post</span> <span class="pl-c1">=</span> <span class="pl-c1">`((`#</span><span class="pl-en">post</span><span class="pl-c1">)</span> <span class="pl-c1">())</span> <span class="pl-k">in</span> <span class="pl-c"><span class="pl-c">(*</span> unthunk <span class="pl-c">*)</span></span>
   <span class="pl-k">let</span> <span class="pl-en">post</span> <span class="pl-c1">=</span> <span class="pl-en">norm_term</span> <span class="pl-c1">[]</span> <span class="pl-en">post</span> <span class="pl-k">in</span></pre></div>
<p>Is the lemma an implication? We can try to intro</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">match</span> <span class="pl-en">term_as_formula'</span> <span class="pl-en">post</span> <span class="pl-k">with</span>
<span class="pl-c1">|</span> <span class="pl-c1">Implies</span> <span class="pl-en">p</span> <span class="pl-en">q</span> <span class="pl-c1">-&gt;</span>
    <span class="pl-en">apply_lemma</span> <span class="pl-c1">(`</span><span class="pl-en">push1</span><span class="pl-c1">);</span>
    <span class="pl-en">apply_squash_or_lem</span> <span class="pl-c1">(</span><span class="pl-en">d</span><span class="pl-c1">-</span><span class="pl-c1">1</span><span class="pl-c1">)</span> <span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre>   <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
       <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>mapply: can't apply (1)<span class="pl-pds">"</span></span>
   <span class="pl-en">end</span>
<span class="pl-c1">|</span> <span class="pl-c1">C_Total</span> <span class="pl-en">rt</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
   <span class="pl-k">begin</span> <span class="pl-k">match</span> <span class="pl-en">unsquash</span> <span class="pl-en">rt</span> <span class="pl-k">with</span></pre></div>
<p>If the function returns a squash, just apply it, since our goals are squashed</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-c1">|</span> <span class="pl-c1">Some</span> <span class="pl-en">rt</span> <span class="pl-c1">-&gt;</span></pre></div>
<p>DUPLICATED, refactor!
Is the lemma an implication? We can try to intro</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">begin</span>
<span class="pl-k">let</span> <span class="pl-en">rt</span> <span class="pl-c1">=</span> <span class="pl-en">norm_term</span> <span class="pl-c1">[]</span> <span class="pl-en">rt</span> <span class="pl-k">in</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">match</span> <span class="pl-en">term_as_formula'</span> <span class="pl-en">rt</span> <span class="pl-k">with</span>
<span class="pl-c1">|</span> <span class="pl-c1">Implies</span> <span class="pl-en">p</span> <span class="pl-en">q</span> <span class="pl-c1">-&gt;</span>
    <span class="pl-en">apply_lemma</span> <span class="pl-c1">(`</span><span class="pl-en">push1</span><span class="pl-c1">);</span>
    <span class="pl-en">apply_squash_or_lem</span> <span class="pl-c1">(</span><span class="pl-en">d</span><span class="pl-c1">-</span><span class="pl-c1">1</span><span class="pl-c1">)</span> <span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
    <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>mapply: can't apply (1)<span class="pl-pds">"</span></span>
<span class="pl-en">end</span></pre></div>
<p>If not, we can try to introduce the squash ourselves first</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-c1">|</span> <span class="pl-c1">None</span> <span class="pl-c1">-&gt;</span></pre></div>
<p>DUPLICATED, refactor!
Is the lemma an implication? We can try to intro</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">begin</span>
<span class="pl-k">let</span> <span class="pl-en">rt</span> <span class="pl-c1">=</span> <span class="pl-en">norm_term</span> <span class="pl-c1">[]</span> <span class="pl-en">rt</span> <span class="pl-k">in</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">match</span> <span class="pl-en">term_as_formula'</span> <span class="pl-en">rt</span> <span class="pl-k">with</span>
<span class="pl-c1">|</span> <span class="pl-c1">Implies</span> <span class="pl-en">p</span> <span class="pl-en">q</span> <span class="pl-c1">-&gt;</span>
    <span class="pl-en">apply_lemma</span> <span class="pl-c1">(`</span><span class="pl-en">push1</span><span class="pl-c1">);</span>
    <span class="pl-en">apply_squash_or_lem</span> <span class="pl-c1">(</span><span class="pl-en">d</span><span class="pl-c1">-</span><span class="pl-c1">1</span><span class="pl-c1">)</span> <span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre>     <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
         <span class="pl-en">apply</span> <span class="pl-c1">(`</span><span class="pl-smi">FStar.Squash.</span><span class="pl-en">return_squash</span><span class="pl-c1">);</span>
         <span class="pl-en">apply</span> <span class="pl-en">t</span>
     <span class="pl-en">end</span>
   <span class="pl-en">end</span>
<span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>mapply: can't apply (2)<span class="pl-pds">"</span></span>
<span class="pl-en">end</span></pre></div>
<p><code>m</code> is for <code>magic</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">mapply</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">apply_squash_or_lem</span> <span class="pl-c1">10</span> <span class="pl-en">t</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">private</span>
<span class="pl-k">let</span> <span class="pl-en">admit_dump_t</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
  <span class="pl-en">dump</span> <span class="pl-s"><span class="pl-pds">"</span>Admitting<span class="pl-pds">"</span></span><span class="pl-c1">;</span>
  <span class="pl-en">apply</span> <span class="pl-c1">(`</span><span class="pl-k">admit</span><span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">admit_dump</span> <span class="pl-c1">:</span> <span class="pl-c1">#</span><span class="pl-en">a</span><span class="pl-c1">:Type</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">(#[</span><span class="pl-en">admit_dump_t</span> <span class="pl-c1">()]</span> <span class="pl-en">x</span> <span class="pl-c1">:</span> <span class="pl-c1">(unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Admit</span> <span class="pl-en">a</span><span class="pl-c1">))</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Admit</span> <span class="pl-en">a</span>
<span class="pl-k">let</span> <span class="pl-en">admit_dump</span> <span class="pl-c1">#</span><span class="pl-en">a</span> <span class="pl-c1">#</span><span class="pl-en">x</span> <span class="pl-c1">()</span> <span class="pl-c1">=</span> <span class="pl-en">x</span> <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">private</span>
<span class="pl-k">let</span> <span class="pl-en">magic_dump_t</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
  <span class="pl-en">dump</span> <span class="pl-s"><span class="pl-pds">"</span>Admitting<span class="pl-pds">"</span></span><span class="pl-c1">;</span>
  <span class="pl-en">apply</span> <span class="pl-c1">(`</span><span class="pl-en">magic</span><span class="pl-c1">);</span>
  <span class="pl-en">exact</span> <span class="pl-c1">(`());</span>
  <span class="pl-c1">()</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">val</span> <span class="pl-en">magic_dump</span> <span class="pl-c1">:</span> <span class="pl-c1">#</span><span class="pl-en">a</span><span class="pl-c1">:Type</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">(#[</span><span class="pl-en">magic_dump_t</span> <span class="pl-c1">()]</span> <span class="pl-en">x</span> <span class="pl-c1">:</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tot</span> <span class="pl-en">a</span>
<span class="pl-k">let</span> <span class="pl-en">magic_dump</span> <span class="pl-c1">#</span><span class="pl-en">a</span> <span class="pl-c1">#</span><span class="pl-en">x</span> <span class="pl-c1">()</span> <span class="pl-c1">=</span> <span class="pl-en">x</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">change_with</span> <span class="pl-en">t1</span> <span class="pl-en">t2</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">focus</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-en">grewrite</span> <span class="pl-en">t1</span> <span class="pl-en">t2</span><span class="pl-c1">;</span>
        <span class="pl-en">iseq</span> <span class="pl-c1">[</span><span class="pl-en">idtac</span><span class="pl-c1">;</span> <span class="pl-en">trivial</span><span class="pl-c1">]</span>
    <span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">change_sq</span> <span class="pl-c1">(</span><span class="pl-en">t1</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">change</span> <span class="pl-c1">(</span><span class="pl-en">mk_e_app</span> <span class="pl-c1">(`</span><span class="pl-k">squash</span><span class="pl-c1">)</span> <span class="pl-c1">[</span><span class="pl-en">t1</span><span class="pl-c1">])</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">finish_by</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">x</span> <span class="pl-c1">=</span> <span class="pl-en">t</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
    <span class="pl-en">or_else</span> <span class="pl-en">qed</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>finish_by: not finished<span class="pl-pds">"</span></span><span class="pl-c1">);</span>
    <span class="pl-en">x</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">solve_then</span> <span class="pl-c1">#</span><span class="pl-en">a</span> <span class="pl-c1">#</span><span class="pl-en">b</span> <span class="pl-c1">(</span><span class="pl-en">t1</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">t2</span> <span class="pl-c1">:</span> <span class="pl-en">a</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">b</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">b</span> <span class="pl-c1">=</span>
    <span class="pl-en">dup</span> <span class="pl-c1">();</span>
    <span class="pl-k">let</span> <span class="pl-en">x</span> <span class="pl-c1">=</span> <span class="pl-en">focus</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">finish_by</span> <span class="pl-en">t1</span><span class="pl-c1">)</span> <span class="pl-k">in</span>
    <span class="pl-k">let</span> <span class="pl-en">y</span> <span class="pl-c1">=</span> <span class="pl-en">t2</span> <span class="pl-en">x</span> <span class="pl-k">in</span>
    <span class="pl-en">trefl</span> <span class="pl-c1">();</span>
    <span class="pl-en">y</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">add_elem</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-c1">unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span> <span class="pl-c1">=</span> <span class="pl-en">focus</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span>
    <span class="pl-en">apply</span> <span class="pl-c1">(`</span><span class="pl-c1">Cons</span><span class="pl-c1">);</span>
    <span class="pl-en">focus</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span>
      <span class="pl-k">let</span> <span class="pl-en">x</span> <span class="pl-c1">=</span> <span class="pl-en">t</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
      <span class="pl-en">qed</span> <span class="pl-c1">();</span>
      <span class="pl-en">x</span>
    <span class="pl-c1">)</span>
  <span class="pl-c1">)</span></pre></div>
<ul>
<li>
<p>Specialize a function by partially evaluating it</p>
</li>
<li>
<p>For example:</p>
</li>
<li>
<p>let rec foo (l:list int) (x:int) :St int =
match l with
| `` -&gt; x
| hd::tl -&gt; x + foo tl x</p>
<p>let f :int -&gt; St int = synth_by_tactic (specialize (foo <code>1; 2</code>) <code>%</code>foo`)</p>
</li>
<li>
<p>would make the definition of f as x + x + x</p>
</li>
<li>
</li>
<li>
<p>f is the term that needs to be specialized</p>
</li>
<li>
<p>l is the list of names to be delta-ed</p>
</li>
</ul>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">specialize</span> <span class="pl-c1">(#</span><span class="pl-en">a</span><span class="pl-c1">:Type)</span> <span class="pl-c1">(</span><span class="pl-en">f</span><span class="pl-c1">:</span><span class="pl-en">a</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">l</span><span class="pl-c1">:</span><span class="pl-en">list</span> <span class="pl-c1">string)</span> <span class="pl-c1">:unit</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span>
  <span class="pl-c1">=</span> <span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">solve_then</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">exact</span> <span class="pl-c1">(</span><span class="pl-en">quote</span> <span class="pl-en">f</span><span class="pl-c1">))</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">norm</span> <span class="pl-c1">[</span><span class="pl-en">delta_only</span> <span class="pl-en">l</span><span class="pl-c1">;</span> <span class="pl-en">iota</span><span class="pl-c1">;</span> <span class="pl-en">zeta</span><span class="pl-c1">])</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">tlabel</span> <span class="pl-c1">(</span><span class="pl-en">l</span><span class="pl-c1">:string)</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">goals</span> <span class="pl-c1">()</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>tlabel: no goals<span class="pl-pds">"</span></span>
    <span class="pl-c1">|</span> <span class="pl-en">h</span><span class="pl-c1">::</span><span class="pl-en">t</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-en">set_goals</span> <span class="pl-c1">(</span><span class="pl-en">set_label</span> <span class="pl-en">l</span> <span class="pl-en">h</span> <span class="pl-c1">::</span> <span class="pl-en">t</span><span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">tlabel'</span> <span class="pl-c1">(</span><span class="pl-en">l</span><span class="pl-c1">:string)</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">goals</span> <span class="pl-c1">()</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>tlabel': no goals<span class="pl-pds">"</span></span>
    <span class="pl-c1">|</span> <span class="pl-en">h</span><span class="pl-c1">::</span><span class="pl-en">t</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">h</span> <span class="pl-c1">=</span> <span class="pl-en">set_label</span> <span class="pl-c1">(</span><span class="pl-en">l</span> <span class="pl-c1">^</span> <span class="pl-en">get_label</span> <span class="pl-en">h</span><span class="pl-c1">)</span> <span class="pl-en">h</span> <span class="pl-k">in</span>
        <span class="pl-en">set_goals</span> <span class="pl-c1">(</span><span class="pl-en">h</span> <span class="pl-c1">::</span> <span class="pl-en">t</span><span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">focus_all</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">set_goals</span> <span class="pl-c1">(</span><span class="pl-en">goals</span> <span class="pl-c1">()</span> @ <span class="pl-en">smt_goals</span> <span class="pl-c1">());</span>
    <span class="pl-en">set_smt_goals</span> <span class="pl-c1">[]</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">private</span>
<span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">extract_nth</span> <span class="pl-c1">(</span><span class="pl-en">n</span><span class="pl-c1">:nat)</span> <span class="pl-c1">(</span><span class="pl-en">l</span> <span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-en">option</span> <span class="pl-c1">(</span><span class="pl-smi">'a</span> * <span class="pl-en">list</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-k">match</span> <span class="pl-en">n</span><span class="pl-c1">,</span> <span class="pl-en">l</span> <span class="pl-k">with</span>
  <span class="pl-c1">|</span> <span class="pl-c1">_</span><span class="pl-c1">,</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">None</span>
  <span class="pl-c1">|</span> <span class="pl-c1">0</span><span class="pl-c1">,</span> <span class="pl-en">hd</span><span class="pl-c1">::</span><span class="pl-en">tl</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Some</span> <span class="pl-c1">(</span><span class="pl-en">hd</span><span class="pl-c1">,</span> <span class="pl-en">tl</span><span class="pl-c1">)</span>
  <span class="pl-c1">|</span> <span class="pl-c1">_</span><span class="pl-c1">,</span> <span class="pl-en">hd</span><span class="pl-c1">::</span><span class="pl-en">tl</span> <span class="pl-c1">-&gt;</span> <span class="pl-k">begin</span>
    <span class="pl-k">match</span> <span class="pl-en">extract_nth</span> <span class="pl-c1">(</span><span class="pl-en">n</span><span class="pl-c1">-</span><span class="pl-c1">1</span><span class="pl-c1">)</span> <span class="pl-en">tl</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Some</span> <span class="pl-c1">(</span><span class="pl-en">hd'</span><span class="pl-c1">,</span> <span class="pl-en">tl'</span><span class="pl-c1">)</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Some</span> <span class="pl-c1">(</span><span class="pl-en">hd'</span><span class="pl-c1">,</span> <span class="pl-en">hd</span><span class="pl-c1">::</span><span class="pl-en">tl'</span><span class="pl-c1">)</span>
    <span class="pl-c1">|</span> <span class="pl-c1">None</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">None</span>
  <span class="pl-k">end</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">bump_nth</span> <span class="pl-c1">(</span><span class="pl-en">n</span><span class="pl-c1">:pos)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span></pre></div>
<p>n-1 since goal numbering begins at 1</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">match</span> <span class="pl-en">extract_nth</span> <span class="pl-c1">(</span><span class="pl-en">n</span> <span class="pl-c1">-</span> <span class="pl-c1">1</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">goals</span> <span class="pl-c1">())</span> <span class="pl-k">with</span>
<span class="pl-c1">|</span> <span class="pl-c1">None</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>bump_nth: not that many goals<span class="pl-pds">"</span></span>
<span class="pl-c1">|</span> <span class="pl-c1">Some</span> <span class="pl-c1">(</span><span class="pl-en">h</span><span class="pl-c1">,</span> <span class="pl-en">t</span><span class="pl-c1">)</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">set_goals</span> <span class="pl-c1">(</span><span class="pl-en">h</span> <span class="pl-c1">::</span> <span class="pl-en">t</span><span class="pl-c1">)</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">on_sort_bv</span> <span class="pl-c1">(</span><span class="pl-en">f</span> <span class="pl-c1">:</span> <span class="pl-en">term</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">xbv</span><span class="pl-c1">:</span><span class="pl-en">bv</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">bv</span> <span class="pl-c1">=</span>
  <span class="pl-k">let</span> <span class="pl-en">bvv</span> <span class="pl-c1">=</span> <span class="pl-en">inspect_bv</span> <span class="pl-en">xbv</span> <span class="pl-k">in</span>
  <span class="pl-k">let</span> <span class="pl-en">bvv</span> <span class="pl-c1">=</span> <span class="pl-c1">{</span> <span class="pl-en">bvv</span> <span class="pl-k">with</span> <span class="pl-en">bv_sort</span> <span class="pl-c1">=</span> <span class="pl-en">f</span> <span class="pl-en">bvv</span><span class="pl-c1">.</span><span class="pl-en">bv_sort</span> <span class="pl-c1">}</span> <span class="pl-k">in</span>
  <span class="pl-k">let</span> <span class="pl-en">bv</span> <span class="pl-c1">=</span> <span class="pl-en">pack_bv</span> <span class="pl-en">bvv</span> <span class="pl-k">in</span>
  <span class="pl-en">bv</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">on_sort_binder</span> <span class="pl-c1">(</span><span class="pl-en">f</span> <span class="pl-c1">:</span> <span class="pl-en">term</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">b</span><span class="pl-c1">:</span><span class="pl-en">binder</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">binder</span> <span class="pl-c1">=</span>
  <span class="pl-k">let</span> <span class="pl-en">bv</span><span class="pl-c1">,</span> <span class="pl-c1">(</span><span class="pl-en">q</span><span class="pl-c1">,</span> <span class="pl-en">attrs</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-en">inspect_binder</span> <span class="pl-en">b</span> <span class="pl-k">in</span>
  <span class="pl-k">let</span> <span class="pl-en">bv</span> <span class="pl-c1">=</span> <span class="pl-en">on_sort_bv</span> <span class="pl-en">f</span> <span class="pl-en">bv</span> <span class="pl-k">in</span>
  <span class="pl-k">let</span> <span class="pl-en">b</span> <span class="pl-c1">=</span> <span class="pl-en">pack_binder</span> <span class="pl-en">bv</span> <span class="pl-en">q</span> <span class="pl-en">attrs</span> <span class="pl-k">in</span>
  <span class="pl-en">b</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">visit_tm</span> <span class="pl-c1">(</span><span class="pl-en">ff</span> <span class="pl-c1">:</span> <span class="pl-en">term</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span> <span class="pl-c1">=</span>
  <span class="pl-k">let</span> <span class="pl-en">tv</span> <span class="pl-c1">=</span> <span class="pl-en">inspect_ln</span> <span class="pl-en">t</span> <span class="pl-k">in</span>
  <span class="pl-k">let</span> <span class="pl-en">tv'</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">tv</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_FVar</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">tv</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_Var</span> <span class="pl-en">bv</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">bv</span> <span class="pl-c1">=</span> <span class="pl-en">on_sort_bv</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">bv</span> <span class="pl-k">in</span>
        <span class="pl-c1">Tv_Var</span> <span class="pl-en">bv</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-c1">|</span> <span class="pl-c1">Tv_BVar</span> <span class="pl-en">bv</span> <span class="pl-c1">-&gt;</span>
    <span class="pl-k">let</span> <span class="pl-en">bv</span> <span class="pl-c1">=</span> <span class="pl-en">on_sort_bv</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">bv</span> <span class="pl-k">in</span>
    <span class="pl-c1">Tv_BVar</span> <span class="pl-en">bv</span></pre></div>
<div class="highlight highlight-source-fstar"><pre>    <span class="pl-c1">|</span> <span class="pl-c1">Tv_Type</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tv_Type</span> <span class="pl-c1">()</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_Const</span> <span class="pl-en">c</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tv_Const</span> <span class="pl-en">c</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_Uvar</span> <span class="pl-en">i</span> <span class="pl-en">u</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tv_Uvar</span> <span class="pl-en">i</span> <span class="pl-en">u</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_Unknown</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tv_Unknown</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_Arrow</span> <span class="pl-en">b</span> <span class="pl-en">c</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">b</span> <span class="pl-c1">=</span> <span class="pl-en">on_sort_binder</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">b</span> <span class="pl-k">in</span>
        <span class="pl-k">let</span> <span class="pl-en">c</span> <span class="pl-c1">=</span> <span class="pl-en">visit_comp</span> <span class="pl-en">ff</span> <span class="pl-en">c</span> <span class="pl-k">in</span>
        <span class="pl-c1">Tv_Arrow</span> <span class="pl-en">b</span> <span class="pl-en">c</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_Abs</span> <span class="pl-en">b</span> <span class="pl-en">t</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">b</span> <span class="pl-c1">=</span> <span class="pl-en">on_sort_binder</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">b</span> <span class="pl-k">in</span>
        <span class="pl-k">let</span> <span class="pl-en">t</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">t</span> <span class="pl-k">in</span>
        <span class="pl-c1">Tv_Abs</span> <span class="pl-en">b</span> <span class="pl-en">t</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_App</span> <span class="pl-en">l</span> <span class="pl-c1">(</span><span class="pl-en">r</span><span class="pl-c1">,</span> <span class="pl-en">q</span><span class="pl-c1">)</span> <span class="pl-c1">-&gt;</span>
         <span class="pl-k">let</span> <span class="pl-en">l</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">l</span> <span class="pl-k">in</span>
         <span class="pl-k">let</span> <span class="pl-en">r</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">r</span> <span class="pl-k">in</span>
         <span class="pl-c1">Tv_App</span> <span class="pl-en">l</span> <span class="pl-c1">(</span><span class="pl-en">r</span><span class="pl-c1">,</span> <span class="pl-en">q</span><span class="pl-c1">)</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_Refine</span> <span class="pl-en">b</span> <span class="pl-en">r</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">b</span> <span class="pl-c1">=</span> <span class="pl-en">on_sort_bv</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">b</span> <span class="pl-k">in</span>
        <span class="pl-k">let</span> <span class="pl-en">r</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">r</span> <span class="pl-k">in</span>
        <span class="pl-c1">Tv_Refine</span> <span class="pl-en">b</span> <span class="pl-en">r</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_Let</span> <span class="pl-en">r</span> <span class="pl-en">attrs</span> <span class="pl-en">b</span> <span class="pl-en">def</span> <span class="pl-en">t</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">b</span> <span class="pl-c1">=</span> <span class="pl-en">on_sort_bv</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">b</span> <span class="pl-k">in</span>
        <span class="pl-k">let</span> <span class="pl-en">def</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">def</span> <span class="pl-k">in</span>
        <span class="pl-k">let</span> <span class="pl-en">t</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">t</span> <span class="pl-k">in</span>
        <span class="pl-c1">Tv_Let</span> <span class="pl-en">r</span> <span class="pl-en">attrs</span> <span class="pl-en">b</span> <span class="pl-en">def</span> <span class="pl-en">t</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_Match</span> <span class="pl-en">sc</span> <span class="pl-en">ret_opt</span> <span class="pl-en">brs</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">sc</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">sc</span> <span class="pl-k">in</span>
        <span class="pl-k">let</span> <span class="pl-en">ret_opt</span> <span class="pl-c1">=</span> <span class="pl-en">map_opt</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-en">ret</span> <span class="pl-c1">-&gt;</span>
          <span class="pl-k">match</span> <span class="pl-en">ret</span> <span class="pl-k">with</span>
          <span class="pl-c1">|</span> <span class="pl-c1">Inl</span> <span class="pl-en">t</span><span class="pl-c1">,</span> <span class="pl-en">tacopt</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Inl</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">t</span><span class="pl-c1">),</span> <span class="pl-en">map_opt</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">tacopt</span>
          <span class="pl-c1">|</span> <span class="pl-c1">Inr</span> <span class="pl-en">c</span><span class="pl-c1">,</span> <span class="pl-en">tacopt</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Inr</span> <span class="pl-c1">(</span><span class="pl-en">visit_comp</span> <span class="pl-en">ff</span> <span class="pl-en">c</span><span class="pl-c1">),</span> <span class="pl-en">map_opt</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">tacopt</span><span class="pl-c1">)</span> <span class="pl-en">ret_opt</span> <span class="pl-k">in</span>
        <span class="pl-k">let</span> <span class="pl-en">brs</span> <span class="pl-c1">=</span> <span class="pl-en">map</span> <span class="pl-c1">(</span><span class="pl-en">visit_br</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">brs</span> <span class="pl-k">in</span>
        <span class="pl-c1">Tv_Match</span> <span class="pl-en">sc</span> <span class="pl-en">ret_opt</span> <span class="pl-en">brs</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_AscribedT</span> <span class="pl-en">e</span> <span class="pl-en">t</span> <span class="pl-en">topt</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">e</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">e</span> <span class="pl-k">in</span>
        <span class="pl-k">let</span> <span class="pl-en">t</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">t</span> <span class="pl-k">in</span>
        <span class="pl-c1">Tv_AscribedT</span> <span class="pl-en">e</span> <span class="pl-en">t</span> <span class="pl-en">topt</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_AscribedC</span> <span class="pl-en">e</span> <span class="pl-en">c</span> <span class="pl-en">topt</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">e</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">e</span> <span class="pl-k">in</span>
        <span class="pl-c1">Tv_AscribedC</span> <span class="pl-en">e</span> <span class="pl-en">c</span> <span class="pl-en">topt</span>
  <span class="pl-k">in</span>
  <span class="pl-en">ff</span> <span class="pl-c1">(</span><span class="pl-en">pack_ln</span> <span class="pl-en">tv'</span><span class="pl-c1">)</span>
<span class="pl-k">and</span> <span class="pl-en">visit_br</span> <span class="pl-c1">(</span><span class="pl-en">ff</span> <span class="pl-c1">:</span> <span class="pl-en">term</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">b</span><span class="pl-c1">:</span><span class="pl-en">branch</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">branch</span> <span class="pl-c1">=</span>
  <span class="pl-k">let</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">,</span> <span class="pl-en">t</span><span class="pl-c1">)</span> <span class="pl-c1">=</span> <span class="pl-en">b</span> <span class="pl-k">in</span>
  <span class="pl-k">let</span> <span class="pl-en">p</span> <span class="pl-c1">=</span> <span class="pl-en">visit_pat</span> <span class="pl-en">ff</span> <span class="pl-en">p</span> <span class="pl-k">in</span>
  <span class="pl-k">let</span> <span class="pl-en">t</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">t</span> <span class="pl-k">in</span>
  <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">,</span> <span class="pl-en">t</span><span class="pl-c1">)</span>
<span class="pl-k">and</span> <span class="pl-en">visit_pat</span> <span class="pl-c1">(</span><span class="pl-en">ff</span> <span class="pl-c1">:</span> <span class="pl-en">term</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">:</span><span class="pl-en">pattern</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">pattern</span> <span class="pl-c1">=</span>
  <span class="pl-k">match</span> <span class="pl-en">p</span> <span class="pl-k">with</span>
  <span class="pl-c1">|</span> <span class="pl-c1">Pat_Constant</span> <span class="pl-en">c</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">p</span>
  <span class="pl-c1">|</span> <span class="pl-c1">Pat_Cons</span> <span class="pl-en">fv</span> <span class="pl-en">l</span> <span class="pl-c1">-&gt;</span>
      <span class="pl-k">let</span> <span class="pl-en">l</span> <span class="pl-c1">=</span> <span class="pl-c1">(</span><span class="pl-en">map</span> <span class="pl-c1">(</span><span class="pl-k">fun</span><span class="pl-c1">(</span><span class="pl-en">p</span><span class="pl-c1">,</span><span class="pl-en">b</span><span class="pl-c1">)</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">(</span><span class="pl-en">visit_pat</span> <span class="pl-en">ff</span> <span class="pl-en">p</span><span class="pl-c1">,</span> <span class="pl-en">b</span><span class="pl-c1">))</span> <span class="pl-en">l</span><span class="pl-c1">)</span> <span class="pl-k">in</span>
      <span class="pl-c1">Pat_Cons</span> <span class="pl-en">fv</span> <span class="pl-en">l</span>
  <span class="pl-c1">|</span> <span class="pl-c1">Pat_Var</span> <span class="pl-en">bv</span> <span class="pl-c1">-&gt;</span>
      <span class="pl-k">let</span> <span class="pl-en">bv</span> <span class="pl-c1">=</span> <span class="pl-en">on_sort_bv</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">bv</span> <span class="pl-k">in</span>
      <span class="pl-c1">Pat_Var</span> <span class="pl-en">bv</span>
  <span class="pl-c1">|</span> <span class="pl-c1">Pat_Wild</span> <span class="pl-en">bv</span> <span class="pl-c1">-&gt;</span>
      <span class="pl-k">let</span> <span class="pl-en">bv</span> <span class="pl-c1">=</span> <span class="pl-en">on_sort_bv</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">bv</span> <span class="pl-k">in</span>
      <span class="pl-c1">Pat_Wild</span> <span class="pl-en">bv</span>
  <span class="pl-c1">|</span> <span class="pl-c1">Pat_Dot_Term</span> <span class="pl-en">bv</span> <span class="pl-en">term</span> <span class="pl-c1">-&gt;</span>
      <span class="pl-k">let</span> <span class="pl-en">bv</span> <span class="pl-c1">=</span> <span class="pl-en">on_sort_bv</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">bv</span> <span class="pl-k">in</span>
      <span class="pl-k">let</span> <span class="pl-en">term</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">term</span> <span class="pl-k">in</span>
      <span class="pl-c1">Pat_Dot_Term</span> <span class="pl-en">bv</span> <span class="pl-en">term</span>
<span class="pl-k">and</span> <span class="pl-en">visit_comp</span> <span class="pl-c1">(</span><span class="pl-en">ff</span> <span class="pl-c1">:</span> <span class="pl-en">term</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">c</span> <span class="pl-c1">:</span> <span class="pl-en">comp</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">comp</span> <span class="pl-c1">=</span>
  <span class="pl-k">let</span> <span class="pl-en">cv</span> <span class="pl-c1">=</span> <span class="pl-en">inspect_comp</span> <span class="pl-en">c</span> <span class="pl-k">in</span>
  <span class="pl-k">let</span> <span class="pl-en">cv'</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">cv</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">C_Total</span> <span class="pl-en">ret</span> <span class="pl-en">decr</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">ret</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">ret</span> <span class="pl-k">in</span>
        <span class="pl-k">let</span> <span class="pl-en">decr</span> <span class="pl-c1">=</span> <span class="pl-en">map</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">decr</span> <span class="pl-k">in</span>
        <span class="pl-c1">C_Total</span> <span class="pl-en">ret</span> <span class="pl-en">decr</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-c1">|</span> <span class="pl-c1">C_GTotal</span> <span class="pl-en">ret</span> <span class="pl-en">decr</span> <span class="pl-c1">-&gt;</span>
    <span class="pl-k">let</span> <span class="pl-en">ret</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">ret</span> <span class="pl-k">in</span>
    <span class="pl-k">let</span> <span class="pl-en">decr</span> <span class="pl-c1">=</span> <span class="pl-en">map</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span><span class="pl-c1">)</span> <span class="pl-en">decr</span> <span class="pl-k">in</span>
    <span class="pl-c1">C_GTotal</span> <span class="pl-en">ret</span> <span class="pl-en">decr</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-c1">|</span> <span class="pl-c1">C_Lemma</span> <span class="pl-en">pre</span> <span class="pl-en">post</span> <span class="pl-en">pats</span> <span class="pl-c1">-&gt;</span>
    <span class="pl-k">let</span> <span class="pl-en">pre</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">pre</span> <span class="pl-k">in</span>
    <span class="pl-k">let</span> <span class="pl-en">post</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">post</span> <span class="pl-k">in</span>
    <span class="pl-k">let</span> <span class="pl-en">pats</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">pats</span> <span class="pl-k">in</span>
    <span class="pl-c1">C_Lemma</span> <span class="pl-en">pre</span> <span class="pl-en">post</span> <span class="pl-en">pats</span></pre></div>
<div class="highlight highlight-source-fstar"><pre>  <span class="pl-c1">|</span> <span class="pl-c1">C_Eff</span> <span class="pl-en">us</span> <span class="pl-en">eff</span> <span class="pl-en">res</span> <span class="pl-en">args</span> <span class="pl-c1">-&gt;</span>
      <span class="pl-k">let</span> <span class="pl-en">res</span> <span class="pl-c1">=</span> <span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">res</span> <span class="pl-k">in</span>
      <span class="pl-k">let</span> <span class="pl-en">args</span> <span class="pl-c1">=</span> <span class="pl-en">map</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">(</span><span class="pl-en">a</span><span class="pl-c1">,</span> <span class="pl-en">q</span><span class="pl-c1">)</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">a</span><span class="pl-c1">,</span> <span class="pl-en">q</span><span class="pl-c1">))</span> <span class="pl-en">args</span> <span class="pl-k">in</span>
      <span class="pl-c1">C_Eff</span> <span class="pl-en">us</span> <span class="pl-en">eff</span> <span class="pl-en">res</span> <span class="pl-en">args</span>
<span class="pl-k">in</span>
<span class="pl-en">pack_comp</span> <span class="pl-en">cv'</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">destruct_list</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">(</span><span class="pl-en">list</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
    <span class="pl-k">let</span> <span class="pl-en">head</span><span class="pl-c1">,</span> <span class="pl-en">args</span> <span class="pl-c1">=</span> <span class="pl-en">collect_app</span> <span class="pl-en">t</span> <span class="pl-k">in</span>
    <span class="pl-k">match</span> <span class="pl-en">inspect_ln</span> <span class="pl-en">head</span><span class="pl-c1">,</span> <span class="pl-en">args</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_FVar</span> <span class="pl-en">fv</span><span class="pl-c1">,</span> <span class="pl-c1">[(</span><span class="pl-en">a1</span><span class="pl-c1">,</span> <span class="pl-c1">Q_Explicit</span><span class="pl-c1">);</span> <span class="pl-c1">(</span><span class="pl-en">a2</span><span class="pl-c1">,</span> <span class="pl-c1">Q_Explicit</span><span class="pl-c1">)]</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_FVar</span> <span class="pl-en">fv</span><span class="pl-c1">,</span> <span class="pl-c1">[(</span><span class="pl-c1">_</span><span class="pl-c1">,</span> <span class="pl-c1">Q_Implicit</span><span class="pl-c1">);</span> <span class="pl-c1">(</span><span class="pl-en">a1</span><span class="pl-c1">,</span> <span class="pl-c1">Q_Explicit</span><span class="pl-c1">);</span> <span class="pl-c1">(</span><span class="pl-en">a2</span><span class="pl-c1">,</span> <span class="pl-c1">Q_Explicit</span><span class="pl-c1">)]</span> <span class="pl-c1">-&gt;</span>
      <span class="pl-k">if</span> <span class="pl-en">inspect_fv</span> <span class="pl-en">fv</span> <span class="pl-c1">=</span> <span class="pl-en">cons_qn</span>
      <span class="pl-k">then</span> <span class="pl-en">a1</span> <span class="pl-c1">::</span> <span class="pl-en">destruct_list</span> <span class="pl-en">a2</span>
      <span class="pl-k">else</span> <span class="pl-en">raise</span> <span class="pl-c1">NotAListLiteral</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_FVar</span> <span class="pl-en">fv</span><span class="pl-c1">,</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
      <span class="pl-k">if</span> <span class="pl-en">inspect_fv</span> <span class="pl-en">fv</span> <span class="pl-c1">=</span> <span class="pl-en">nil_qn</span>
      <span class="pl-k">then</span> <span class="pl-c1">[]</span>
      <span class="pl-k">else</span> <span class="pl-en">raise</span> <span class="pl-c1">NotAListLiteral</span>
    <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span>
      <span class="pl-en">raise</span> <span class="pl-c1">NotAListLiteral</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">private</span> <span class="pl-k">let</span> <span class="pl-en">get_match_body</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span> <span class="pl-c1">=</span>
  <span class="pl-k">match</span> <span class="pl-smi">FStar.Reflection.Formula.</span><span class="pl-en">unsquash</span> <span class="pl-c1">(</span><span class="pl-en">cur_goal</span> <span class="pl-c1">())</span> <span class="pl-k">with</span>
  <span class="pl-c1">|</span> <span class="pl-c1">None</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
  <span class="pl-c1">|</span> <span class="pl-c1">Some</span> <span class="pl-en">t</span> <span class="pl-c1">-&gt;</span> <span class="pl-k">match</span> <span class="pl-en">inspect</span> <span class="pl-en">t</span> <span class="pl-k">with</span>
             <span class="pl-c1">|</span> <span class="pl-c1">Tv_Match</span> <span class="pl-en">sc</span> <span class="pl-c1">_</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">sc</span>
             <span class="pl-c1">|</span> <span class="pl-c1">_</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>Goal is not a match<span class="pl-pds">"</span></span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">private</span> <span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">last</span> <span class="pl-c1">(</span><span class="pl-en">x</span> <span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-smi">'a</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-smi">'a</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">x</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>last: empty list<span class="pl-pds">"</span></span>
    <span class="pl-c1">|</span> <span class="pl-c1">[</span><span class="pl-en">x</span><span class="pl-c1">]</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">x</span>
    <span class="pl-c1">|</span> <span class="pl-c1">_</span><span class="pl-c1">::</span><span class="pl-en">xs</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">last</span> <span class="pl-en">xs</span></pre></div>
<h4>
<a id="user-content-branch_on_match" class="anchor" href="#branch_on_match" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>branch_on_match</h4>
<p>When the goal is <code>match e with | p1 -&gt; e1 ... | pn -&gt; en</code>,
destruct it into <code>n</code> goals for each possible case, including an
hypothesis for <code>e</code> matching the correposnding pattern.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">branch_on_match</span> <span class="pl-c1">()</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">unit</span> <span class="pl-c1">=</span>
    <span class="pl-en">focus</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span>
      <span class="pl-k">let</span> <span class="pl-en">x</span> <span class="pl-c1">=</span> <span class="pl-en">get_match_body</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
      <span class="pl-k">let</span> <span class="pl-c1">_</span> <span class="pl-c1">=</span> <span class="pl-en">t_destruct</span> <span class="pl-en">x</span> <span class="pl-k">in</span>
      <span class="pl-en">iterAll</span> <span class="pl-c1">(</span><span class="pl-k">fun</span> <span class="pl-c1">()</span> <span class="pl-c1">-&gt;</span>
        <span class="pl-k">let</span> <span class="pl-en">bs</span> <span class="pl-c1">=</span> <span class="pl-en">repeat</span> <span class="pl-en">intro</span> <span class="pl-k">in</span>
        <span class="pl-k">let</span> <span class="pl-en">b</span> <span class="pl-c1">=</span> <span class="pl-en">last</span> <span class="pl-en">bs</span> <span class="pl-k">in</span> <span class="pl-c"><span class="pl-c">(*</span> this one is the equality <span class="pl-c">*)</span></span>
        <span class="pl-en">grewrite_eq</span> <span class="pl-en">b</span><span class="pl-c1">;</span>
        <span class="pl-en">norm</span> <span class="pl-c1">[</span><span class="pl-en">iota</span><span class="pl-c1">])</span>
    <span class="pl-c1">)</span></pre></div>
<h4>
<a id="user-content-nth_binder" class="anchor" href="#nth_binder" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>nth_binder</h4>
<p>When the argument <code>i</code> is non-negative, <a href="#nth_binder"><code>nth_binder</code></a> grabs the nth
binder in the current goal. When it is negative, it grabs the (-i-1)th
binder counting from the end of the goal. That is, <code>nth_binder (-1)</code>
will return the last binder, <code>nth_binder (-2)</code> the second to last, and
so on.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">nth_binder</span> <span class="pl-c1">(</span><span class="pl-en">i</span><span class="pl-c1">:int)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">binder</span> <span class="pl-c1">=</span>
  <span class="pl-k">let</span> <span class="pl-en">bs</span> <span class="pl-c1">=</span> <span class="pl-en">cur_binders</span> <span class="pl-c1">()</span> <span class="pl-k">in</span>
  <span class="pl-k">let</span> <span class="pl-en">k</span> <span class="pl-c1">:</span> <span class="pl-c1">int</span> <span class="pl-c1">=</span> <span class="pl-k">if</span> <span class="pl-en">i</span> &gt;<span class="pl-c1">=</span> <span class="pl-c1">0</span> <span class="pl-k">then</span> <span class="pl-en">i</span> <span class="pl-k">else</span> <span class="pl-smi">List.Tot.Base.</span><span class="pl-en">length</span> <span class="pl-en">bs</span> <span class="pl-c1">+</span> <span class="pl-en">i</span> <span class="pl-k">in</span>
  <span class="pl-k">let</span> <span class="pl-en">k</span> <span class="pl-c1">:</span> <span class="pl-c1">nat</span> <span class="pl-c1">=</span> <span class="pl-k">if</span> <span class="pl-en">k</span> &lt; <span class="pl-c1">0</span> <span class="pl-k">then</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>not enough binders<span class="pl-pds">"</span></span> <span class="pl-k">else</span> <span class="pl-en">k</span> <span class="pl-k">in</span>
  <span class="pl-k">match</span> <span class="pl-smi">List.Tot.Base.</span><span class="pl-en">nth</span> <span class="pl-en">bs</span> <span class="pl-en">k</span> <span class="pl-k">with</span>
  <span class="pl-c1">|</span> <span class="pl-c1">None</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">fail</span> <span class="pl-s"><span class="pl-pds">"</span>not enough binders<span class="pl-pds">"</span></span>
  <span class="pl-c1">|</span> <span class="pl-c1">Some</span> <span class="pl-en">b</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">b</span></pre></div>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">exception</span> <span class="pl-c1">Appears</span></pre></div>
<h4>
<a id="user-content-name_appears_in" class="anchor" href="#name_appears_in" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>name_appears_in</h4>
<p>Decides whether a top-level name <code>nm</code> syntactically
appears in the term <code>t</code>.</p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-en">name_appears_in</span> <span class="pl-c1">(</span><span class="pl-en">nm</span><span class="pl-c1">:</span><span class="pl-en">name</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">t</span><span class="pl-c1">:</span><span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-c1">bool</span> <span class="pl-c1">=</span>
  <span class="pl-k">let</span> <span class="pl-en">ff</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span> <span class="pl-c1">=</span>
    <span class="pl-k">match</span> <span class="pl-en">t</span> <span class="pl-k">with</span>
    <span class="pl-c1">|</span> <span class="pl-c1">Tv_FVar</span> <span class="pl-en">fv</span> <span class="pl-c1">-&gt;</span>
      <span class="pl-k">if</span> <span class="pl-en">inspect_fv</span> <span class="pl-en">fv</span> <span class="pl-c1">=</span> <span class="pl-en">nm</span> <span class="pl-k">then</span>
        <span class="pl-en">raise</span> <span class="pl-c1">Appears</span><span class="pl-c1">;</span>
      <span class="pl-en">t</span>
    <span class="pl-c1">|</span> <span class="pl-en">t</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">t</span>
  <span class="pl-k">in</span>
  <span class="pl-k">try</span> <span class="pl-en">ignore</span> <span class="pl-c1">(</span><span class="pl-en">visit_tm</span> <span class="pl-en">ff</span> <span class="pl-en">t</span><span class="pl-c1">);</span> <span class="pl-c1">false</span> <span class="pl-k">with</span>
  <span class="pl-c1">|</span> <span class="pl-c1">Appears</span> <span class="pl-c1">-&gt;</span> <span class="pl-c1">true</span>
  <span class="pl-c1">|</span> <span class="pl-en">e</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">raise</span> <span class="pl-en">e</span></pre></div>
<h4>
<a id="user-content-mk_abs" class="anchor" href="#mk_abs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>mk_abs</h4>
<p><code>mk_abs </code>x1; ...; xn<code> t</code> returns the term <code>fun x1 ... xn -&gt; t</code></p>
<div class="highlight highlight-source-fstar"><pre><span class="pl-k">let</span> <span class="pl-k">rec</span> <span class="pl-en">mk_abs</span> <span class="pl-c1">(</span><span class="pl-en">args</span> <span class="pl-c1">:</span> <span class="pl-en">list</span> <span class="pl-en">binder</span><span class="pl-c1">)</span> <span class="pl-c1">(</span><span class="pl-en">t</span> <span class="pl-c1">:</span> <span class="pl-en">term</span><span class="pl-c1">)</span> <span class="pl-c1">:</span> <span class="pl-c1">Tac</span> <span class="pl-en">term</span> <span class="pl-c1">(</span><span class="pl-en">decreases</span> <span class="pl-en">args</span><span class="pl-c1">)</span> <span class="pl-c1">=</span>
  <span class="pl-k">match</span> <span class="pl-en">args</span> <span class="pl-k">with</span>
  <span class="pl-c1">|</span> <span class="pl-c1">[]</span> <span class="pl-c1">-&gt;</span> <span class="pl-en">t</span>
  <span class="pl-c1">|</span> <span class="pl-en">a</span> <span class="pl-c1">::</span> <span class="pl-en">args'</span> <span class="pl-c1">-&gt;</span>
    <span class="pl-k">let</span> <span class="pl-en">t'</span> <span class="pl-c1">=</span> <span class="pl-en">mk_abs</span> <span class="pl-en">args'</span> <span class="pl-en">t</span> <span class="pl-k">in</span>
    <span class="pl-en">pack</span> <span class="pl-c1">(</span><span class="pl-c1">Tv_Abs</span> <span class="pl-en">a</span> <span class="pl-en">t'</span><span class="pl-c1">)</span></pre></div>

</body>
</html>
